{"file_contents":{"components/auth/AuthLayout.tsx":{"content":"\nimport React, { useRef } from 'react';\nimport AuthBackground from './AuthBackground';\nimport { motion, useMotionValue, useTransform } from 'framer-motion';\n\nconst AuthLayout: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const x = useMotionValue(0);\n  const y = useMotionValue(0);\n\n  const rotateX = useTransform(y, [-150, 150], [10, -10]);\n  const rotateY = useTransform(x, [-150, 150], [-10, 10]);\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if(!ref.current) return;\n    const rect = ref.current.getBoundingClientRect();\n    x.set(e.clientX - rect.left - rect.width / 2);\n    y.set(e.clientY - rect.top - rect.height / 2);\n  };\n    \n  const handleMouseLeave = () => {\n    x.set(0);\n    y.set(0);\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      transition={{ duration: 0.5 }}\n      className=\"relative w-full min-h-screen overflow-hidden flex items-center justify-center p-4 font-sans\"\n      style={{ perspective: '1000px' }}\n    >\n      <AuthBackground />\n      <motion.div\n        ref={ref}\n        onMouseMove={handleMouseMove}\n        onMouseLeave={handleMouseLeave}\n        style={{ rotateX, rotateY, transformStyle: 'preserve-3d' }}\n        className=\"relative z-10 w-full max-w-md\"\n      >\n        {children}\n      </motion.div>\n    </motion.div>\n  );\n};\n\nexport default AuthLayout;\n","size_bytes":1476},"components/admin/AdminPanel.tsx":{"content":"import React, { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { LayoutDashboard, Users, ArrowDownToLine, ArrowUpFromLine, Wallet, Settings, LogOut, X, Menu, Search, Edit2, Trash2, Save, FileDown, RefreshCw, PlusCircle, MessageSquare, Mail, Eye, Bot, Star } from 'lucide-react';\nimport AuthBackground from '../auth/AuthBackground';\nimport { UserData, AdminTransaction, SystemSettings, WalletConfig, Wallet as WalletType, Message, Testimonial } from '../../types';\nimport * as userDataService from '../../services/userDataService';\nimport WelcomeMessageEditor from './WelcomeMessageEditor';\nimport WelcomePageEditor from './WelcomePageEditor';\nimport ChatbotSettings from './ChatbotSettings';\n\ntype AdminView = 'dashboard' | 'users' | 'deposits' | 'withdrawals' | 'wallets' | 'settings' | 'messages' | 'welcome_message' | 'welcome_page' | 'chatbot' | 'testimonials';\n\n// Helper Components\nconst Card: React.FC<{children: React.ReactNode, className?: string}> = ({ children, className = '' }) => (\n    <div className={`bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-2xl shadow-lg hover:border-brand-primary/50 transition-colors duration-300 ${className}`}>\n        {children}\n    </div>\n);\n\nconst StatCard: React.FC<{ title: string; value: string | number; icon: React.ReactNode }> = ({ title, value, icon }) => (\n    <Card className=\"p-6\">\n        <div className=\"flex items-center justify-between\">\n            <div>\n                <p className=\"text-brand-text-secondary\">{title}</p>\n                <p className=\"text-3xl font-bold text-white font-mono\">{value}</p>\n            </div>\n            <div className=\"p-3 bg-brand-primary/10 text-brand-primary rounded-full\">{icon}</div>\n        </div>\n    </Card>\n);\n\nconst AdminPanel: React.FC<{ onLogout: () => void }> = ({ onLogout }) => {\n    const [activeView, setActiveView] = useState<AdminView>('dashboard');\n    const [isSidebarOpen, setSidebarOpen] = useState(true);\n\n    useEffect(() => {\n        const mediaQuery = window.matchMedia('(min-width: 1024px)');\n        const handleResize = () => setSidebarOpen(mediaQuery.matches);\n        handleResize();\n        window.addEventListener('resize', handleResize);\n        return () => window.removeEventListener('resize', handleResize);\n    }, []);\n\n    const renderContent = () => {\n        switch(activeView) {\n            case 'dashboard': return <DashboardContent />;\n            case 'users': return <UsersManagement />;\n            case 'deposits': return <DepositsManagement />;\n            case 'withdrawals': return <WithdrawalsManagement />;\n            case 'wallets': return <WalletSettings />;\n            case 'settings': return <SystemSettingsComponent />;\n            case 'messages': return <MessagingManagement />;\n            case 'welcome_message': return <WelcomeMessageEditor />;\n            case 'welcome_page': return <WelcomePageEditor />;\n            case 'chatbot': return <ChatbotSettings />;\n            case 'testimonials': return <TestimonialsManagement />;\n            default: return <DashboardContent />;\n        }\n    };\n    \n    const NavItem: React.FC<{ view: AdminView; icon: React.ReactNode; label: string }> = ({ view, icon, label }) => (\n        <button\n            onClick={() => {\n                setActiveView(view);\n                if(window.innerWidth < 1024) setSidebarOpen(false);\n            }}\n            className={`flex items-center w-full px-4 py-3 text-left rounded-lg transition-all duration-300 ${activeView === view ? 'bg-brand-primary/20 text-brand-primary' : 'text-brand-text-secondary hover:bg-white/10 hover:text-white'}`}\n        >\n            {icon}\n            <span className=\"ml-4 whitespace-nowrap\">{label}</span>\n        </button>\n    );\n\n    return (\n        <div className=\"flex min-h-screen bg-brand-bg font-sans text-white\">\n            <AuthBackground />\n            <AnimatePresence>\n                {isSidebarOpen && (\n                    <motion.div\n                      initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}\n                      className=\"fixed inset-0 bg-black/50 z-40 lg:hidden\"\n                      onClick={() => setSidebarOpen(false)}\n                    />\n                )}\n            </AnimatePresence>\n            \n            <aside className={`fixed lg:relative inset-y-0 left-0 w-64 bg-brand-surface/50 backdrop-blur-2xl border-r border-white/10 z-50 flex flex-col p-4 transform transition-transform duration-300 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>\n                <div className=\"flex items-center justify-between mb-8\">\n                    <h1 className=\"text-2xl font-bold text-brand-primary\">Admin Panel</h1>\n                    <button onClick={() => setSidebarOpen(false)} className=\"lg:hidden p-1 rounded-full hover:bg-white/10\"><X size={20} /></button>\n                </div>\n                <nav className=\"flex flex-col gap-2\">\n                    <NavItem view=\"dashboard\" icon={<LayoutDashboard size={20}/>} label=\"Dashboard\" />\n                    <NavItem view=\"users\" icon={<Users size={20}/>} label=\"Users\" />\n                    <NavItem view=\"testimonials\" icon={<Star size={20}/>} label=\"Testimonials\" />\n                    <NavItem view=\"chatbot\" icon={<Bot size={20} />} label=\"Chatbot Settings\" />\n                    <NavItem view=\"messages\" icon={<MessageSquare size={20} />} label=\"Broadcasts\" />\n                    <NavItem view=\"welcome_page\" icon={<Eye size={20} />} label=\"Welcome Page\" />\n                    <NavItem view=\"welcome_message\" icon={<Mail size={20} />} label=\"Welcome Inbox Msg\" />\n                    <NavItem view=\"deposits\" icon={<ArrowDownToLine size={20}/>} label=\"Deposits\" />\n                    <NavItem view=\"withdrawals\" icon={<ArrowUpFromLine size={20}/>} label=\"Withdrawals\" />\n                    <NavItem view=\"wallets\" icon={<Wallet size={20}/>} label=\"Wallets\" />\n                    <NavItem view=\"settings\" icon={<Settings size={20}/>} label=\"Settings\" />\n                </nav>\n                <div className=\"mt-auto\">\n                    <button onClick={onLogout} className=\"flex items-center w-full px-4 py-3 text-left rounded-lg text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-colors\">\n                        <LogOut size={20}/>\n                        <span className=\"ml-4\">Logout</span>\n                    </button>\n                </div>\n            </aside>\n\n            <main className=\"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto relative\">\n                 <button onClick={() => setSidebarOpen(true)} className={`lg:hidden p-2 absolute top-6 left-6 text-white z-20 ${isSidebarOpen ? 'hidden' : ''}`}>\n                    <Menu size={28}/>\n                </button>\n                <div className=\"relative z-10 max-w-7xl mx-auto\">\n                    <AnimatePresence mode=\"wait\">\n                        <motion.div\n                            key={activeView}\n                            initial={{ opacity: 0, y: 20 }}\n                            animate={{ opacity: 1, y: 0 }}\n                            exit={{ opacity: 0, y: -20 }}\n                            transition={{ duration: 0.3 }}\n                        >\n                            {renderContent()}\n                        </motion.div>\n                    </AnimatePresence>\n                </div>\n            </main>\n        </div>\n    );\n};\n\n\n// Admin Page Components\nconst DashboardContent: React.FC = () => {\n    const [stats, setStats] = useState({ users: 0, deposits: 0, withdrawals: 0, balance: 0, referrals: 0 });\n\n    const fetchData = useCallback(async () => {\n        const users = await userDataService.getAllUsersData();\n        const txs = await userDataService.getAllTransactions();\n        const totalBalance = users.reduce((sum, user) => sum + user.balance, 0);\n        const totalReferrals = users.reduce((sum, user) => sum + user.referrals.count, 0);\n        \n        setStats({\n            users: users.length,\n            deposits: txs.filter(t => t.type === 'Deposit' && t.status === 'Confirmed').reduce((sum, t) => sum + (t.usdValue || t.amount), 0),\n            withdrawals: txs.filter(t => t.type === 'Withdrawal' && t.status === 'Pending').length,\n            balance: totalBalance,\n            referrals: totalReferrals,\n        });\n    }, []);\n\n    useEffect(() => {\n        fetchData();\n        const interval = setInterval(fetchData, 5000); // Refresh every 5 seconds\n        return () => clearInterval(interval);\n    }, [fetchData]);\n\n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold\">Dashboard</h1>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                <StatCard title=\"Total Users\" value={stats.users} icon={<Users />} />\n                <StatCard title=\"Total Deposits (USD)\" value={`$${stats.deposits.toLocaleString()}`} icon={<ArrowDownToLine />} />\n                <StatCard title=\"Pending Withdrawals\" value={stats.withdrawals} icon={<ArrowUpFromLine />} />\n                <StatCard title=\"Total Referrals\" value={stats.referrals} icon={<Users />} />\n                <StatCard title=\"Platform Wallet Balance\" value={`$${stats.balance.toLocaleString()}`} icon={<Wallet />} />\n            </div>\n        </div>\n    );\n};\n\nconst UsersManagement: React.FC = () => {\n    const [users, setUsers] = useState<UserData[]>([]);\n    const [searchTerm, setSearchTerm] = useState('');\n    const [editingUser, setEditingUser] = useState<UserData | null>(null);\n    const [newPassword, setNewPassword] = useState('');\n    const [addBalanceAmount, setAddBalanceAmount] = useState<number | ''>('');\n    const [addBalanceAsset, setAddBalanceAsset] = useState('USDT');\n    const [wallets, setWallets] = useState<WalletConfig>({});\n    const [toast, setToast] = useState('');\n\n    const showToast = (message: string) => {\n        setToast(message);\n        setTimeout(() => setToast(''), 3000);\n    };\n\n    const loadUsers = useCallback(async () => {\n        const allUsers = await userDataService.getAllUsersData();\n        setUsers(allUsers);\n    }, []);\n\n    useEffect(() => {\n        userDataService.getWalletConfig().then(setWallets);\n        loadUsers();\n        const interval = setInterval(loadUsers, 5000); // Refresh every 5 seconds\n        return () => clearInterval(interval);\n    }, [loadUsers]);\n\n    const filteredUsers = users.filter(u => \n        u.name.toLowerCase().includes(searchTerm.toLowerCase()) || \n        u.email.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    const handleSave = async () => {\n        if (editingUser) {\n            const updates: Partial<UserData> = {\n                name: editingUser.name,\n                email: editingUser.email,\n            };\n            if (newPassword) {\n                updates.password = newPassword;\n            }\n            await userDataService.updateUserData(editingUser.id, updates);\n            setNewPassword('');\n            setEditingUser(null);\n            showToast('User updated successfully!');\n            loadUsers();\n        }\n    };\n    \n    const handleDelete = async (userId: string) => {\n        if(window.confirm('Are you sure you want to delete this user? This action is irreversible.')){\n            await userDataService.deleteUser(userId);\n            showToast('User deleted.');\n            loadUsers();\n        }\n    };\n\n    const handleAddBalance = async () => {\n        if (editingUser && typeof addBalanceAmount === 'number' && addBalanceAmount > 0) {\n            const updatedUser = await userDataService.adminAddBalance(editingUser.id, addBalanceAmount, addBalanceAsset);\n            if (updatedUser) {\n                setEditingUser(updatedUser);\n                showToast(`$${addBalanceAmount} added to ${updatedUser.name}.`);\n                loadUsers(); // To refresh main list if needed\n            }\n            setAddBalanceAmount('');\n        } else {\n            showToast('Please enter a valid amount.');\n        }\n    };\n\n    if (editingUser) {\n        return (\n            <div className=\"space-y-6\">\n                <h1 className=\"text-3xl font-bold\">Edit User: {editingUser.name}</h1>\n                <Card className=\"p-6 space-y-4\">\n                    <div><label className=\"text-sm text-brand-text-secondary\">Username</label><input type=\"text\" value={editingUser.name} onChange={e => setEditingUser({...editingUser, name: e.target.value})} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/></div>\n                    <div><label className=\"text-sm text-brand-text-secondary\">Email</label><input type=\"email\" value={editingUser.email} onChange={e => setEditingUser({...editingUser, email: e.target.value})} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/></div>\n                    <div><label className=\"text-sm text-brand-text-secondary\">New Password</label><input type=\"password\" value={newPassword} onChange={e => setNewPassword(e.target.value)} placeholder=\"Leave blank to keep current\" className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/></div>\n                    <div className=\"flex gap-4 pt-4\">\n                        <button onClick={handleSave} className=\"px-4 py-2 bg-brand-primary text-brand-bg rounded font-bold\">Save Changes</button>\n                        <button onClick={() => setEditingUser(null)} className=\"px-4 py-2 bg-gray-500 text-white rounded font-bold\">Cancel</button>\n                    </div>\n                </Card>\n                <Card className=\"p-6 space-y-4\">\n                    <h2 className=\"text-xl font-bold\">Balance Management</h2>\n                    <p>Current Balance: <span className=\"font-mono font-bold\">${editingUser.balance.toLocaleString()}</span></p>\n                    <div className=\"flex flex-col sm:flex-row gap-4 items-end\">\n                        <div className=\"flex-grow\">\n                            <label className=\"text-sm text-brand-text-secondary\">Amount (USD) to Add</label>\n                            <input type=\"number\" value={addBalanceAmount} onChange={e => setAddBalanceAmount(e.target.value === '' ? '' : parseFloat(e.target.value))} placeholder=\"e.g., 100\" className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/>\n                        </div>\n                        <div className=\"flex-grow\">\n                            <label className=\"text-sm text-brand-text-secondary\">Deposit Asset</label>\n                            <select value={addBalanceAsset} onChange={e => setAddBalanceAsset(e.target.value)} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\">\n                                {Object.keys(wallets).map(key => <option key={key} value={key}>{key}</option>)}\n                            </select>\n                        </div>\n                        <button onClick={handleAddBalance} className=\"px-4 py-2 bg-green-500 text-white rounded font-bold w-full sm:w-auto\"><PlusCircle size={16} className=\"inline mr-2\"/>Add Balance</button>\n                    </div>\n                </Card>\n            </div>\n        );\n    }\n\n\n    return (\n        <div className=\"space-y-6\">\n            <AnimatePresence>\n            {toast && <motion.div initial={{opacity: 0, y: 20}} animate={{opacity: 1, y: 0}} exit={{opacity: 0, y: 20}} className=\"fixed top-20 right-5 bg-brand-primary text-brand-bg p-3 rounded-lg shadow-lg z-50\">{toast}</motion.div>}\n            </AnimatePresence>\n            <div className=\"flex justify-between items-center\">\n                <h1 className=\"text-3xl font-bold\">Users Management</h1>\n                <button onClick={loadUsers} className=\"p-2 hover:bg-white/10 rounded-full\"><RefreshCw size={18} /></button>\n            </div>\n            <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-brand-text-secondary\" size={20}/>\n                <input type=\"text\" placeholder=\"Search by name or email...\" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className=\"w-full p-2 pl-10 bg-brand-surface rounded-lg border border-white/10\"/>\n            </div>\n            <Card className=\"p-2 sm:p-4 overflow-x-auto\">\n                 <table className=\"w-full min-w-[800px] text-left\">\n                    <thead><tr className=\"border-b border-white/20\"><th className=\"p-3\">Username</th><th className=\"p-3\">Email</th><th className=\"p-3\">Balance</th><th className=\"p-3\">Plan</th><th className=\"p-3\">Registered</th><th className=\"p-3\">Actions</th></tr></thead>\n                    <tbody>\n                        {filteredUsers.map(user => (\n                            <tr key={user.id} className=\"border-b border-white/10 last:border-b-0\">\n                                <td className=\"p-3\">{user.name}</td><td className=\"p-3\">{user.email}</td>\n                                <td className=\"p-3 font-mono\">${user.balance.toLocaleString()}</td>\n                                <td className=\"p-3\">{user.plan}</td>\n                                <td className=\"p-3 text-sm\">{new Date(user.registrationDate || 0).toLocaleDateString()}</td>\n                                <td className=\"p-3\"><div className=\"flex gap-2\">\n                                    <button onClick={() => setEditingUser(user)} className=\"p-2 hover:text-brand-primary\"><Edit2 size={16}/></button>\n                                    <button onClick={() => handleDelete(user.id)} className=\"p-2 hover:text-red-500\"><Trash2 size={16}/></button>\n                                </div></td>\n                            </tr>\n                        ))}\n                    </tbody>\n                 </table>\n                 {filteredUsers.length === 0 && <p className=\"text-center p-8 text-brand-text-secondary\">No users found.</p>}\n            </Card>\n        </div>\n    );\n};\n\nconst TransactionManagement: React.FC<{ type: 'Deposit' | 'Withdrawal' }> = ({ type }) => {\n    const [transactions, setTransactions] = useState<AdminTransaction[]>([]);\n    \n    const loadTransactions = useCallback(async () => {\n        const allTxs = await userDataService.getAllTransactions();\n        setTransactions(allTxs.filter(t => t.type === type));\n    }, [type]);\n\n    useEffect(() => {\n        loadTransactions();\n        const interval = setInterval(loadTransactions, 5000); // Auto-refresh\n        return () => clearInterval(interval);\n    }, [loadTransactions]);\n\n    const handleStatusChange = async (tx: AdminTransaction, status: 'Confirmed' | 'Failed') => {\n        await userDataService.updateTransactionStatus(tx.userId, tx.id, status);\n        loadTransactions();\n    };\n    \n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold\">{type}s Management</h1>\n            <Card className=\"p-2 sm:p-4 overflow-x-auto\">\n                <table className=\"w-full min-w-[800px] text-left\">\n                    <thead><tr className=\"border-b border-white/20\"><th className=\"p-3\">User</th><th className=\"p-3\">Date</th><th className=\"p-3\">Amount</th><th className=\"p-3\">Asset</th><th className=\"p-3\">Status</th><th className=\"p-3\">Actions</th></tr></thead>\n                    <tbody>\n                        {transactions.map(tx => (\n                            <tr key={tx.id} className=\"border-b border-white/10 last:border-b-0\">\n                                <td className=\"p-3\">{tx.userName}</td><td className=\"p-3 text-sm\">{new Date(tx.date).toLocaleString()}</td>\n                                <td className=\"p-3 font-mono\">${(tx.usdValue || tx.amount).toLocaleString()}</td><td>{tx.asset}</td>\n                                <td className=\"p-3\"><span className={`px-2 py-1 text-xs rounded-full ${tx.status === 'Confirmed' ? 'bg-green-500/20 text-green-400' : tx.status === 'Pending' ? 'bg-yellow-500/20 text-yellow-400' : 'bg-red-500/20 text-red-400'}`}>{tx.status}</span></td>\n                                <td className=\"p-3\">\n                                    {tx.status === 'Pending' && (\n                                        <div className=\"flex gap-2\">\n                                            <button onClick={() => handleStatusChange(tx, 'Confirmed')} className=\"px-3 py-1 bg-green-500/80 text-white text-xs rounded\">Confirm</button>\n                                            <button onClick={() => handleStatusChange(tx, 'Failed')} className=\"px-3 py-1 bg-red-500/80 text-white text-xs rounded\">Reject</button>\n                                        </div>\n                                    )}\n                                </td>\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n                 {transactions.length === 0 && <p className=\"text-center p-8 text-brand-text-secondary\">No {type.toLowerCase()}s found.</p>}\n            </Card>\n        </div>\n    );\n};\n\nconst DepositsManagement: React.FC = () => <TransactionManagement type=\"Deposit\" />;\nconst WithdrawalsManagement: React.FC = () => <TransactionManagement type=\"Withdrawal\" />;\n\nconst MessagingManagement: React.FC = () => {\n    const [messages, setMessages] = useState<Message[]>([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [editingMessage, setEditingMessage] = useState<Message | null>(null);\n\n    const loadMessages = useCallback(async () => {\n        setIsLoading(true);\n        const fetchedMessages = await userDataService.getMessages();\n        setMessages(fetchedMessages.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()));\n        setIsLoading(false);\n    }, []);\n\n    useEffect(() => {\n        loadMessages();\n    }, [loadMessages]);\n\n    const handleOpenModal = (message: Message | null = null) => {\n        setEditingMessage(message);\n        setIsModalOpen(true);\n    };\n\n    const handleCloseModal = () => {\n        setIsModalOpen(false);\n        setEditingMessage(null);\n    };\n\n    const handleSave = async (messageData: Omit<Message, 'id' | 'createdAt'>) => {\n        if (editingMessage) {\n            await userDataService.updateMessage(editingMessage.id, messageData);\n        } else {\n            await userDataService.addMessage(messageData);\n        }\n        loadMessages();\n        handleCloseModal();\n    };\n\n    const handleDelete = async (messageId: string) => {\n        if (window.confirm('Are you sure you want to delete this message?')) {\n            await userDataService.deleteMessage(messageId);\n            loadMessages();\n        }\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <h1 className=\"text-3xl font-bold\">Broadcast Messages</h1>\n                <button onClick={() => handleOpenModal()} className=\"flex items-center gap-2 px-4 py-2 bg-brand-primary text-brand-bg rounded-lg font-bold\"><PlusCircle size={18} /> New Message</button>\n            </div>\n\n            {isLoading ? <p>Loading messages...</p> : (\n                <div className=\"space-y-4\">\n                    {messages.length === 0 ? (\n                        <Card className=\"p-8 text-center text-brand-text-secondary\">No messages yet. Create one!</Card>\n                    ) : (\n                        messages.map(msg => (\n                            <Card key={msg.id} className=\"p-4 flex justify-between items-start\">\n                                <div>\n                                    <h3 className=\"font-bold text-lg text-white\">{msg.title}</h3>\n                                    <p className=\"text-sm text-brand-text-secondary mt-1\">{msg.text.substring(0, 100)}...</p>\n                                    <p className=\"text-xs text-brand-text-secondary/50 mt-2\">\n                                        Posted on {new Date(msg.createdAt).toLocaleString()}\n                                        {msg.recipientId ? <span className=\"ml-2 font-bold text-yellow-400\">[PRIVATE]</span> : <span className=\"ml-2 font-bold text-cyan-400\">[BROADCAST]</span>}\n                                        {msg.imageUrl && <span className=\"ml-2 font-bold\">[Image]</span>}\n                                        {msg.videoUrl && <span className=\"ml-2 font-bold\">[Video]</span>}\n                                    </p>\n                                </div>\n                                <div className=\"flex gap-2 flex-shrink-0 ml-4\">\n                                    <button onClick={() => handleOpenModal(msg)} className=\"p-2 hover:text-brand-primary\"><Edit2 size={16} /></button>\n                                    <button onClick={() => handleDelete(msg.id)} className=\"p-2 hover:text-red-500\"><Trash2 size={16} /></button>\n                                </div>\n                            </Card>\n                        ))\n                    )}\n                </div>\n            )}\n            <MessageEditorModal isOpen={isModalOpen} onClose={handleCloseModal} onSave={handleSave} message={editingMessage} />\n        </div>\n    );\n};\n\nconst MessageEditorModal: React.FC<{ isOpen: boolean; onClose: () => void; onSave: (data: any) => void; message: Message | null; }> = ({ isOpen, onClose, onSave, message }) => {\n    const [title, setTitle] = useState('');\n    const [text, setText] = useState('');\n    const [image, setImage] = useState<string | null>(null);\n    const [video, setVideo] = useState<string | null>(null);\n    const [recipientId, setRecipientId] = useState<string>('');\n    const [users, setUsers] = useState<UserData[]>([]);\n\n    useEffect(() => {\n        if (isOpen) {\n            userDataService.getAllUsersData().then(setUsers);\n            setTitle(message?.title || '');\n            setText(message?.text || '');\n            setImage(message?.imageUrl || null);\n            setVideo(message?.videoUrl || null);\n            setRecipientId(message?.recipientId || ''); // '' for broadcast\n        }\n    }, [message, isOpen]);\n\n    const fileToBase64 = (file: File): Promise<string> => {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(file);\n            reader.onload = () => resolve(reader.result as string);\n            reader.onerror = error => reject(error);\n        });\n    };\n\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>, type: 'image' | 'video') => {\n        const file = e.target.files?.[0];\n        if (file) {\n            const base64 = await fileToBase64(file);\n            if (type === 'image') setImage(base64);\n            if (type === 'video') setVideo(base64);\n        }\n    };\n    \n    const handleSubmit = () => {\n        onSave({ title, text, imageUrl: image, videoUrl: video, recipientId: recipientId || undefined });\n    };\n\n    return (\n        <AnimatePresence>\n        {isOpen && (\n            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className=\"fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4\">\n                <motion.div initial={{ scale: 0.9 }} animate={{ scale: 1 }} exit={{ scale: 0.9 }} className=\"bg-brand-surface border border-white/10 rounded-2xl w-full max-w-2xl p-6 space-y-4\">\n                    <h2 className=\"text-2xl font-bold\">{message ? 'Edit' : 'Create'} Message</h2>\n                    <div>\n                        <label className=\"text-sm text-brand-text-secondary\">Recipient</label>\n                        <select value={recipientId} onChange={e => setRecipientId(e.target.value)} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\">\n                            <option value=\"\">Broadcast to All Users</option>\n                            {users.map(user => <option key={user.id} value={user.id}>{user.name} ({user.email})</option>)}\n                        </select>\n                    </div>\n                    <input type=\"text\" placeholder=\"Title\" value={title} onChange={e => setTitle(e.target.value)} className=\"w-full p-2 bg-brand-bg rounded border border-white/20\"/>\n                    <textarea placeholder=\"Text content...\" value={text} onChange={e => setText(e.target.value)} rows={5} className=\"w-full p-2 bg-brand-bg rounded border border-white/20\"/>\n                    \n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                            <label className=\"text-sm text-brand-text-secondary\">Image (optional)</label>\n                            <input type=\"file\" accept=\"image/*\" onChange={e => handleFileChange(e, 'image')} className=\"w-full mt-1 p-1 file:mr-4 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-brand-primary/20 file:text-brand-primary hover:file:bg-brand-primary/40 text-sm text-brand-text-secondary bg-brand-bg rounded border border-white/20\"/>\n                            {image && <img src={image} alt=\"preview\" className=\"mt-2 h-24 rounded\"/>}\n                        </div>\n                         <div>\n                            <label className=\"text-sm text-brand-text-secondary\">Video (optional)</label>\n                            <input type=\"file\" accept=\"video/*\" onChange={e => handleFileChange(e, 'video')} className=\"w-full mt-1 p-1 file:mr-4 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-brand-primary/20 file:text-brand-primary hover:file:bg-brand-primary/40 text-sm text-brand-text-secondary bg-brand-bg rounded border border-white/20\"/>\n                            {video && <video src={video} className=\"mt-2 h-24 rounded\" controls />}\n                        </div>\n                    </div>\n\n                    <div className=\"flex justify-end gap-4 pt-4\">\n                        <button onClick={onClose} className=\"px-4 py-2 bg-gray-500 text-white rounded font-bold\">Cancel</button>\n                        <button onClick={handleSubmit} className=\"px-4 py-2 bg-brand-primary text-brand-bg rounded font-bold\">Save</button>\n                    </div>\n                </motion.div>\n            </motion.div>\n        )}\n        </AnimatePresence>\n    );\n};\n\nconst TestimonialsManagement: React.FC = () => {\n    const [testimonials, setTestimonials] = useState<Testimonial[]>([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [editingTestimonial, setEditingTestimonial] = useState<Testimonial | null>(null);\n\n    const loadTestimonials = useCallback(async () => {\n        setIsLoading(true);\n        const data = await userDataService.getTestimonials();\n        setTestimonials(data);\n        setIsLoading(false);\n    }, []);\n\n    useEffect(() => {\n        loadTestimonials();\n    }, [loadTestimonials]);\n\n    const handleSave = async (testimonial: Testimonial) => {\n        await userDataService.updateTestimonial(testimonial.id, testimonial);\n        setEditingTestimonial(null);\n        loadTestimonials();\n    };\n\n    const handleDelete = async (testimonialId: string) => {\n        if (window.confirm('Are you sure you want to delete this testimonial?')) {\n            await userDataService.deleteTestimonial(testimonialId);\n            loadTestimonials();\n        }\n    };\n    \n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold\">Testimonials Management</h1>\n            {isLoading ? <p>Loading...</p> : (\n                <Card className=\"p-2 sm:p-4 overflow-x-auto\">\n                    <table className=\"w-full min-w-[800px] text-left\">\n                        <thead><tr className=\"border-b border-white/20\"><th className=\"p-3\">Date</th><th className=\"p-3\">Name</th><th className=\"p-3\">Rating</th><th className=\"p-3\">Text</th><th className=\"p-3\">Reply</th><th className=\"p-3\">Actions</th></tr></thead>\n                        <tbody>\n                            {testimonials.map(t => (\n                                <tr key={t.id} className=\"border-b border-white/10 last:border-b-0\">\n                                    <td className=\"p-3 text-sm align-top\">{new Date(t.createdAt).toLocaleDateString()}</td>\n                                    <td className=\"p-3 align-top\">{t.name || 'Anonymous'}</td>\n                                    <td className=\"p-3 align-top\">{t.rating} ★</td>\n                                    <td className=\"p-3 text-sm max-w-xs align-top truncate\">{t.text}</td>\n                                    <td className=\"p-3 text-sm max-w-xs align-top truncate\">{t.adminReply || 'N/A'}</td>\n                                    <td className=\"p-3 align-top\">\n                                        <div className=\"flex gap-2\">\n                                            <button onClick={() => setEditingTestimonial(t)} className=\"p-2 hover:text-brand-primary\"><Edit2 size={16}/></button>\n                                            <button onClick={() => handleDelete(t.id)} className=\"p-2 hover:text-red-500\"><Trash2 size={16}/></button>\n                                        </div>\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </Card>\n            )}\n            <TestimonialEditorModal \n                isOpen={!!editingTestimonial}\n                onClose={() => setEditingTestimonial(null)}\n                onSave={handleSave}\n                testimonial={editingTestimonial}\n            />\n        </div>\n    );\n};\n\nconst TestimonialEditorModal: React.FC<{\n    isOpen: boolean;\n    onClose: () => void;\n    onSave: (data: Testimonial) => void;\n    testimonial: Testimonial | null;\n}> = ({ isOpen, onClose, onSave, testimonial }) => {\n    const [editedTestimonial, setEditedTestimonial] = useState<Testimonial | null>(null);\n\n    useEffect(() => {\n        if (testimonial) {\n            setEditedTestimonial({ ...testimonial });\n        }\n    }, [testimonial]);\n\n    const handleSave = () => {\n        if (editedTestimonial) {\n            onSave(editedTestimonial);\n        }\n    };\n    \n    if (!editedTestimonial) return null;\n\n    return (\n        <AnimatePresence>\n            {isOpen && (\n                <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className=\"fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4\">\n                    <motion.div initial={{ scale: 0.9 }} animate={{ scale: 1 }} exit={{ scale: 0.9 }} className=\"bg-brand-surface border border-white/10 rounded-2xl w-full max-w-2xl p-6 space-y-4\">\n                        <h2 className=\"text-2xl font-bold\">Edit Testimonial</h2>\n                        <div>\n                            <label className=\"text-sm text-brand-text-secondary\">Text</label>\n                            <textarea value={editedTestimonial.text} onChange={e => setEditedTestimonial({...editedTestimonial, text: e.target.value})} rows={4} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/>\n                        </div>\n                        <div>\n                            <label className=\"text-sm text-brand-text-secondary\">Admin Reply</label>\n                            <textarea value={editedTestimonial.adminReply || ''} onChange={e => setEditedTestimonial({...editedTestimonial, adminReply: e.target.value})} rows={4} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/>\n                        </div>\n                        <div className=\"flex justify-end gap-4 pt-4\">\n                            <button onClick={onClose} className=\"px-4 py-2 bg-gray-500 text-white rounded font-bold\">Cancel</button>\n                            <button onClick={handleSave} className=\"px-4 py-2 bg-brand-primary text-brand-bg rounded font-bold\">Save</button>\n                        </div>\n                    </motion.div>\n                </motion.div>\n            )}\n        </AnimatePresence>\n    );\n};\n\n\nconst WalletSettings: React.FC = () => {\n    const [wallets, setWallets] = useState<WalletConfig>({});\n    const [saveStatus, setSaveStatus] = useState('');\n    \n    useEffect(() => {\n        userDataService.getWalletConfig().then(setWallets);\n    }, []);\n\n    const handleSave = async () => {\n        await userDataService.saveWalletConfig(wallets);\n        setSaveStatus('Saved!');\n        setTimeout(() => setSaveStatus(''), 2000);\n    };\n\n    const handleWalletChange = (symbol: string, field: string, value: string) => {\n        const isNumeric = ['minWithdrawal', 'withdrawalFee'].includes(field);\n        setWallets(prev => ({\n            ...prev,\n            [symbol]: { ...prev[symbol], [field]: isNumeric ? parseFloat(value) || 0 : value }\n        }));\n    };\n    \n    const handleFileChange = (symbol: string, e: React.ChangeEvent<HTMLInputElement>) => {\n        const file = e.target.files?.[0];\n        if (file) {\n            const reader = new FileReader();\n            reader.onloadend = () => {\n                handleWalletChange(symbol, 'qrCodeUrl', reader.result as string);\n            };\n            reader.readAsDataURL(file);\n        }\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold\">Wallet Settings</h1>\n            <div className=\"space-y-4\">\n                {Object.values(wallets).map((wallet: WalletType) => (\n                    <Card key={wallet.symbol} className=\"p-6\">\n                        <h3 className=\"text-xl font-bold mb-4 text-brand-primary\">{wallet.name} ({wallet.symbol})</h3>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div className=\"space-y-4\">\n                                <div><label className=\"text-sm text-brand-text-secondary\">Address</label><input type=\"text\" value={wallet.address} onChange={e => handleWalletChange(wallet.symbol, 'address', e.target.value)} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/></div>\n                                <div><label className=\"text-sm text-brand-text-secondary\">Network</label><input type=\"text\" value={wallet.network} onChange={e => handleWalletChange(wallet.symbol, 'network', e.target.value)} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/></div>\n                                <div><label className=\"text-sm text-brand-text-secondary\">Min Withdrawal ({wallet.symbol})</label><input type=\"number\" step=\"any\" value={wallet.minWithdrawal || ''} onChange={e => handleWalletChange(wallet.symbol, 'minWithdrawal', e.target.value)} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/></div>\n                                <div><label className=\"text-sm text-brand-text-secondary\">Withdrawal Fee ({wallet.symbol})</label><input type=\"number\" step=\"any\" value={wallet.withdrawalFee || ''} onChange={e => handleWalletChange(wallet.symbol, 'withdrawalFee', e.target.value)} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/></div>\n                            </div>\n                            <div className=\"space-y-2\">\n                                <div><label className=\"text-sm text-brand-text-secondary\">QR Code Image</label><input type=\"file\" accept=\"image/*\" onChange={e => handleFileChange(wallet.symbol, e)} className=\"w-full mt-1 p-1 file:mr-4 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-brand-primary/20 file:text-brand-primary hover:file:bg-brand-primary/40 text-sm text-brand-text-secondary bg-brand-bg rounded border border-white/20\"/></div>\n                                {wallet.qrCodeUrl && <img src={wallet.qrCodeUrl} alt=\"QR Code\" className=\"w-24 h-24 p-1 bg-white rounded-lg\"/>}\n                            </div>\n                        </div>\n                    </Card>\n                ))}\n            </div>\n            <div className=\"flex items-center gap-4\">\n                <button onClick={handleSave} className=\"px-6 py-3 bg-brand-primary text-brand-bg font-bold rounded-lg\"><Save className=\"inline-block mr-2\"/>Save Settings</button>\n                {saveStatus && <span className=\"text-green-400\">{saveStatus}</span>}\n            </div>\n        </div>\n    );\n};\n\nconst SystemSettingsComponent: React.FC = () => {\n    const [settings, setSettings] = useState<SystemSettings | null>(null);\n\n    useEffect(() => {\n        userDataService.getSystemSettings().then(setSettings);\n    }, []);\n\n    if (!settings) return <div>Loading...</div>;\n\n    const handleSave = async () => {\n        await userDataService.saveSystemSettings(settings);\n        alert('System settings saved!');\n    };\n    \n    const handleBackup = () => {\n        const backupData: Record<string, string> = {};\n        for (let i = 0; i < localStorage.length; i++) {\n            const key = localStorage.key(i);\n            if (key && key.startsWith('tradepilot_')) {\n                backupData[key] = localStorage.getItem(key)!;\n            }\n        }\n        const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `tradepilot_backup_${new Date().toISOString().split('T')[0]}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold\">System Settings</h1>\n            <Card className=\"p-6 space-y-4\">\n                <div><label>Site Name</label><input type=\"text\" value={settings.siteName} onChange={e => setSettings({...settings, siteName: e.target.value})} className=\"w-full mt-1 p-2 bg-brand-bg rounded\"/></div>\n                <div><label>Description</label><textarea value={settings.description} onChange={e => setSettings({...settings, description: e.target.value})} className=\"w-full mt-1 p-2 bg-brand-bg rounded\"/></div>\n                <div><label>Logo URL</label><input type=\"text\" value={settings.logoUrl} onChange={e => setSettings({...settings, logoUrl: e.target.value})} className=\"w-full mt-1 p-2 bg-brand-bg rounded\"/></div>\n                <div className=\"flex items-center justify-between\"><label>Maintenance Mode</label><input type=\"checkbox\" checked={settings.maintenanceMode} onChange={e => setSettings({...settings, maintenanceMode: e.target.checked})} className=\"w-5 h-5\"/></div>\n            </Card>\n            \n            <Card className=\"p-6 space-y-4\">\n                <h2 className=\"text-xl font-bold text-brand-primary\">reCAPTCHA Settings</h2>\n                <p className=\"text-sm text-brand-text-secondary\">Enable reCAPTCHA to protect login and registration pages from bots.</p>\n                <div className=\"flex items-center justify-between border-b border-white/10 pb-4\">\n                    <label className=\"font-semibold\">Enable reCAPTCHA</label>\n                    <input type=\"checkbox\" checked={settings.recaptchaEnabled || false} onChange={e => setSettings({...settings, recaptchaEnabled: e.target.checked})} className=\"w-5 h-5\"/>\n                </div>\n                {settings.recaptchaEnabled && (\n                    <>\n                        <div>\n                            <label className=\"text-sm text-brand-text-secondary\">reCAPTCHA Site Key (Client-side)</label>\n                            <input type=\"text\" placeholder=\"6Lc...\" value={settings.recaptchaSiteKey || ''} onChange={e => setSettings({...settings, recaptchaSiteKey: e.target.value})} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/>\n                            <p className=\"text-xs text-brand-text-secondary mt-1\">Get your keys from <a href=\"https://www.google.com/recaptcha/admin\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-brand-primary hover:underline\">Google reCAPTCHA Admin</a></p>\n                        </div>\n                        <div>\n                            <label className=\"text-sm text-brand-text-secondary\">reCAPTCHA Secret Key (Server-side)</label>\n                            <input type=\"password\" placeholder=\"6Lc...\" value={settings.recaptchaSecretKey || ''} onChange={e => setSettings({...settings, recaptchaSecretKey: e.target.value})} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/>\n                            <p className=\"text-xs text-brand-text-secondary mt-1\">This key is used for server-side verification (kept private)</p>\n                        </div>\n                        <div className=\"p-3 bg-green-500/10 border border-green-400/50 rounded-lg text-green-300 text-sm\">\n                            ✓ When enabled, users must complete reCAPTCHA verification on login and registration pages.\n                        </div>\n                    </>\n                )}\n                {!settings.recaptchaEnabled && (\n                    <div className=\"p-3 bg-yellow-500/10 border border-yellow-400/50 rounded-lg text-yellow-300 text-sm\">\n                        ⚠ reCAPTCHA is currently disabled. Login and registration will work without verification.\n                    </div>\n                )}\n            </Card>\n            <div className=\"flex gap-4\">\n                 <button onClick={handleSave} className=\"px-6 py-3 bg-brand-primary text-brand-bg font-bold rounded-lg\"><Save className=\"inline-block mr-2\"/>Save Settings</button>\n                 <button onClick={handleBackup} className=\"px-6 py-3 bg-brand-secondary text-white font-bold rounded-lg\"><FileDown className=\"inline-block mr-2\"/>Backup Data</button>\n            </div>\n        </div>\n    );\n};\n\nexport default AdminPanel;","size_bytes":45662},"components/dashboard/BottomNavBar.tsx":{"content":"import React from 'react';\nimport { motion } from 'framer-motion';\nimport { DashboardView } from '../Dashboard';\n\n// --- 3D SVG Icons ---\n// Each icon is designed to have a 3D feel with gradients and a glowing effect when active.\n\n// FIX: Changed the component to be explicitly typed as React.FC to resolve a props-related type error.\nconst IconWrapper: React.FC<{ children: React.ReactNode, isActive: boolean }> = ({ children, isActive }) => (\n  <motion.div\n    className=\"relative w-7 h-7 flex items-center justify-center\"\n    animate={{ scale: isActive ? 1.15 : 1, y: isActive ? -5 : 0 }}\n    transition={{ type: 'spring', stiffness: 400, damping: 15 }}\n  >\n    {children}\n  </motion.div>\n);\n\nconst SVGDefs = () => (\n    <svg width=\"0\" height=\"0\" style={{ position: 'absolute' }}>\n        <defs>\n            <linearGradient id=\"iconGradActive\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                <stop offset=\"0%\" stopColor=\"#00f5ff\" />\n                <stop offset=\"100%\" stopColor=\"#e040fb\" />\n            </linearGradient>\n            <linearGradient id=\"iconGradInactive\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                <stop offset=\"0%\" stopColor=\"#a0a0b0\" />\n                <stop offset=\"100%\" stopColor=\"#e0e0e0\" />\n            </linearGradient>\n            <filter id=\"iconGlow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n                <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"1\" result=\"blur\" />\n                <feMerge>\n                <feMergeNode in=\"blur\" />\n                <feMergeNode in=\"SourceGraphic\" />\n                </feMerge>\n            </filter>\n        </defs>\n    </svg>\n);\n\n\nconst OverviewIcon: React.FC<{isActive: boolean}> = ({ isActive }) => (\n    <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g style={{ filter: isActive ? 'url(#iconGlow)' : 'none' }}>\n            <path d=\"M3 10H10V3H3V10Z\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M14 10H21V3H14V10Z\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M14 21H21V14H14V21Z\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M3 21H10V14H3V21Z\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n        </g>\n    </svg>\n);\n\nconst DepositIcon: React.FC<{isActive: boolean}> = ({ isActive }) => (\n    <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g style={{ filter: isActive ? 'url(#iconGlow)' : 'none' }}>\n            <path d=\"M12 3V15M12 15L16 11M12 15L8 11\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M3 12C3 16.9706 7.02944 21 12 21C16.9706 21 21 16.9706 21 12\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n        </g>\n    </svg>\n);\n\nconst WithdrawIcon: React.FC<{isActive: boolean}> = ({ isActive }) => (\n    <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g style={{ filter: isActive ? 'url(#iconGlow)' : 'none' }}>\n            <path d=\"M12 21V9M12 9L16 13M12 9L8 13\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n        </g>\n    </svg>\n);\n\n// FIX: Changed the component to be explicitly typed as React.FC to resolve a props-related type error.\nconst AIPlanIcon: React.FC<{isActive: boolean}> = ({ isActive }) => (\n    <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g style={{ filter: isActive ? 'url(#iconGlow)' : 'none' }}>\n            <path d=\"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.3.05-3.11.64-1.14 1.05-2.28 1.05-3.39 0-3.31-2.69-6-6-6s-6 2.69-6 6c0 1.11.41 2.25 1.05 3.39-.65.81-.66 2.27.05 3.11z\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M12.5 9.5c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3z\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M19.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.3.05-3.11.64-1.14 1.05-2.28 1.05-3.39 0-3.31-2.69-6-6-6s-6 2.69-6 6c0 1.11.41 2.25 1.05 3.39-.65.81-.66 2.27.05 3.11z\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n        </g>\n    </svg>\n);\n\nconst ReferralIcon: React.FC<{isActive: boolean}> = ({ isActive }) => (\n    <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g style={{ filter: isActive ? 'url(#iconGlow)' : 'none' }}>\n            <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <circle cx=\"8.5\" cy=\"7\" r=\"4\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M20 8v6\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M23 11h-6\" stroke={isActive ? \"url(#iconGradActive)\" : \"url(#iconGradInactive)\"} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n        </g>\n    </svg>\n);\n\n\ninterface BottomNavBarProps {\n    activeView: DashboardView;\n    setActiveView: (view: DashboardView) => void;\n}\n\nconst BottomNavBar: React.FC<BottomNavBarProps> = ({ activeView, setActiveView }) => {\n    const navItems: { view: DashboardView; icon: React.FC<{ isActive: boolean }>; label: string }[] = [\n        { view: 'overview', icon: OverviewIcon, label: 'Overview' },\n        { view: 'deposit', icon: DepositIcon, label: 'Deposit' },\n        { view: 'withdraw', icon: WithdrawIcon, label: 'Withdraw' },\n        { view: 'plans', icon: AIPlanIcon, label: 'AI Plan' },\n        { view: 'referrals', icon: ReferralIcon, label: 'Referral' },\n    ];\n\n    return (\n        <motion.div\n            initial={{ y: \"100%\", opacity: 0 }}\n            animate={{ y: \"0%\", opacity: 1 }}\n            transition={{ duration: 0.7, ease: [0.22, 1, 0.36, 1], delay: 0.5 }}\n            className=\"fixed bottom-0 left-0 right-0 p-3 z-30 lg:hidden\"\n        >\n            <SVGDefs />\n            <div className=\"relative mx-auto max-w-sm bg-black/30 backdrop-blur-xl border border-white/10 rounded-[2rem] p-2 flex justify-around items-center shadow-[0px_8px_25px_rgba(0,0,0,0.6)]\">\n                 <div className=\"absolute inset-0 border-2 border-brand-primary/50 rounded-[2rem] blur-sm pointer-events-none animate-pulse\"></div>\n                 <div className=\"absolute inset-0 border border-brand-primary/80 rounded-[2rem] pointer-events-none\"></div>\n\n                {navItems.map(({ view, icon: Icon, label }) => {\n                    const isActive = activeView === view;\n                    return (\n                        <motion.button\n                            key={view}\n                            onClick={() => setActiveView(view)}\n                            className=\"relative flex flex-col items-center justify-center gap-1.5 transition-colors w-full h-full py-2 rounded-full z-10\"\n                            whileTap={{ scale: 0.9 }}\n                            whileHover={{ y: -2 }}\n                        >\n                            {isActive && (\n                                <motion.div\n                                    layoutId=\"active-pill-glow\"\n                                    className=\"absolute inset-0 bg-gradient-to-br from-brand-primary/30 to-brand-secondary/30 rounded-full\"\n                                    style={{ borderRadius: 9999 }}\n                                    transition={{ type: 'spring', duration: 0.6, bounce: 0.3 }}\n                                />\n                            )}\n                            <IconWrapper isActive={isActive}>\n                                <Icon isActive={isActive} />\n                            </IconWrapper>\n                            <span className={`text-xs transition-colors ${isActive ? 'text-white font-bold' : 'text-brand-text-secondary'}`}>{label}</span>\n                        </motion.button>\n                    );\n                })}\n            </div>\n        </motion.div>\n    );\n};\n\nexport default BottomNavBar;","size_bytes":9186},"components/WelcomePage.tsx":{"content":"\n\nimport React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { getWelcomePageTemplate } from '../services/userDataService';\nimport { WelcomePageTemplate } from '../types';\nimport { DashboardView } from './Dashboard';\nimport { Mail, LayoutDashboard } from 'lucide-react';\nimport AuthBackground from './auth/AuthBackground';\n\ninterface WelcomePageProps {\n  onNavigate: (destination: DashboardView) => void;\n}\n\nconst WelcomePage: React.FC<WelcomePageProps> = ({ onNavigate }) => {\n  const [template, setTemplate] = useState<WelcomePageTemplate | null>(null);\n\n  useEffect(() => {\n    const fetchTemplate = async () => {\n      const data = await getWelcomePageTemplate();\n      setTemplate(data);\n    };\n    fetchTemplate();\n  }, []);\n\n  const backdropVariants = {\n    hidden: { opacity: 0 },\n    visible: { opacity: 1 },\n    exit: { opacity: 0 },\n  };\n\n  const cardVariants = {\n    hidden: { opacity: 0, y: 50, scale: 0.95 },\n    visible: { \n      opacity: 1, \n      y: 0, \n      scale: 1, \n      transition: { \n        duration: 0.7, \n        ease: [0.22, 1, 0.36, 1] as [number, number, number, number]\n      } \n    },\n    exit: { opacity: 0, y: -50, scale: 0.95, transition: { duration: 0.4 } }\n  };\n\n  return (\n    <motion.div\n      className=\"relative w-full min-h-screen overflow-hidden flex items-center justify-center p-4 font-sans\"\n      variants={backdropVariants}\n      initial=\"hidden\"\n      animate=\"visible\"\n      exit=\"exit\"\n    >\n        <AuthBackground />\n        <motion.div\n            variants={cardVariants}\n            className=\"relative z-10 w-full max-w-2xl bg-brand-surface/30 backdrop-blur-2xl border border-white/10 rounded-3xl p-8 shadow-2xl text-center\"\n        >\n            <AnimatePresence mode=\"wait\">\n            {template ? (\n                <motion.div\n                    key=\"content\"\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    exit={{ opacity: 0 }}\n                >\n                    <motion.h1 \n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0, transition: { delay: 0.2, duration: 0.5 } }}\n                        className=\"text-3xl md:text-4xl font-bold text-white mb-4\"\n                    >\n                        {template.title}\n                    </motion.h1>\n\n                    {template.imageUrl && (\n                        <motion.img \n                            src={template.imageUrl} \n                            alt=\"Welcome Visual\" \n                            className=\"my-6 rounded-lg max-h-60 mx-auto\"\n                            initial={{ opacity: 0, scale: 0.8 }}\n                            animate={{ opacity: 1, scale: 1, transition: { delay: 0.4, duration: 0.5 } }}\n                        />\n                    )}\n                    {template.videoUrl && (\n                        <motion.video \n                            src={template.videoUrl} \n                            controls \n                            className=\"my-6 rounded-lg w-full max-w-md mx-auto\"\n                            initial={{ opacity: 0, scale: 0.8 }}\n                            animate={{ opacity: 1, scale: 1, transition: { delay: 0.4, duration: 0.5 } }}\n                        />\n                    )}\n                    \n                    <motion.p \n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0, transition: { delay: 0.6, duration: 0.5 } }}\n                        className=\"text-brand-text-secondary max-w-lg mx-auto mb-8 whitespace-pre-wrap\"\n                    >\n                        {template.text}\n                    </motion.p>\n                    \n                    <motion.div \n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0, transition: { delay: 0.8, duration: 0.5 } }}\n                        className=\"flex flex-col sm:flex-row justify-center items-center gap-4\"\n                    >\n                        <motion.button \n                            onClick={() => onNavigate('inbox')}\n                            className=\"w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-brand-secondary text-white font-bold rounded-full transition-all duration-300 hover:scale-105 hover:shadow-[0_0_20px_theme(colors.brand.secondary)]\"\n                            whileHover={{ scale: 1.05 }}\n                            whileTap={{ scale: 0.95 }}\n                        >\n                            <Mail size={18} /> Go to Inbox\n                        </motion.button>\n                        <motion.button \n                            onClick={() => onNavigate('overview')}\n                            className=\"w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-brand-primary text-brand-bg font-bold rounded-full transition-all duration-300 hover:scale-105 hover:shadow-[0_0_20px_theme(colors.brand.primary)]\"\n                            whileHover={{ scale: 1.05 }}\n                            whileTap={{ scale: 0.95 }}\n                        >\n                             <LayoutDashboard size={18} /> Go to Dashboard\n                        </motion.button>\n                    </motion.div>\n                </motion.div>\n            ) : (\n                <motion.div key=\"loader\" className=\"h-96 flex items-center justify-center\">\n                    <div className=\"w-12 h-12 border-4 border-brand-primary border-t-transparent rounded-full animate-spin\"></div>\n                </motion.div>\n            )}\n            </AnimatePresence>\n        </motion.div>\n    </motion.div>\n  );\n};\n\nexport default WelcomePage;","size_bytes":5750},"components/dashboard/InboxPage.tsx":{"content":"import React, { useState, useEffect, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { UserData, Message } from '../../types';\nimport * as userDataService from '../../services/userDataService';\nimport DashboardPageLayout, { InteractiveCard } from './DashboardPageLayout';\nimport { MessageSquare, Mail } from 'lucide-react';\n\ninterface InboxPageProps {\n    user: UserData;\n}\n\nconst InboxPage: React.FC<InboxPageProps> = ({ user }) => {\n    const [messages, setMessages] = useState<Message[]>([]);\n    const [isLoading, setIsLoading] = useState(true);\n\n    const loadMessages = useCallback(async () => {\n        setIsLoading(true);\n        const fetchedMessages = await userDataService.getMessages();\n        // Filter messages: show broadcast (no recipientId) and messages for this user\n        const userMessages = fetchedMessages.filter(msg => !msg.recipientId || msg.recipientId === user.id);\n        setMessages(userMessages.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()));\n        setIsLoading(false);\n    }, [user.id]);\n\n    useEffect(() => {\n        loadMessages();\n    }, [loadMessages]);\n\n    return (\n        <DashboardPageLayout title=\"Inbox\" icon={<MessageSquare size={28} />}>\n            {isLoading ? (\n                <div className=\"flex items-center justify-center h-48\">\n                    <div className=\"w-12 h-12 border-4 border-brand-primary border-t-transparent rounded-full animate-spin\"></div>\n                </div>\n            ) : messages.length === 0 ? (\n                <InteractiveCard className=\"p-8 text-center flex flex-col items-center justify-center h-48\">\n                    <Mail size={40} className=\"text-brand-text-secondary mb-4\" />\n                    <p className=\"text-brand-text-secondary\">Your inbox is empty.</p>\n                </InteractiveCard>\n            ) : (\n                <div className=\"space-y-4\">\n                    {messages.map((msg, index) => (\n                        <motion.div\n                            key={msg.id}\n                            initial={{ opacity: 0, y: 20 }}\n                            animate={{ opacity: 1, y: 0 }}\n                            transition={{ duration: 0.5, delay: index * 0.1 }}\n                        >\n                            <InteractiveCard className=\"p-6\">\n                                <h3 className=\"text-xl font-bold text-white mb-2\">{msg.title}</h3>\n                                {msg.imageUrl && <img src={msg.imageUrl} alt=\"Message visual\" className=\"my-4 rounded-lg max-h-64 w-auto\" />}\n                                {msg.videoEmbedHtml && <div className=\"my-4 rounded-lg overflow-hidden\" dangerouslySetInnerHTML={{ __html: msg.videoEmbedHtml }} />}\n                                {!msg.videoEmbedHtml && msg.videoUrl && <video src={msg.videoUrl} controls className=\"my-4 rounded-lg w-full max-w-sm\" />}\n                                <p className=\"text-brand-text-secondary whitespace-pre-wrap\">{msg.text}</p>\n                                <p className=\"text-xs text-brand-text-secondary/60 mt-4 text-right\">\n                                    {new Date(msg.createdAt).toLocaleString()}\n                                </p>\n                            </InteractiveCard>\n                        </motion.div>\n                    ))}\n                </div>\n            )}\n        </DashboardPageLayout>\n    );\n};\n\nexport default InboxPage;","size_bytes":3435},"components/admin/AdminLoginModal.tsx":{"content":"\nimport React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X } from 'lucide-react';\n\ninterface AdminLoginModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onLogin: (password: string) => boolean;\n}\n\nconst AdminLoginModal: React.FC<AdminLoginModalProps> = ({ isOpen, onClose, onLogin }) => {\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    if (!onLogin(password)) {\n      setError('Invalid Admin Password');\n      setTimeout(() => setError(''), 2000);\n    } else {\n        setPassword('');\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          className=\"fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          onClick={onClose}\n        >\n          <motion.div\n            className=\"bg-brand-surface/50 backdrop-blur-xl border border-white/10 rounded-2xl w-full max-w-sm p-8 shadow-2xl relative\"\n            initial={{ scale: 0.9, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            exit={{ scale: 0.9, opacity: 0 }}\n            transition={{ type: 'spring', stiffness: 300, damping: 25 }}\n            onClick={(e) => e.stopPropagation()}\n          >\n            <button onClick={onClose} className=\"absolute top-4 right-4 text-brand-text-secondary hover:text-white\"><X/></button>\n            <h2 className=\"text-2xl font-bold text-center mb-2 text-brand-primary\">Admin Access</h2>\n            <p className=\"text-center text-brand-text-secondary mb-6\">Enter password to continue.</p>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <input\n                type=\"password\"\n                placeholder=\"Password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary focus:outline-none focus:border-brand-primary transition-all duration-300 shadow-[inset_0_2px_4px_rgba(0,0,0,0.5)]\"\n              />\n              \n              <AnimatePresence>\n              {error && \n                <motion.p \n                    initial={{ opacity: 0, height: 0 }}\n                    animate={{ opacity: 1, height: 'auto' }}\n                    exit={{ opacity: 0, height: 0 }}\n                    className=\"text-red-400 text-sm text-center\">{error}</motion.p>}\n              </AnimatePresence>\n              \n              <button\n                type=\"submit\"\n                className=\"w-full py-3 bg-gradient-to-br from-brand-primary to-brand-secondary text-brand-bg font-bold rounded-lg shadow-lg shadow-brand-primary/20 hover:shadow-xl hover:shadow-brand-primary/40 transform hover:-translate-y-1 transition-all duration-300\"\n              >\n                Login\n              </button>\n            </form>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default AdminLoginModal;\n","size_bytes":3209},"types.ts":{"content":"\n\nexport interface User {\n  id: string;\n  name: string;\n  email: string;\n  password?: string;\n  country?: string;\n  plan: string;\n  balance: number;\n  totalProfit: number;\n  hasSeenWelcome: boolean;\n  registrationDate?: string;\n  notificationPermission?: 'granted' | 'denied' | 'default';\n  isVerified: boolean;\n}\n\nexport interface Transaction {\n  id:string;\n  type: 'Deposit' | 'Withdrawal' | 'Profit' | 'Investment';\n  amount: number;\n  date: string;\n  status: 'Pending' | 'Confirmed' | 'Failed';\n  asset: string;\n  fee?: number;\n  txid?: string;\n  usdValue?: number;\n}\n\nexport interface AdminTransaction extends Transaction {\n  userId: string;\n  userName: string;\n}\n\nexport interface Plan {\n    name: string;\n    price: string;\n    features: string[];\n    isCurrent: boolean;\n}\n\nexport type AspectRatio = \"1:1\" | \"16:9\" | \"9:16\" | \"4:3\" | \"3:4\";\n\nexport interface ReferralData {\n    count: number;\n    earnings: number;\n    link: string;\n}\n\nexport interface ActivePlan {\n    name: string;\n    investment: number;\n    dailyReturn: number;\n    duration: number;\n    activationDate?: string;\n    isActive: boolean;\n    lastProfitDate?: string;\n}\n\nexport interface LoginSession {\n  id: string;\n  loggedInAt: string;\n  device: string; // e.g., \"Chrome on Windows\"\n  ipAddress: string; // e.g., \"192.168.1.1\" (simulated)\n  isCurrent: boolean;\n}\n\nexport interface LogEntry {\n  id: string;\n  date: string;\n  action: string;\n  details: string;\n}\n\nexport interface NotificationPreferences {\n  email: {\n    profitAlerts: boolean;\n    systemAlerts: boolean;\n    inboxMessages: boolean;\n  };\n  push: {\n    profitAlerts: boolean;\n    systemAlerts: boolean;\n    inboxMessages: boolean;\n  }\n}\n\nexport interface UserData extends User {\n    transactions: Transaction[];\n    referrals: ReferralData;\n    activePlan?: ActivePlan;\n    sessions: LoginSession[];\n    loginHistory: LogEntry[];\n    updateHistory: LogEntry[];\n    notificationPreferences: NotificationPreferences;\n    verificationCode?: string;\n    verificationCodeExpires?: string;\n}\n\nexport interface SystemSettings {\n    siteName: string;\n    description: string;\n    logoUrl: string;\n    maintenanceMode: boolean;\n    recaptchaEnabled: boolean;\n    recaptchaSiteKey?: string;\n    recaptchaSecretKey?: string;\n}\n\nexport interface PublicSystemSettings {\n    siteName: string;\n    description: string;\n    logoUrl: string;\n    maintenanceMode: boolean;\n    recaptchaEnabled: boolean;\n    recaptchaSiteKey?: string;\n}\n\nexport interface Wallet {\n    name: string;\n    symbol: string;\n    address: string;\n    qrCodeUrl: string;\n    network: string;\n    minDeposit?: number;\n    minWithdrawal?: number;\n    withdrawalFee?: number;\n}\n\nexport interface WalletConfig {\n    [key: string]: Wallet;\n}\n\nexport interface Message {\n  id: string;\n  title: string;\n  text: string;\n  imageUrl?: string; // base64 encoded\n  videoUrl?: string; // base64 encoded\n  videoEmbedHtml?: string; // Permanent embedded video HTML\n  createdAt: string;\n  recipientId?: string; // If undefined, it's a broadcast message\n}\n\nexport interface WelcomePageTemplate {\n  title: string;\n  text: string;\n  imageUrl?: string;\n  videoUrl?: string;\n}\n\nexport interface WelcomeInboxMessageTemplate {\n  title: string;\n  text: string;\n  imageUrl?: string;\n  videoUrl?: string;\n  videoEmbedHtml?: string; // Permanent embedded video HTML\n}\n\nexport interface Testimonial {\n    id: string;\n    name?: string;\n    email?: string;\n    text: string;\n    rating: number;\n    createdAt: string;\n    adminReply?: string;\n    adminReplyAt?: string;\n}\n\n\n// --- Chatbot Types ---\n\nexport interface ChatMessage {\n  role: 'user' | 'assistant';\n  content: string;\n}\n\nexport type ApiKeyStatus = 'active' | 'failed' | 'rate-limited';\n\nexport interface ApiKeyStats {\n  key: string;\n  status: ApiKeyStatus;\n  usageCount: number;\n  lastUsed: string | null;\n}\n\nexport interface ChatbotSettings {\n  personality: string;\n  apiKeys: ApiKeyStats[];\n  iconText: string;\n}","size_bytes":3947},"components/TestimonialsPage.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { Testimonial } from '../types';\nimport { getTestimonials } from '../services/userDataService';\nimport { Star, MessageSquare, ArrowLeft, ArrowRight } from 'lucide-react';\nimport HomePageBackground from './three/HomePageBackground';\n\nconst StarRating: React.FC<{ rating: number }> = ({ rating }) => (\n    <div className=\"flex gap-1\">\n        {[...Array(5)].map((_, i) => (\n            <Star key={i} size={16} className={i < rating ? 'text-yellow-400 fill-yellow-400' : 'text-gray-600'} />\n        ))}\n    </div>\n);\n\nconst TestimonialCard: React.FC<{ testimonial: Testimonial }> = ({ testimonial }) => (\n    <motion.div \n        className=\"bg-brand-surface/20 backdrop-blur-lg border border-white/10 rounded-2xl p-6 h-full flex flex-col\"\n        layout\n        initial={{ opacity: 0, scale: 0.9 }}\n        animate={{ opacity: 1, scale: 1 }}\n        exit={{ opacity: 0, scale: 0.9 }}\n        transition={{ duration: 0.4, ease: \"easeOut\" }}\n    >\n        <div className=\"flex justify-between items-start mb-3\">\n            <div>\n                <p className=\"font-bold text-white\">{testimonial.name || 'Anonymous'}</p>\n                <p className=\"text-xs text-brand-text-secondary\">{new Date(testimonial.createdAt).toLocaleDateString()}</p>\n            </div>\n            <StarRating rating={testimonial.rating} />\n        </div>\n        <p className=\"text-brand-text italic flex-grow\">\"{testimonial.text}\"</p>\n        {testimonial.adminReply && (\n            <div className=\"mt-4 pt-4 border-t border-white/10\">\n                <div className=\"flex items-start gap-3\">\n                    <MessageSquare size={18} className=\"text-brand-primary mt-1 flex-shrink-0\" />\n                    <div>\n                        <p className=\"font-bold text-brand-primary text-sm\">Reply from TradePilot AI</p>\n                        <p className=\"text-brand-text-secondary text-sm italic\">\"{testimonial.adminReply}\"</p>\n                    </div>\n                </div>\n            </div>\n        )}\n    </motion.div>\n);\n\nconst TestimonialsPage: React.FC<{ onNavigate: (view: 'homepage') => void }> = ({ onNavigate }) => {\n    const [testimonials, setTestimonials] = useState<Testimonial[]>([]);\n    const [currentPage, setCurrentPage] = useState(1);\n    const testimonialsPerPage = 7;\n\n    useEffect(() => {\n        const fetchTestimonials = async () => {\n            const data = await getTestimonials();\n            setTestimonials(data);\n        };\n        fetchTestimonials();\n    }, []);\n\n    const totalPages = Math.ceil(testimonials.length / testimonialsPerPage);\n    const paginatedTestimonials = testimonials.slice(\n        (currentPage - 1) * testimonialsPerPage,\n        currentPage * testimonialsPerPage\n    );\n\n    return (\n        <motion.div \n            className=\"min-h-screen bg-brand-bg text-brand-text font-sans relative\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n        >\n            <HomePageBackground />\n            <div className=\"relative z-10 max-w-4xl mx-auto px-4 py-16 sm:py-24\">\n                <motion.button \n                    onClick={() => onNavigate('homepage')} \n                    className=\"flex items-center gap-2 text-brand-text-secondary hover:text-white transition-colors mb-8\"\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0, transition: { delay: 0.2 } }}\n                >\n                    <ArrowLeft size={20} /> Back to Home\n                </motion.button>\n                <motion.div \n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    transition={{ duration: 0.8, ease: \"easeOut\" }}\n                    className=\"text-center mb-12\"\n                >\n                    <h1 className=\"text-4xl sm:text-5xl font-bold text-white\">What Our Users Say</h1>\n                    <p className=\"text-lg text-brand-text-secondary mt-4\">Real feedback from the TradePilot AI community.</p>\n                </motion.div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    {paginatedTestimonials.map(testimonial => (\n                        <TestimonialCard key={testimonial.id} testimonial={testimonial} />\n                    ))}\n                </div>\n\n                {totalPages > 1 && (\n                    <motion.div \n                        className=\"flex justify-center items-center gap-4 mt-12\"\n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0, transition: { delay: 0.5 } }}\n                    >\n                        <button \n                            onClick={() => setCurrentPage(p => Math.max(1, p - 1))} \n                            disabled={currentPage === 1}\n                            className=\"p-2 rounded-full bg-brand-surface/50 hover:bg-white/10 disabled:opacity-50 transition-colors\"\n                        >\n                            <ArrowLeft size={20} />\n                        </button>\n                        <span className=\"font-mono text-brand-text-secondary\">Page <span className=\"text-white\">{currentPage}</span> of <span className=\"text-white\">{totalPages}</span></span>\n                        <button \n                            onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} \n                            disabled={currentPage === totalPages}\n                            className=\"p-2 rounded-full bg-brand-surface/50 hover:bg-white/10 disabled:opacity-50 transition-colors\"\n                        >\n                            <ArrowRight size={20} />\n                        </button>\n                    </motion.div>\n                )}\n            </div>\n        </motion.div>\n    );\n};\n\nexport default TestimonialsPage;","size_bytes":5921},"components/dashboard/HistoryPage.tsx":{"content":"\nimport React from 'react';\nimport { Transaction } from '../../types';\nimport DashboardPageLayout, { InteractiveCard } from './DashboardPageLayout';\nimport { LineChart as HistoryIcon } from 'lucide-react';\n\nconst formatCurrency = (value: number) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n\nconst HistoryPage: React.FC<{ transactions: Transaction[] }> = ({ transactions }) => (\n    <DashboardPageLayout title=\"Transaction History\" icon={<HistoryIcon size={28} />}>\n        <InteractiveCard className=\"p-4 sm:p-6\">\n            {transactions.length === 0 ? (<p className=\"text-center text-brand-text-secondary py-12\">No transactions yet.</p>) : (\n            <div className=\"overflow-x-auto\">\n                <table className=\"w-full text-left min-w-[600px]\">\n                    <thead>\n                        <tr className=\"border-b border-white/10 text-brand-text-secondary\">\n                            <th className=\"p-4\">Type</th> <th className=\"p-4\">Amount</th> <th className=\"p-4\">Asset</th> <th className=\"p-4\">Date</th> <th className=\"p-4\">Status</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {[...transactions].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()).map(tx => (\n                            <tr key={tx.id} className=\"border-b border-white/10 last:border-b-0\">\n                                <td className=\"p-4\">{tx.type}</td>\n                                <td className={`p-4 font-mono ${tx.type === 'Deposit' || tx.type === 'Profit' ? 'text-green-400' : 'text-red-400'}`}>{tx.type === 'Deposit' || tx.type === 'Profit' ? '+' : '-'}{formatCurrency(tx.usdValue || tx.amount)}</td>\n                                <td className=\"p-4\">{tx.asset}</td>\n                                <td className=\"p-4 text-sm\">{new Date(tx.date).toLocaleString()}</td>\n                                <td className=\"p-4\"><span className={`px-2 py-1 rounded-full text-xs ${tx.status === 'Confirmed' ? 'bg-green-500/20 text-green-400' : tx.status === 'Pending' ? 'bg-yellow-500/20 text-yellow-400' : 'bg-red-500/20 text-red-400'}`}>{tx.status}</span></td>\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n            </div>\n            )}\n        </InteractiveCard>\n    </DashboardPageLayout>\n);\n\nexport default HistoryPage;\n","size_bytes":2439},"components/dashboard/ProfilePage.tsx":{"content":"\nimport React, { useState, useMemo, useCallback } from 'react';\nimport { UserData, NotificationPreferences, LoginSession, LogEntry } from '../../types';\nimport { updateUserData, logoutAllSessions, deleteUser, requestNotificationPermission } from '../../services/userDataService';\nimport DashboardPageLayout, { InteractiveCard } from './DashboardPageLayout';\nimport { User as UserIcon, Shield, Bell, History, AlertTriangle, Check, X, LogOut, Trash2, Save, Eye, EyeOff } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\ntype ProfileTab = 'account' | 'security' | 'notifications' | 'logs' | 'actions';\n\nconst ProfilePage: React.FC<{ user: UserData; showToast: (msg: string, type?: 'success' | 'error') => void; onUpdate: () => void; onLogout: () => void; }> = ({ user, showToast, onUpdate, onLogout }) => {\n    const [activeTab, setActiveTab] = useState<ProfileTab>('account');\n\n    const tabs: { id: ProfileTab; label: string; icon: React.ReactNode }[] = [\n        { id: 'account', label: 'Account', icon: <UserIcon size={18} /> },\n        { id: 'security', label: 'Security', icon: <Shield size={18} /> },\n        { id: 'notifications', label: 'Notifications', icon: <Bell size={18} /> },\n        { id: 'logs', label: 'Logs', icon: <History size={18} /> },\n        { id: 'actions', label: 'Actions', icon: <AlertTriangle size={18} /> },\n    ];\n\n    const renderContent = () => {\n        switch (activeTab) {\n            case 'account': return <AccountSettings user={user} showToast={showToast} onUpdate={onUpdate} />;\n            case 'security': return <SecuritySettings user={user} showToast={showToast} onUpdate={onUpdate} onLogoutAll={onLogout} />;\n            case 'notifications': return <NotificationSettings user={user} showToast={showToast} onUpdate={onUpdate} />;\n            case 'logs': return <LogsView user={user} />;\n            case 'actions': return <AccountActions user={user} showToast={showToast} onLogout={onLogout} />;\n            default: return null;\n        }\n    };\n\n    return (\n        <DashboardPageLayout title=\"Profile Settings\" icon={<UserIcon size={28} />}>\n            <div className=\"flex flex-col lg:flex-row gap-8\">\n                {/* Tab Navigation */}\n                <aside className=\"lg:w-1/4\">\n                    <InteractiveCard className=\"p-4\">\n                        <nav className=\"flex lg:flex-col gap-2\">\n                            {tabs.map(tab => (\n                                <button\n                                    key={tab.id}\n                                    onClick={() => setActiveTab(tab.id)}\n                                    className={`relative w-full flex items-center gap-3 text-left p-3 rounded-lg transition-all duration-300 ${activeTab === tab.id ? 'text-white' : 'text-brand-text-secondary hover:bg-white/5 hover:text-white'}`}\n                                >\n                                    {activeTab === tab.id && (\n                                        <motion.div\n                                            layoutId=\"profileTabIndicator\"\n                                            className=\"absolute inset-0 bg-brand-primary/10 rounded-lg z-0\"\n                                            transition={{ type: 'spring', stiffness: 300, damping: 25 }}\n                                        />\n                                    )}\n                                    <span className={`relative z-10 ${activeTab === tab.id ? 'text-brand-primary' : ''}`}>{tab.icon}</span>\n                                    <span className=\"relative z-10 text-sm font-semibold\">{tab.label}</span>\n                                </button>\n                            ))}\n                        </nav>\n                    </InteractiveCard>\n                </aside>\n\n                {/* Tab Content */}\n                <main className=\"lg:w-3/4\">\n                    <AnimatePresence mode=\"wait\">\n                        <motion.div\n                            key={activeTab}\n                            initial={{ opacity: 0, y: 20 }}\n                            animate={{ opacity: 1, y: 0 }}\n                            exit={{ opacity: 0, y: -20 }}\n                            transition={{ duration: 0.3 }}\n                        >\n                            <InteractiveCard className=\"p-6 md:p-8 min-h-[400px]\">\n                                {renderContent()}\n                            </InteractiveCard>\n                        </motion.div>\n                    </AnimatePresence>\n                </main>\n            </div>\n        </DashboardPageLayout>\n    );\n};\n\n// --- Sub-components for each tab ---\n\nconst SectionTitle: React.FC<{ title: string }> = ({ title }) => (\n    <h2 className=\"text-xl font-bold text-white mb-6 border-b-2 border-brand-primary/30 pb-3\">{title}</h2>\n);\n\nconst FormInput: React.FC<React.InputHTMLAttributes<HTMLInputElement> & { label: string, icon?: React.ReactNode }> = ({ label, icon, ...props }) => (\n    <div>\n        <label className=\"block text-brand-text-secondary mb-2 text-sm\">{label}</label>\n        <div className=\"relative\">\n            {icon && <div className=\"absolute left-3 top-1/2 -translate-y-1/2 text-brand-text-secondary\">{icon}</div>}\n            <input {...props} className={`w-full bg-brand-bg/50 border-2 border-white/10 rounded-lg p-3 text-white placeholder-brand-text-secondary transition-all duration-300 glow-input ${icon ? 'pl-10' : ''}`} />\n        </div>\n    </div>\n);\n\nconst ActionButton = React.forwardRef<HTMLButtonElement, React.ButtonHTMLAttributes<HTMLButtonElement> & { variant?: 'primary' | 'danger' | 'secondary' }>(\n    ({ children, variant = 'primary', className, ...props }, ref) => {\n        const baseClasses = \"px-6 py-2 font-bold rounded-lg transition-all duration-300 transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed\";\n        const variantClasses = {\n            primary: 'bg-brand-primary text-brand-bg shadow-lg shadow-brand-primary/20 hover:shadow-brand-primary/40',\n            danger: 'bg-red-600 text-white shadow-lg shadow-red-600/20 hover:shadow-red-600/40',\n            secondary: 'bg-white/10 text-white hover:bg-white/20',\n        };\n        return <button ref={ref} className={`${baseClasses} ${variantClasses[variant]} ${className}`} {...props}>{children}</button>\n    }\n);\n\n\nconst AccountSettings: React.FC<{ user: UserData; showToast: (msg: string) => void; onUpdate: () => void; }> = ({ user, showToast, onUpdate }) => {\n    const [name, setName] = useState(user.name);\n    const [email, setEmail] = useState(user.email);\n    const [country, setCountry] = useState(user.country || '');\n    const [isSaving, setIsSaving] = useState(false);\n\n    const handleSave = async () => {\n        if (!name || !email) {\n            showToast(\"Name and email cannot be empty.\", 'error');\n            return;\n        }\n        setIsSaving(true);\n        await updateUserData(user.id, { name, email, country });\n        showToast('Profile Saved!');\n        onUpdate();\n        setIsSaving(false);\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <SectionTitle title=\"Account Information\" />\n            <div className=\"space-y-4\">\n                <FormInput label=\"Username\" value={name} onChange={e => setName(e.target.value)} />\n                <FormInput label=\"Email Address\" type=\"email\" value={email} onChange={e => setEmail(e.target.value)} />\n                <FormInput label=\"Country\" value={country} onChange={e => setCountry(e.target.value)} placeholder=\"e.g. United States\" />\n            </div>\n            <div className=\"mt-8 flex justify-end\">\n                <ActionButton onClick={handleSave} disabled={isSaving}>\n                    {isSaving ? 'Saving...' : <><Save size={16} className=\"inline mr-2\" /> Save Changes</>}\n                </ActionButton>\n            </div>\n        </div>\n    );\n};\n\nconst SecuritySettings: React.FC<{ user: UserData; showToast: (msg: string, type?: 'success'|'error') => void; onUpdate: () => void; onLogoutAll: () => void; }> = ({ user, showToast, onUpdate, onLogoutAll }) => {\n    const [currentPassword, setCurrentPassword] = useState('');\n    const [newPassword, setNewPassword] = useState('');\n    const [confirmPassword, setConfirmPassword] = useState('');\n    const [isSaving, setIsSaving] = useState(false);\n    const [showLogoutModal, setShowLogoutModal] = useState(false);\n    const [showPass, setShowPass] = useState(false);\n\n    const handleChangePassword = async () => {\n        if(currentPassword !== user.password) {\n            showToast(\"Incorrect current password.\", 'error'); return;\n        }\n        if(!newPassword || newPassword.length < 6) {\n            showToast(\"New password must be at least 6 characters.\", 'error'); return;\n        }\n        if (newPassword !== confirmPassword) {\n            showToast(\"New passwords do not match.\", 'error'); return;\n        }\n        setIsSaving(true);\n        await updateUserData(user.id, { password: newPassword });\n        showToast('Password updated successfully!');\n        onUpdate();\n        setCurrentPassword(''); setNewPassword(''); setConfirmPassword('');\n        setIsSaving(false);\n    }\n    \n    const handleLogoutAll = async () => {\n        await logoutAllSessions(user.id);\n        showToast(\"Logged out from all devices.\");\n        onLogoutAll();\n    }\n\n    return (\n        <div className=\"space-y-8\">\n            <div>\n                <SectionTitle title=\"Change Password\" />\n                <div className=\"space-y-4\">\n                    <FormInput label=\"Current Password\" type={showPass ? 'text' : 'password'} value={currentPassword} onChange={e => setCurrentPassword(e.target.value)} />\n                    <FormInput label=\"New Password\" type={showPass ? 'text' : 'password'} value={newPassword} onChange={e => setNewPassword(e.target.value)} />\n                    <FormInput label=\"Confirm New Password\" type={showPass ? 'text' : 'password'} value={confirmPassword} onChange={e => setConfirmPassword(e.target.value)} />\n                    <div className=\"flex items-center gap-2 text-sm text-brand-text-secondary cursor-pointer\" onClick={() => setShowPass(!showPass)}>\n                        {showPass ? <EyeOff size={16}/> : <Eye size={16} />}\n                        <span>{showPass ? 'Hide' : 'Show'} Passwords</span>\n                    </div>\n                </div>\n                 <div className=\"mt-6 flex justify-end\">\n                    <ActionButton onClick={handleChangePassword} disabled={isSaving}>\n                        {isSaving ? 'Updating...' : 'Update Password'}\n                    </ActionButton>\n                </div>\n            </div>\n            <div>\n                 <SectionTitle title=\"Active Sessions\" />\n                 <ul className=\"space-y-3\">\n                    {user.sessions?.map(session => (\n                        <li key={session.id} className=\"flex justify-between items-center p-3 bg-brand-bg/30 rounded-lg\">\n                            <div>\n                                <p className=\"font-semibold text-white\">{session.device} {session.isCurrent && <span className=\"text-xs text-green-400\">(Current)</span>}</p>\n                                <p className=\"text-xs text-brand-text-secondary\">IP: {session.ipAddress} - Logged in: {new Date(session.loggedInAt).toLocaleString()}</p>\n                            </div>\n                        </li>\n                    ))}\n                 </ul>\n                 <div className=\"mt-6 flex justify-end\">\n                    <ActionButton variant=\"danger\" onClick={() => setShowLogoutModal(true)}>\n                        <LogOut size={16} className=\"inline mr-2\" /> Logout From All Devices\n                    </ActionButton>\n                 </div>\n            </div>\n            <ConfirmationModal \n                isOpen={showLogoutModal}\n                onClose={() => setShowLogoutModal(false)}\n                onConfirm={handleLogoutAll}\n                title=\"Logout From All Devices?\"\n                message=\"This will sign you out of TradePilot AI on all other computers and devices. You will need to log in again.\"\n            />\n        </div>\n    );\n};\n\nconst NotificationSettings: React.FC<{ user: UserData; showToast: (msg: string, type?: 'success' | 'error') => void; onUpdate: () => void; }> = ({ user, showToast, onUpdate }) => {\n    const [prefs, setPrefs] = useState<NotificationPreferences>(user.notificationPreferences);\n    const [isSaving, setIsSaving] = useState(false);\n\n    const handleToggle = (category: 'email' | 'push', type: keyof NotificationPreferences['email']) => {\n        setPrefs(p => ({\n            ...p,\n            [category]: { ...p[category], [type]: !p[category][type] }\n        }));\n    };\n\n    const handleSave = async () => {\n        setIsSaving(true);\n        await updateUserData(user.id, { notificationPreferences: prefs });\n        showToast('Notification settings saved!');\n        onUpdate();\n        setIsSaving(false);\n    };\n\n    const handleRequestPush = async () => {\n        const permission = await requestNotificationPermission();\n        // FIX: Handle the 'unsupported' case from requestNotificationPermission to prevent a type error.\n        if (permission === 'unsupported') {\n            showToast('This browser does not support notifications.', 'error');\n            return;\n        }\n\n        if(permission === 'granted') showToast(\"Push notifications enabled!\");\n        if(permission === 'denied') showToast(\"Push notifications blocked by browser.\", 'error');\n        await updateUserData(user.id, { notificationPermission: permission });\n        onUpdate();\n    };\n    \n    const Toggle: React.FC<{ checked: boolean, onChange: () => void, label: string }> = ({ checked, onChange, label }) => (\n        <div className=\"flex items-center justify-between p-3 bg-brand-bg/30 rounded-lg\">\n            <span className=\"text-white\">{label}</span>\n            <button onClick={onChange} className={`relative w-12 h-6 rounded-full transition-colors ${checked ? 'bg-brand-primary' : 'bg-gray-600'}`}>\n                <motion.div layout className={`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full`} style={{ x: checked ? '100%' : '0%' }}/>\n            </button>\n        </div>\n    );\n\n    return (\n        <div className=\"space-y-8\">\n            <div>\n                <SectionTitle title=\"Push Notifications\" />\n                {user.notificationPermission === 'denied' ? (\n                     <div className=\"p-4 bg-yellow-500/10 border border-yellow-400/50 rounded-lg text-yellow-300 text-sm\">\n                        Notifications are blocked. You need to enable them in your browser settings.\n                    </div>\n                ) : user.notificationPermission !== 'granted' ? (\n                    <ActionButton onClick={handleRequestPush}>Enable Browser Notifications</ActionButton>\n                ) : (\n                    <div className=\"space-y-2\">\n                        <Toggle checked={prefs.push.profitAlerts} onChange={() => handleToggle('push', 'profitAlerts')} label=\"Profit Alerts\" />\n                        <Toggle checked={prefs.push.systemAlerts} onChange={() => handleToggle('push', 'systemAlerts')} label=\"System Alerts\" />\n                        <Toggle checked={prefs.push.inboxMessages} onChange={() => handleToggle('push', 'inboxMessages')} label=\"New Inbox Messages\" />\n                    </div>\n                )}\n            </div>\n            <div>\n                <SectionTitle title=\"Email Notifications\" />\n                <div className=\"space-y-2\">\n                    <Toggle checked={prefs.email.profitAlerts} onChange={() => handleToggle('email', 'profitAlerts')} label=\"Profit Alerts\" />\n                    <Toggle checked={prefs.email.systemAlerts} onChange={() => handleToggle('email', 'systemAlerts')} label=\"System Alerts\" />\n                    <Toggle checked={prefs.email.inboxMessages} onChange={() => handleToggle('email', 'inboxMessages')} label=\"New Inbox Messages\" />\n                </div>\n            </div>\n             <div className=\"mt-8 flex justify-end\">\n                <ActionButton onClick={handleSave} disabled={isSaving}>\n                    {isSaving ? 'Saving...' : <><Save size={16} className=\"inline mr-2\" /> Save Preferences</>}\n                </ActionButton>\n            </div>\n        </div>\n    );\n};\n\nconst LogsView: React.FC<{ user: UserData }> = ({ user }) => {\n    const LogTable: React.FC<{ title: string; logs: LogEntry[] }> = ({ title, logs }) => (\n        <div>\n            <h3 className=\"text-lg font-semibold text-white mb-3\">{title}</h3>\n            <div className=\"max-h-60 overflow-y-auto pr-2\">\n                <table className=\"w-full text-left text-sm\">\n                    <thead>\n                        <tr className=\"border-b border-white/10 text-brand-text-secondary\"><th className=\"p-2\">Date</th><th className=\"p-2\">Action</th><th className=\"p-2\">Details</th></tr>\n                    </thead>\n                    <tbody>\n                        {logs?.map(log => (\n                            <tr key={log.id} className=\"border-b border-white/10 last:border-0\"><td className=\"p-2 align-top\">{new Date(log.date).toLocaleString()}</td><td className=\"p-2 align-top\">{log.action}</td><td className=\"p-2 align-top\">{log.details}</td></tr>\n                        ))}\n                    </tbody>\n                </table>\n                 {(!logs || logs.length === 0) && <p className=\"text-center text-brand-text-secondary p-8\">No logs found.</p>}\n            </div>\n        </div>\n    );\n    return (\n        <div className=\"space-y-8\">\n            <SectionTitle title=\"Account Logs\" />\n            <LogTable title=\"Login History\" logs={user.loginHistory} />\n            <LogTable title=\"Profile Update History\" logs={user.updateHistory} />\n        </div>\n    );\n};\n\nconst AccountActions: React.FC<{ user: UserData; showToast: (msg: string) => void; onLogout: () => void; }> = ({ user, showToast, onLogout }) => {\n    const [showDeleteModal, setShowDeleteModal] = useState(false);\n\n    const handleReset = () => {\n        showToast(\"Account reset request submitted. Check your email.\");\n    };\n\n    const handleDelete = async () => {\n        await deleteUser(user.id);\n        showToast(\"Account deleted successfully.\");\n        onLogout();\n    };\n\n    return (\n        <div className=\"space-y-8\">\n            <SectionTitle title=\"Account Actions\" />\n            <div className=\"p-4 bg-yellow-500/10 border border-yellow-400/50 rounded-lg text-yellow-300\">\n                <p className=\"font-bold mb-2 flex items-center gap-2\"><AlertTriangle/> Important Actions</p>\n                <p className=\"text-sm\">These actions are permanent and may result in data loss. Please proceed with caution.</p>\n            </div>\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between p-4 bg-brand-bg/30 rounded-lg\">\n                <div>\n                    <h3 className=\"font-bold text-white\">Request Account Reset</h3>\n                    <p className=\"text-sm text-brand-text-secondary\">This will send a reset link to your email. (Simulated)</p>\n                </div>\n                <ActionButton variant=\"secondary\" onClick={handleReset} className=\"mt-4 md:mt-0\">Request Reset</ActionButton>\n            </div>\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between p-4 bg-brand-bg/30 rounded-lg border border-red-500/50\">\n                <div>\n                    <h3 className=\"font-bold text-red-400\">Delete Account</h3>\n                    <p className=\"text-sm text-brand-text-secondary\">This will permanently delete your account and all associated data.</p>\n                </div>\n                <ActionButton variant=\"danger\" onClick={() => setShowDeleteModal(true)} className=\"mt-4 md:mt-0\">\n                    <Trash2 size={16} className=\"inline mr-2\" /> Delete Account\n                </ActionButton>\n            </div>\n            <ConfirmationModal \n                isOpen={showDeleteModal}\n                onClose={() => setShowDeleteModal(false)}\n                onConfirm={handleDelete}\n                title=\"Permanently Delete Account?\"\n                message={`Are you sure you want to delete your account? All your data, including balance and transaction history, will be lost forever. This action cannot be undone.`}\n                confirmText=\"Yes, Delete My Account\"\n                variant='danger'\n            />\n        </div>\n    );\n};\n\n\nconst ConfirmationModal: React.FC<{\n    isOpen: boolean; onClose: () => void; onConfirm: () => void; title: string; message: string; confirmText?: string; variant?: 'primary' | 'danger';\n}> = ({ isOpen, onClose, onConfirm, title, message, confirmText = \"Confirm\", variant = 'primary' }) => (\n    <AnimatePresence>\n    {isOpen && (\n        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} onClick={onClose} className=\"fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4\">\n            <motion.div initial={{ scale: 0.9, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} exit={{ scale: 0.9, opacity: 0 }} onClick={e => e.stopPropagation()} className=\"bg-brand-surface border border-white/10 rounded-2xl w-full max-w-md p-6 relative\">\n                 <button onClick={onClose} className=\"absolute top-3 right-3 p-1 rounded-full hover:bg-white/10\"><X size={20} /></button>\n                 <h2 className=\"text-xl font-bold text-white mb-4\">{title}</h2>\n                 <p className=\"text-brand-text-secondary mb-6\">{message}</p>\n                 <div className=\"flex justify-end gap-4\">\n                     <ActionButton variant=\"secondary\" onClick={onClose}>Cancel</ActionButton>\n                     <ActionButton variant={variant} onClick={onConfirm}>{confirmText}</ActionButton>\n                 </div>\n            </motion.div>\n        </motion.div>\n    )}\n    </AnimatePresence>\n)\n\nexport default ProfilePage;","size_bytes":21968},"components/chatbot/Chatbot.tsx":{"content":"\nimport React, { useState, useEffect } from 'react';\nimport { AnimatePresence } from 'framer-motion';\nimport { ChatbotSettings, User, ChatMessage } from '../../types';\nimport { getChatbotSettings } from '../../services/userDataService';\nimport { generateChatResponse } from '../../services/cerebrasService';\nimport ChatIcon from './ChatIcon';\nimport ChatWindow from './ChatWindow';\n\ninterface ChatbotProps {\n    user: User;\n}\n\nconst Chatbot: React.FC<ChatbotProps> = ({ user }) => {\n    const [isOpen, setIsOpen] = useState(false);\n    const [hasNewMessage, setHasNewMessage] = useState(false);\n    const [settings, setSettings] = useState<ChatbotSettings | null>(null);\n\n    // New state for the greeting bubble\n    const [showGreetingBubble, setShowGreetingBubble] = useState(false);\n    const [greetingMessage, setGreetingMessage] = useState('');\n\n    useEffect(() => {\n        getChatbotSettings().then(setSettings);\n    }, []);\n\n    // Effect to trigger the greeting bubble\n    useEffect(() => {\n        const greetingTimer = setTimeout(async () => {\n            if (!isOpen) { // Show on every refresh if chat is not open\n                try {\n                    const prompt: ChatMessage[] = [{\n                        role: 'user',\n                        content: `Generate a short, friendly, and professional greeting for a user named \"${user.name}\" who has just logged into a crypto trading platform. The message should be welcoming, use their name, and invite them to ask questions. Keep it concise (under 20 words) and use one or two emojis. For example: \"👋 Hey ${user.name}, great to see you! Need help or have questions? I'm always here for you 🤝🤖\"`\n                    }];\n                    const response = await generateChatResponse(prompt);\n                    setGreetingMessage(response);\n                    setShowGreetingBubble(true);\n                } catch (error) {\n                    console.error(\"Failed to generate greeting:\", error);\n                    // Fallback greeting\n                    setGreetingMessage(`Hi ${user.name}! Ready to explore the future of trading?`);\n                    setShowGreetingBubble(true);\n                }\n            }\n        }, 5000); // 5-second delay\n\n        return () => clearTimeout(greetingTimer);\n    }, [isOpen, user.name]);\n\n    // Effect to hide the bubble after 8 seconds\n    useEffect(() => {\n        if (showGreetingBubble) {\n            const hideTimer = setTimeout(() => {\n                setShowGreetingBubble(false);\n            }, 8000); // 8-second visibility\n\n            return () => clearTimeout(hideTimer);\n        }\n    }, [showGreetingBubble]);\n\n    const handleOpen = () => {\n        setIsOpen(true);\n        setHasNewMessage(false);\n        setShowGreetingBubble(false); // Hide bubble when chat opens\n    };\n\n    const handleClose = () => {\n        setIsOpen(false);\n    };\n\n    const handleNewAiMessage = () => {\n        if (!isOpen) {\n            setHasNewMessage(true);\n        }\n    };\n\n    if (!settings) {\n        return null; // Don't render anything until settings are loaded\n    }\n\n    return (\n        <>\n            <AnimatePresence>\n                {isOpen ? (\n                    <ChatWindow \n                        onClose={handleClose} \n                        onNewAiMessage={handleNewAiMessage}\n                    />\n                ) : (\n                    <ChatIcon \n                        onClick={handleOpen} \n                        hasNewMessage={hasNewMessage}\n                        text={settings.iconText}\n                        showGreetingBubble={showGreetingBubble}\n                        greetingMessage={greetingMessage}\n                    />\n                )}\n            </AnimatePresence>\n        </>\n    );\n};\n\nexport default Chatbot;\n","size_bytes":3792},"components/dashboard/PlansPage.tsx":{"content":"import React, { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { UserData } from '../../types';\nimport DashboardPageLayout from './DashboardPageLayout';\nimport { investInPlan, activatePlan } from '../../services/userDataService';\nimport { Bot, CheckCircle, Cpu, Gem, Rocket, X, Zap } from 'lucide-react';\n\nconst formatCurrency = (value: number) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n\nconst AI_PLANS_DATA = [\n    { name: 'Starter AI Bot', dailyReturn: 17.5, minDeposit: 50, maxDeposit: 500, duration: 30, totalROI: 525.0, features: ['Real-time market scanning', 'Basic risk management', '24/7 automated trading'], buttonText: 'Select Plan', isPopular: false, icon: <Cpu size={28}/>, color: 'brand-primary' },\n    { name: 'Professional AI Bot', dailyReturn: 25.2, minDeposit: 500, maxDeposit: 2500, duration: 60, totalROI: 1512.0, features: ['Multi-exchange arbitrage', 'Advanced algorithms', 'Priority support', 'Risk diversification'], buttonText: 'Select Plan', isPopular: true, icon: <Zap size={28}/>, color: 'brand-secondary' },\n    { name: 'Elite AI Bot', dailyReturn: 38.4, minDeposit: 2500, maxDeposit: 10000, duration: 90, totalROI: 3456.0, features: ['Institutional-grade algorithms', 'Cross-chain arbitrage', 'Dedicated account manager', 'Custom strategies', 'VIP support'], buttonText: 'Select Plan', isPopular: false, icon: <Gem size={28} />, color: 'brand-accent' },\n];\n\nconst PlansPage: React.FC<{ userData: UserData; showToast: (msg: string, type?: 'success' | 'error') => void; onUpdate: () => void; }> = ({ userData, showToast, onUpdate }) => {\n    const [selectedPlan, setSelectedPlan] = useState<typeof AI_PLANS_DATA[0] | null>(null);\n    const [investmentAmount, setInvestmentAmount] = useState<string>('');\n\n    const handleSelectPlan = (plan: typeof AI_PLANS_DATA[0]) => {\n        if (userData.activePlan) return;\n        setSelectedPlan(plan);\n    };\n\n    const handleConfirmInvestment = async () => {\n        if (!selectedPlan) return;\n        const amount = parseFloat(investmentAmount);\n\n        if(isNaN(amount) || amount <= 0) {\n            showToast('Invalid amount', 'error'); return;\n        }\n        if (amount < selectedPlan.minDeposit || amount > selectedPlan.maxDeposit) {\n            showToast('Amount is outside plan limits', 'error'); return;\n        }\n        if(amount > userData.balance) {\n            showToast('Insufficient balance', 'error'); return;\n        }\n\n        const updatedData = await investInPlan(userData.id, selectedPlan, amount);\n        if (updatedData) {\n            showToast(`Successfully invested in ${selectedPlan.name}!`);\n            onUpdate();\n        } else {\n            showToast('Investment failed. Check your balance.', 'error');\n        }\n        \n        setSelectedPlan(null);\n        setInvestmentAmount('');\n    };\n    \n    const handlePlanActivation = async () => {\n        if (!userData || !userData.activePlan) return;\n        const updatedData = await activatePlan(userData.id);\n        if (updatedData) {\n            showToast(`${updatedData.activePlan?.name} has been activated!`);\n            onUpdate();\n        } else {\n            showToast('Activation failed.', 'error');\n        }\n    };\n\n    if (userData.activePlan) {\n        return (\n            <DashboardPageLayout title=\"Active Plan\" icon={<Bot size={28}/>}>\n                <div className=\"flex flex-col items-center justify-center text-center gap-6 p-8 min-h-[60vh]\">\n                     <motion.div className=\"p-4 bg-brand-primary/10 text-brand-primary rounded-full\" animate={{ scale: [1, 1.1, 1]}} transition={{ repeat: Infinity, duration: 3, ease: 'easeInOut' }}>\n                        <Rocket size={48} />\n                    </motion.div>\n                    <h2 className=\"text-3xl font-bold text-white\">Your Plan: {userData.activePlan.name}</h2>\n                    <div className=\"grid grid-cols-2 gap-x-8 gap-y-4 text-left\">\n                        <div className=\"text-brand-text-secondary\">Status</div><div className={`font-bold ${userData.activePlan.isActive ? 'text-green-400' : 'text-yellow-400'}`}>{userData.activePlan.isActive ? 'Active' : 'Inactive'}</div>\n                        <div className=\"text-brand-text-secondary\">Investment</div><div className=\"font-bold font-mono\">{formatCurrency(userData.activePlan.investment)}</div>\n                        <div className=\"text-brand-text-secondary\">Daily Return</div><div className=\"font-bold font-mono\">{userData.activePlan.dailyReturn}%</div>\n                    </div>\n\n                    {!userData.activePlan.isActive && (\n                        <motion.button \n                            whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}\n                            onClick={handlePlanActivation} \n                            className=\"mt-4 px-8 py-4 bg-green-500 text-white font-bold rounded-full shadow-lg shadow-green-500/30\"\n                        >\n                            Activate Plan Now\n                        </motion.button>\n                    )}\n                </div>\n            </DashboardPageLayout>\n        )\n    }\n\n    return (\n        <DashboardPageLayout title=\"AI Trading Plans\" icon={<Bot size={28} />}>\n            <p className=\"text-brand-text-secondary\">Choose your AI plan to start generating passive income. Your capital is fully managed by our advanced arbitrage bots.</p>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                {AI_PLANS_DATA.map((plan, i) => (\n                    <motion.div\n                        key={plan.name}\n                        initial={{ opacity: 0, y: 50 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        transition={{ duration: 0.5, delay: i * 0.1 }}\n                    >\n                        <PlanCard plan={plan} onSelect={handleSelectPlan} />\n                    </motion.div>\n                ))}\n            </div>\n            <InvestmentModal \n                isOpen={!!selectedPlan} \n                onClose={() => setSelectedPlan(null)} \n                plan={selectedPlan} \n                userData={userData}\n                amount={investmentAmount}\n                setAmount={setInvestmentAmount}\n                onConfirm={handleConfirmInvestment}\n            />\n        </DashboardPageLayout>\n    );\n};\n\nconst PlanCard: React.FC<{ plan: typeof AI_PLANS_DATA[0], onSelect: (plan: any) => void }> = ({ plan, onSelect }) => {\n    const popularGlow = \"absolute -inset-0.5 bg-gradient-to-r from-indigo-500 to-violet-600 rounded-3xl blur-xl opacity-50 group-hover:opacity-75 transition duration-1000 group-hover:duration-200 animate-tilt\";\n\n    return (\n        <motion.div \n            whileHover={{ y: -10, scale: 1.02 }}\n            className={`relative group h-full ${plan.isPopular ? 'p-0.5' : ''}`}\n        >\n            {plan.isPopular && <div className={popularGlow}></div>}\n            <div className=\"relative bg-brand-surface/60 backdrop-blur-lg border border-white/10 rounded-3xl p-6 h-full flex flex-col\">\n                {plan.isPopular && <div className=\"absolute top-0 right-6 -translate-y-1/2 px-3 py-1 bg-brand-accent text-brand-bg text-xs font-bold rounded-full uppercase\">Most Popular</div>}\n                <div className=\"flex items-center gap-4 mb-4\">\n                    <div className={`p-3 bg-${plan.color}/10 text-${plan.color} rounded-full`}>{plan.icon}</div>\n                    <h3 className=\"text-2xl font-bold text-white\">{plan.name}</h3>\n                </div>\n                \n                <div className=\"my-4 text-center\">\n                    <p className=\"text-5xl font-bold text-white font-mono\">{plan.dailyReturn}%</p>\n                    <p className=\"text-brand-text-secondary\">Daily Return</p>\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4 text-center my-4 border-y border-white/10 py-4\">\n                    <div><p className=\"font-bold text-white\">{plan.duration} Days</p><p className=\"text-xs text-brand-text-secondary\">Duration</p></div>\n                    <div><p className=\"font-bold text-white\">{plan.totalROI.toLocaleString()}%</p><p className=\"text-xs text-brand-text-secondary\">Total ROI</p></div>\n                    <div><p className=\"font-bold text-white\">{formatCurrency(plan.minDeposit)}</p><p className=\"text-xs text-brand-text-secondary\">Min Deposit</p></div>\n                    <div><p className=\"font-bold text-white\">{formatCurrency(plan.maxDeposit)}</p><p className=\"text-xs text-brand-text-secondary\">Max Deposit</p></div>\n                </div>\n\n                <ul className=\"space-y-2 text-brand-text-secondary mb-6 flex-grow\">\n                    {plan.features.map(feature => (\n                        <li key={feature} className=\"flex items-center gap-2\">\n                            <CheckCircle size={16} className=\"text-green-400\" /><span>{feature}</span>\n                        </li>\n                    ))}\n                </ul>\n                <button onClick={() => onSelect(plan)} className={`w-full mt-auto py-3 bg-brand-primary text-brand-bg font-bold rounded-lg transition-transform hover:scale-105 group-hover:shadow-[0_0_20px_theme(colors.brand.primary)]`}>\n                    {plan.buttonText}\n                </button>\n            </div>\n        </motion.div>\n    );\n};\n\nconst InvestmentModal: React.FC<{\n    isOpen: boolean; onClose: () => void; plan: typeof AI_PLANS_DATA[0] | null; userData: UserData; amount: string; setAmount: (val: string) => void; onConfirm: () => void;\n}> = ({ isOpen, onClose, plan, userData, amount, setAmount, onConfirm }) => {\n    const numericAmount = parseFloat(amount) || 0;\n    const dailyProfit = plan ? numericAmount * (plan.dailyReturn / 100) : 0;\n    const totalReturn = plan ? numericAmount + (numericAmount * (plan.totalROI / 100)) : 0;\n\n    const error = useMemo(() => {\n        if (!plan || !amount) return null;\n        if (numericAmount < plan.minDeposit) return `Minimum investment is ${formatCurrency(plan.minDeposit)}`;\n        if (numericAmount > plan.maxDeposit) return `Maximum investment is ${formatCurrency(plan.maxDeposit)}`;\n        if (numericAmount > userData.balance) return `Insufficient balance`;\n        return null;\n    }, [numericAmount, plan, userData.balance, amount]);\n\n    return (\n        <AnimatePresence>\n        {isOpen && (\n            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} onClick={onClose} className=\"fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4\">\n                <motion.div initial={{ scale: 0.9, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} exit={{ scale: 0.9, opacity: 0 }} onClick={e => e.stopPropagation()} className=\"bg-brand-surface border border-white/10 rounded-2xl w-full max-w-md p-6 relative\">\n                    <div className=\"flex justify-between items-center mb-4\">\n                        <h3 className=\"text-xl font-bold text-white\">Invest in {plan?.name || ''}</h3>\n                        <button onClick={onClose} className=\"p-1 rounded-full hover:bg-white/10\"><X size={20} /></button>\n                    </div>\n                    {plan && (\n                        <div className=\"space-y-4\">\n                            <div className=\"p-4 bg-brand-bg border border-white/10 rounded-lg text-center\">\n                                <p className=\"text-sm text-brand-text-secondary\">Available Balance</p>\n                                <p className=\"text-2xl font-bold font-mono text-white\">{formatCurrency(userData.balance)}</p>\n                            </div>\n                            <div>\n                                <label className=\"block text-brand-text-secondary mb-2\">Enter Investment Amount (USD)</label>\n                                <div className=\"relative\">\n                                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-brand-text-secondary\">$</span>\n                                    <input \n                                        type=\"number\" \n                                        value={amount}\n                                        onChange={e => setAmount(e.target.value)}\n                                        placeholder={`${plan.minDeposit} - ${plan.maxDeposit}`}\n                                        className=\"w-full pl-7 p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary focus:outline-none focus:border-brand-primary transition-all duration-300 glow-input\"\n                                    />\n                                </div>\n                            </div>\n                            \n                            <AnimatePresence>\n                            {numericAmount > 0 && (\n                                <motion.div initial={{opacity:0, height: 0}} animate={{opacity: 1, height: 'auto'}} exit={{opacity:0, height: 0}} className=\"overflow-hidden\">\n                                    <div className=\"p-4 bg-brand-bg/50 border border-white/10 rounded-lg space-y-2\">\n                                        <div className=\"flex justify-between text-sm\"><span className=\"text-brand-text-secondary\">Daily Profit</span><span className=\"font-mono font-bold text-green-400\">~{formatCurrency(dailyProfit)}</span></div>\n                                        <div className=\"flex justify-between text-sm\"><span className=\"text-brand-text-secondary\">Total Return</span><span className=\"font-mono font-bold text-brand-primary\">~{formatCurrency(totalReturn)}</span></div>\n                                    </div>\n                                </motion.div>\n                            )}\n                            </AnimatePresence>\n\n                            {error && <p className=\"text-red-400 text-xs text-center\">{error}</p>}\n                            \n                            <button onClick={onConfirm} disabled={!!error || !amount} className=\"w-full py-3 bg-gradient-to-r from-brand-primary to-brand-secondary text-brand-bg font-bold rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-transform hover:scale-105\">\n                                Confirm Investment\n                            </button>\n                        </div>\n                    )}\n                </motion.div>\n            </motion.div>\n        )}\n    </AnimatePresence>\n    );\n};\n\nexport default PlansPage;","size_bytes":14487},"App.tsx":{"content":"\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { AnimatePresence } from 'framer-motion';\nimport { User, PublicSystemSettings } from './types';\nimport * as userDataService from './services/userDataService';\nimport { getPublicSystemSettings } from './services/userDataService';\nimport { DashboardView } from './components/Dashboard';\n\n// Lazy load components for better initial load time\nconst HomePage = React.lazy(() => import('./components/HomePage'));\nconst LoginPage = React.lazy(() => import('./components/auth/LoginPage'));\nconst RegisterPage = React.lazy(() => import('./components/auth/RegisterPage'));\nconst ForgotPasswordPage = React.lazy(() => import('./components/auth/ForgotPasswordPage'));\nconst Dashboard = React.lazy(() => import('./components/Dashboard'));\nconst WelcomePage = React.lazy(() => import('./components/WelcomePage'));\nconst AdminPanel = React.lazy(() => import('./components/admin/AdminPanel'));\nconst AdminLoginModal = React.lazy(() => import('./components/admin/AdminLoginModal'));\nconst Chatbot = React.lazy(() => import('./components/chatbot/Chatbot'));\nconst TestimonialsPage = React.lazy(() => import('./components/TestimonialsPage'));\n\ntype View = 'homepage' | 'login' | 'register' | 'forgot' | 'dashboard' | 'welcome' | 'admin' | 'testimonials';\n\nconst App: React.FC = () => {\n  const [user, setUser] = useState<User | null>(null);\n  const [view, setView] = useState<View>('homepage');\n  const [isLoading, setIsLoading] = useState(true);\n  const [initialDashboardView, setInitialDashboardView] = useState<DashboardView>('overview');\n  const [settings, setSettings] = useState<PublicSystemSettings | null>(null);\n\n  // Admin state\n  const [logoClickCount, setLogoClickCount] = useState(0);\n  const [isAdminLoginOpen, setIsAdminLoginOpen] = useState(false);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const clickTimeout = React.useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  useEffect(() => {\n    const loadInitialData = async () => {\n        setIsLoading(true);\n        const appSettings = await getPublicSystemSettings();\n        setSettings(appSettings);\n        try {\n          const storedUser = localStorage.getItem('tradePilotUser');\n          if (storedUser) {\n            const parsedUser: User = JSON.parse(storedUser);\n            setUser(parsedUser);\n            if (parsedUser.hasSeenWelcome) {\n                setView('dashboard');\n            } else {\n                setView('welcome');\n            }\n          }\n        } catch (error) {\n          console.error(\"Failed to parse user from localStorage\", error);\n          localStorage.removeItem('tradePilotUser');\n        }\n        setIsLoading(false);\n    }\n    loadInitialData();\n  }, []);\n\n  const handleLoginSuccess = useCallback((loggedInUser: User) => {\n    setUser(loggedInUser);\n    localStorage.setItem('tradePilotUser', JSON.stringify(loggedInUser));\n    if (loggedInUser.hasSeenWelcome) {\n        setView('dashboard');\n    } else {\n        setView('welcome');\n    }\n  }, []);\n\n  const handleRegisterSuccess = useCallback((registeredUser: User) => {\n    const { password, ...sessionUser } = registeredUser;\n    \n    setUser(sessionUser);\n    localStorage.setItem('tradePilotUser', JSON.stringify(sessionUser));\n    setView('welcome');\n  }, []);\n  \n  const handleLogout = useCallback(() => {\n    setUser(null);\n    localStorage.removeItem('tradePilotUser');\n    setView('homepage');\n  }, []);\n\n  const handleAdminLogout = useCallback(() => {\n    setIsAdmin(false);\n    setView('homepage');\n  }, []);\n\n  const handleWelcomeNavigation = useCallback(async (destination: DashboardView) => {\n    if (user) {\n      const updatedUser = { ...user, hasSeenWelcome: true };\n      setUser(updatedUser);\n      localStorage.setItem('tradePilotUser', JSON.stringify(updatedUser));\n      \n      // CRITICAL: Save to backend storage so it persists across sessions\n      try {\n        await userDataService.updateUserData(user.id, { hasSeenWelcome: true });\n      } catch (error) {\n        console.error('Failed to update hasSeenWelcome in backend:', error);\n      }\n    }\n    setInitialDashboardView(destination);\n    setView('dashboard');\n  }, [user]);\n\n  const handleLogoClick = useCallback(() => {\n    if (clickTimeout.current) {\n        clearTimeout(clickTimeout.current);\n    }\n\n    const newCount = logoClickCount + 1;\n    setLogoClickCount(newCount);\n\n    if (newCount >= 5) {\n        setIsAdminLoginOpen(true);\n        setLogoClickCount(0);\n    } else {\n        clickTimeout.current = setTimeout(() => {\n            setLogoClickCount(0);\n        }, 2000);\n    }\n  }, [logoClickCount]);\n\n  const handleAdminLogin = (password: string): boolean => {\n    // Simple hardcoded password for demo purposes\n    if (password === 'joshbond') {\n      setIsAdmin(true);\n      setView('admin');\n      setIsAdminLoginOpen(false);\n      return true;\n    }\n    return false;\n  };\n\n  const LoadingSpinner: React.FC = () => (\n    <div className=\"flex items-center justify-center min-h-screen bg-brand-bg\">\n      <div className=\"w-16 h-16 border-4 border-brand-primary border-t-transparent rounded-full animate-spin\"></div>\n    </div>\n  );\n\n  const renderView = () => {\n    switch(view) {\n      case 'homepage':\n        return <HomePage key=\"homepage\" onNavigate={setView} onLogoClick={handleLogoClick} />;\n      case 'login':\n        return <LoginPage key=\"login\" onNavigate={setView} onLoginSuccess={handleLoginSuccess} settings={settings} />;\n      case 'register':\n        return <RegisterPage key=\"register\" onNavigate={setView} onRegisterSuccess={handleRegisterSuccess} settings={settings} />;\n      case 'forgot':\n        return <ForgotPasswordPage key=\"forgot\" onNavigate={setView} />;\n      case 'dashboard':\n        return user ? <Dashboard user={user} onLogout={handleLogout} initialView={initialDashboardView} /> : <LoginPage key=\"login-fallback\" onNavigate={setView} onLoginSuccess={handleLoginSuccess} settings={settings} />;\n      case 'welcome':\n        return <WelcomePage onNavigate={handleWelcomeNavigation} />;\n      case 'admin':\n        return isAdmin ? <AdminPanel onLogout={handleAdminLogout} /> : <HomePage key=\"homepage-fallback\" onNavigate={setView} onLogoClick={handleLogoClick} />;\n      case 'testimonials':\n        return <TestimonialsPage key=\"testimonials\" onNavigate={setView} />;\n      default:\n        return <HomePage key=\"default\" onNavigate={setView} onLogoClick={handleLogoClick} />;\n    }\n  };\n\n  if (isLoading) {\n    return <LoadingSpinner />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-brand-bg font-sans\">\n        <React.Suspense fallback={<LoadingSpinner />}>\n            <AnimatePresence mode=\"wait\">\n                {renderView()}\n            </AnimatePresence>\n            <AdminLoginModal \n              isOpen={isAdminLoginOpen} \n              onClose={() => setIsAdminLoginOpen(false)} \n              onLogin={handleAdminLogin}\n            />\n            {/* Render Chatbot globally but only when on dashboard */}\n            {view === 'dashboard' && user && <Chatbot user={user} />}\n        </React.Suspense>\n    </div>\n  );\n};\n\nexport default App;","size_bytes":7136},"sw.js":{"content":"self.addEventListener('fetch', (event) => {\n  event.respondWith(fetch(event.request));\n});\n","size_bytes":91},"components/auth/LoginPage.tsx":{"content":"\nimport React, { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport AuthLayout from './AuthLayout';\nimport { findUserByEmailOrName, logLogin } from '../../services/userDataService';\nimport { User, PublicSystemSettings } from '../../types';\nimport { ArrowLeft } from 'lucide-react';\nimport ReCaptcha from './ReCaptcha';\n\ninterface LoginPageProps {\n  onNavigate: (view: 'register' | 'forgot' | 'homepage') => void;\n  onLoginSuccess: (user: User) => void;\n  settings: PublicSystemSettings | null;\n}\n\nconst LoginPage: React.FC<LoginPageProps> = ({ onNavigate, onLoginSuccess, settings }) => {\n  const [identifier, setIdentifier] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [recaptchaToken, setRecaptchaToken] = useState<string>('');\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setIsLoading(true);\n\n    if (!identifier || !password) {\n      setError('Please enter your email/username and password.');\n      setIsLoading(false);\n      return;\n    }\n\n    if (settings?.recaptchaEnabled && !recaptchaToken) {\n      setError('Please complete the reCAPTCHA verification.');\n      setIsLoading(false);\n      return;\n    }\n\n    try {\n      const user = await findUserByEmailOrName(identifier);\n      if (user && user.password === password) {\n        await logLogin(user.id);\n        // Exclude password from the user object that gets stored in the session\n        const { password: _, ...userToLog } = user;\n        onLoginSuccess(userToLog);\n        setIsLoading(false);\n      } else {\n        setTimeout(() => {\n          setError('Incorrect email/username or password. Please try again.');\n          setIsLoading(false);\n        }, 1000);\n      }\n    } catch (e) {\n      setTimeout(() => {\n        setError('An unexpected error occurred. Please try again.');\n        setIsLoading(false);\n      }, 1000);\n    }\n  };\n\n  return (\n    <AuthLayout>\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl relative\"\n        style={{ transform: 'translateZ(50px)' }}\n      >\n        <button onClick={() => onNavigate('homepage')} className=\"absolute top-4 left-4 text-brand-text-secondary hover:text-white transition-colors\">\n            <ArrowLeft size={24} />\n        </button>\n        <h1 className=\"text-3xl font-bold text-center text-brand-primary mb-2\">TradePilot AI</h1>\n        <p className=\"text-center text-brand-text-secondary mb-8\">Welcome back to the future of trading.</p>\n        \n        <form onSubmit={handleLogin} className=\"space-y-4\">\n          <input\n            type=\"text\"\n            placeholder=\"Email or Username\"\n            value={identifier}\n            onChange={(e) => setIdentifier(e.target.value)}\n            className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\"\n          />\n          <input\n            type=\"password\"\n            placeholder=\"Password\"\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n            className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\"\n          />\n          \n          <div className=\"flex items-center justify-between text-sm\">\n            <label className=\"flex items-center text-brand-text-secondary\">\n              <input type=\"checkbox\" className=\"mr-2 bg-brand-bg border-white/20\" defaultChecked/>\n              Remember Me\n            </label>\n            <button type=\"button\" onClick={() => onNavigate('forgot')} className=\"text-brand-primary hover:underline\">\n              Forgot Password?\n            </button>\n          </div>\n          \n          {error && <p className=\"text-red-400 text-sm text-center\">{error}</p>}\n          \n          {settings?.recaptchaEnabled && settings.recaptchaSiteKey && (\n            <ReCaptcha\n              siteKey={settings.recaptchaSiteKey}\n              onVerify={setRecaptchaToken}\n              onExpired={() => setRecaptchaToken('')}\n            />\n          )}\n          \n          <button\n            type=\"submit\"\n            disabled={isLoading || (settings?.recaptchaEnabled && !recaptchaToken)}\n            className=\"w-full py-3 bg-gradient-to-br from-brand-primary to-brand-secondary text-brand-bg font-bold rounded-lg shadow-lg shadow-brand-primary/20 hover:shadow-xl hover:shadow-brand-primary/40 transform hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isLoading ? <div className=\"w-6 h-6 border-2 border-brand-bg border-t-transparent rounded-full animate-spin mx-auto\"></div> : 'Login'}\n          </button>\n        </form>\n        \n        <p className=\"text-center mt-6 text-brand-text-secondary\">\n          Don’t have an account?{' '}\n          <button onClick={() => onNavigate('register')} className=\"font-bold text-brand-primary hover:underline\">\n            Register now\n          </button>\n        </p>\n      </motion.div>\n    </AuthLayout>\n  );\n};\n\nexport default LoginPage;","size_bytes":5409},"components/three/WelcomeAnimation.tsx":{"content":"\nimport React, { useRef, useMemo } from 'react';\nimport { Canvas, useFrame } from '@react-three/fiber';\nimport { Icosahedron } from '@react-three/drei';\nimport * as THREE from 'three';\n\nfunction Particles({ count = 100 }) {\n  const mesh = useRef<THREE.InstancedMesh>(null!);\n  const dummy = useMemo(() => new THREE.Object3D(), []);\n\n  const particles = useMemo(() => {\n    const temp = [];\n    for (let i = 0; i < count; i++) {\n      const t = Math.random() * 100;\n      const factor = 10 + Math.random() * 20;\n      const speed = 0.01 + Math.random() / 200;\n      const x = (Math.random() - 0.5) * 20;\n      const y = (Math.random() - 0.5) * 20;\n      const z = (Math.random() - 0.5) * 20;\n      temp.push({ t, factor, speed, x, y, z });\n    }\n    return temp;\n  }, [count]);\n\n  useFrame(() => {\n    if (!mesh.current) return;\n    particles.forEach((particle, i) => {\n      let { factor, speed, x, y, z } = particle;\n      particle.t += speed;\n      const a = Math.cos(particle.t) + Math.sin(particle.t * 1) / 10;\n      const b = Math.sin(particle.t) + Math.cos(particle.t * 2) / 10;\n      const s = Math.max(0.1, Math.cos(particle.t) * 0.2 + 0.2);\n      dummy.position.set(\n        x + a * (factor / 5),\n        y + b * (factor / 5),\n        z + b * (factor / 5)\n      );\n      dummy.scale.set(s,s,s);\n      dummy.updateMatrix();\n      mesh.current.setMatrixAt(i, dummy.matrix);\n    });\n    mesh.current.instanceMatrix.needsUpdate = true;\n  });\n\n  return (\n    <instancedMesh ref={mesh} args={[undefined, undefined, count]}>\n      <sphereGeometry args={[0.05]} />\n      <meshStandardMaterial color=\"#e040fb\" emissive=\"#e040fb\" emissiveIntensity={3} />\n    </instancedMesh>\n  );\n}\n\nconst Crystal: React.FC = () => {\n    const ref = useRef<THREE.Mesh>(null!);\n    useFrame(({ clock }) => {\n        if(ref.current) {\n            ref.current.rotation.y = clock.getElapsedTime() * 0.2;\n            ref.current.rotation.x = clock.getElapsedTime() * 0.1;\n        }\n    });\n\n    return (\n        <Icosahedron ref={ref} args={[1, 1]}>\n            <meshStandardMaterial \n                color=\"#00f5ff\" \n                emissive=\"#00f5ff\"\n                emissiveIntensity={1}\n                transparent\n                opacity={0.7}\n                roughness={0.1}\n                metalness={0.9}\n            />\n        </Icosahedron>\n    )\n}\n\nconst WelcomeAnimation = () => {\n  return (\n    <Canvas camera={{ position: [0, 0, 5], fov: 75 }}>\n      <ambientLight intensity={0.5} />\n      <pointLight position={[10, 10, 10]} intensity={2} color=\"#00f5ff\" />\n      <pointLight position={[-10, -10, -10]} intensity={2} color=\"#e040fb\" />\n      <Crystal />\n      <Particles />\n    </Canvas>\n  );\n};\n\nexport default WelcomeAnimation;\n","size_bytes":2723},"components/WelcomeVideo.tsx":{"content":"\nimport React, { useState, useEffect, Suspense } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\n// FIX: Changed import to getWelcomePageTemplate as suggested by the error.\nimport { getWelcomePageTemplate } from '../services/userDataService';\n// FIX: Changed import to WelcomePageTemplate as suggested by the error.\nimport { WelcomePageTemplate } from '../types';\nimport { Mail, LayoutDashboard } from 'lucide-react';\nimport AuthBackground from './auth/AuthBackground';\n\n// This is an alias for DashboardView until it can be properly imported/shared\ntype DashboardDestination = 'overview' | 'inbox' | 'history' | 'profile' | 'deposit' | 'withdraw' | 'plans' | 'referrals';\n\ninterface WelcomePageProps {\n  onNavigate: (destination: DashboardDestination) => void;\n}\n\nconst WelcomePage: React.FC<WelcomePageProps> = ({ onNavigate }) => {\n  const [template, setTemplate] = useState<WelcomePageTemplate | null>(null);\n\n  useEffect(() => {\n    const fetchTemplate = async () => {\n      const data = await getWelcomePageTemplate();\n      setTemplate(data);\n    };\n    fetchTemplate();\n  }, []);\n\n  const backdropVariants = {\n    hidden: { opacity: 0 },\n    visible: { opacity: 1 },\n    exit: { opacity: 0 },\n  };\n\n  const cardVariants = {\n    hidden: { opacity: 0, y: 50, scale: 0.95 },\n    visible: { opacity: 1, y: 0, scale: 1, transition: { duration: 0.7, ease: [0.22, 1, 0.36, 1] } },\n    exit: { opacity: 0, y: -50, scale: 0.95, transition: { duration: 0.4 } }\n  };\n\n  return (\n    <motion.div\n      className=\"relative w-full min-h-screen overflow-hidden flex items-center justify-center p-4 font-sans\"\n      variants={backdropVariants}\n      initial=\"hidden\"\n      animate=\"visible\"\n      exit=\"exit\"\n    >\n        <AuthBackground />\n        <motion.div\n            variants={cardVariants}\n            className=\"relative z-10 w-full max-w-2xl bg-brand-surface/30 backdrop-blur-2xl border border-white/10 rounded-3xl p-8 shadow-2xl text-center\"\n        >\n            <AnimatePresence mode=\"wait\">\n            {template ? (\n                <motion.div\n                    key=\"content\"\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    exit={{ opacity: 0 }}\n                >\n                    <motion.h1 \n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0, transition: { delay: 0.2, duration: 0.5 } }}\n                        className=\"text-3xl md:text-4xl font-bold text-white mb-4\"\n                    >\n                        {template.title}\n                    </motion.h1>\n\n                    {template.imageUrl && (\n                        <motion.img \n                            src={template.imageUrl} \n                            alt=\"Welcome Visual\" \n                            className=\"my-6 rounded-lg max-h-60 mx-auto\"\n                            initial={{ opacity: 0, scale: 0.8 }}\n                            animate={{ opacity: 1, scale: 1, transition: { delay: 0.4, duration: 0.5 } }}\n                        />\n                    )}\n                    {template.videoUrl && (\n                        <motion.video \n                            src={template.videoUrl} \n                            controls \n                            className=\"my-6 rounded-lg w-full max-w-md mx-auto\"\n                            initial={{ opacity: 0, scale: 0.8 }}\n                            animate={{ opacity: 1, scale: 1, transition: { delay: 0.4, duration: 0.5 } }}\n                        />\n                    )}\n                    \n                    <motion.p \n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0, transition: { delay: 0.6, duration: 0.5 } }}\n                        className=\"text-brand-text-secondary max-w-lg mx-auto mb-8 whitespace-pre-wrap\"\n                    >\n                        {template.text}\n                    </motion.p>\n                    \n                    <motion.div \n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0, transition: { delay: 0.8, duration: 0.5 } }}\n                        className=\"flex flex-col sm:flex-row justify-center items-center gap-4\"\n                    >\n                        <motion.button \n                            onClick={() => onNavigate('inbox')}\n                            className=\"w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-brand-secondary text-white font-bold rounded-full transition-all duration-300 hover:scale-105 hover:shadow-[0_0_20px_theme(colors.brand.secondary)]\"\n                            whileHover={{ scale: 1.05 }}\n                            whileTap={{ scale: 0.95 }}\n                        >\n                            <Mail size={18} /> Go to Inbox\n                        </motion.button>\n                        <motion.button \n                            onClick={() => onNavigate('overview')}\n                            className=\"w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-brand-primary text-brand-bg font-bold rounded-full transition-all duration-300 hover:scale-105 hover:shadow-[0_0_20px_theme(colors.brand.primary)]\"\n                            whileHover={{ scale: 1.05 }}\n                            whileTap={{ scale: 0.95 }}\n                        >\n                             <LayoutDashboard size={18} /> Go to Dashboard\n                        </motion.button>\n                    </motion.div>\n                </motion.div>\n            ) : (\n                <motion.div key=\"loader\" className=\"h-96 flex items-center justify-center\">\n                    <div className=\"w-12 h-12 border-4 border-brand-primary border-t-transparent rounded-full animate-spin\"></div>\n                </motion.div>\n            )}\n            </AnimatePresence>\n        </motion.div>\n    </motion.div>\n  );\n};\n\nexport default WelcomePage;","size_bytes":5980},"replit.md":{"content":"# TradePilot AI\n\n## Overview\nTradePilot AI is an advanced AI-powered crypto arbitrage trading platform with automated trading capabilities across 50+ exchanges. This is a full-featured web application with user authentication, dashboard, admin panel, chatbot integration, and beautiful 3D visualizations.\n\n## Project Status\n- **Type**: Full-stack application (React frontend + Express backend)\n- **Build System**: Vite\n- **Deployment**: Ready for production deployment\n- **Current State**: Fully functional with both servers running (Frontend: port 5000, Backend: port 3000)\n\n## Architecture\n\n### Technology Stack\n- **Frontend Framework**: React 19.2 with TypeScript\n- **Build Tool**: Vite 7.1\n- **Backend**: Express.js with file-based JSON storage\n- **UI Libraries**: \n  - Framer Motion (animations)\n  - Three.js with React Three Fiber (3D graphics)\n  - Recharts (data visualization)\n  - Lucide React (icons)\n  - Tailwind CSS (styling via CDN)\n- **Data Storage**: File-based JSON storage (storage/ directory)\n- **Email Service**: Nodemailer (Gmail SMTP)\n- **AI Integration**: \n  - Cerebras API for chatbot functionality\n  - Google Gemini API for image generation (optional)\n\n### Project Structure\n```\n.\n├── components/           # React components\n│   ├── admin/           # Admin panel components\n│   ├── auth/            # Authentication pages\n│   ├── chatbot/         # Chatbot components\n│   ├── dashboard/       # Dashboard pages\n│   └── three/           # 3D visualization components\n├── services/            # Service layer\n│   ├── cerebrasService.ts    # Chatbot AI service\n│   ├── geminiService.ts      # Image generation service\n│   └── userDataService.ts    # User data management\n├── storage/             # File-based data storage\n│   ├── users.json       # User accounts and data\n│   ├── settings.json    # System settings and configurations\n│   ├── messages.json    # Inbox messages\n│   ├── reviews.json     # User reviews and testimonials (50 unique reviews)\n│   ├── profits.json     # User profit records\n│   └── activity.log     # Admin activity logging\n├── server.js            # Express backend server\n├── App.tsx              # Main application component\n├── index.tsx            # Application entry point\n├── types.ts             # TypeScript type definitions\n├── index.html           # HTML template\n└── vite.config.ts       # Vite configuration\n```\n\n## Features\n- User authentication with email verification\n- Dashboard with trading overview\n- Investment plans and profit tracking\n- Deposit/withdrawal management\n- Referral system\n- Admin panel for user management\n- AI-powered chatbot\n- 3D visualizations and animations\n- Responsive mobile design\n- Reviews/Testimonials page with pagination (7 reviews per page, 50 total unique reviews)\n- Permanent welcome video embedded in inbox messages (admin can only edit text)\n\n## Running the Application\n\n### Development\n```bash\nnpm run dev\n# This runs both servers concurrently:\n# - Backend (Express) on port 3000\n# - Frontend (Vite) on port 5000\n```\nThe frontend will be available at http://0.0.0.0:5000\nThe backend API will be available at http://localhost:3000\n\n### Building for Production\n```bash\nnpm run build\n# Creates an optimized production build in the dist/ directory\n```\n\n### Preview Production Build\n```bash\nnpm run preview\n# Serves the production build locally for testing\n# This is what runs when deployed to production\n```\n\n## Environment Variables (Optional)\n- `API_KEY` - Google Gemini API key for image generation feature (optional)\n- `EMAIL_USER` - Gmail address for sending verification emails (optional)\n- `EMAIL_APP_PASSWORD` - Gmail app password for SMTP authentication (optional)\n\n## Data Storage\nAll user data, settings, and configurations are stored in JSON files in the `storage/` directory for permanent persistence:\n- **users.json**: User accounts, authentication, transactions, balances, referrals, sessions, and login history\n- **settings.json**: System settings, wallet configurations, welcome page templates, chatbot settings (no longer stores testimonials)\n- **messages.json**: Inbox messages and notifications\n- **reviews.json**: 50 unique, human-sounding user reviews and testimonials with pagination support\n- **profits.json**: User profit records and tracking\n- **activity.log**: System activity and admin action logging\n- **storage/media/**: Video and image files for welcome page and inbox templates (stored separately from JSON)\n\nThe backend automatically creates the storage directory and initializes files on first startup.\n\n### Media Upload System\nVideos and images for welcome templates are stored as separate files to prevent JSON bloat:\n- Files are uploaded immediately when selected by admin\n- Only URL references are stored in settings.json\n- Automatic cleanup of old media files when new ones are uploaded\n- Maximum file size: 100MB\n- Supported locations: welcome_page and welcome_inbox\n\n## Admin Access\n- Click the logo 5 times to open the admin login modal\n- Default admin password: `joshbond`\n\n## Deployment\nThe application is configured for autoscale deployment on Replit:\n- Build command: `npm run build`\n- Run command: `npm run start` (runs both backend and frontend)\n- Port: 5000 (frontend), 3000 (backend API)\n\n## Recent Changes\n- **2025-11-03**: Reviews system and permanent welcome video implementation\n  - **NEW FILE STORAGE**: Added reviews.json (50 unique reviews), profits.json, and activity.log to storage system\n  - **REVIEWS PAGINATION**: Testimonials page displays 7 reviews per page with Next/Previous navigation\n  - Created 50 unique, human-sounding reviews (no repetition, diverse feedback)\n  - **PERMANENT WELCOME VIDEO**: Embedded Streamable video permanently in welcome inbox messages\n  - Admin can edit inbox message title and text, but video embed is locked and permanent\n  - Updated backend with new API endpoints: /api/storage/reviews, /api/storage/profits, /api/storage/activity-log\n  - Reviews now stored separately from settings.json for better organization\n  - All data persists permanently to file storage with no external database required\n- **2025-11-02**: Registration fix and API routing configuration\n  - **ROOT CAUSE IDENTIFIED**: Fixed hardcoded localhost:3000 API URLs that prevented registration from working in production\n  - **SOLUTION**: Configured Vite proxy to route all /api/* requests to backend server\n  - Changed API_BASE_URL from hardcoded localhost to relative paths (/api/storage)\n  - Added proxy configuration in vite.config.ts to forward API requests to port 3000\n  - Registration now works correctly with automatic redirect to welcome page\n  - All API endpoints (users, settings, messages) now accessible from frontend\n- **2025-11-02**: Backend integration and storage system implementation\n  - Implemented Express backend server on port 3000\n  - Added file-based JSON storage system for permanent data persistence\n  - Created storage infrastructure with users.json, settings.json, and messages.json\n  - Updated dev workflow to run both frontend and backend servers concurrently\n  - Confirmed reCAPTCHA functionality (works when enabled by admin)\n  - All data now persists permanently in file storage\n- **2025-11-02**: Critical performance fix and feature enhancements\n  - **PERFORMANCE FIX**: Removed problematic CSS properties (will-change, contain) that were causing scroll lag, flickering, and UI blinking\n  - Homepage now scrolls smoothly with zero lag or glitches\n  - Improved Suspense fallback with loading spinner to prevent blank screen\n  - All 50 testimonials replaced with unique, human-sounding reviews\n  - reCAPTCHA system fully integrated with admin panel controls\n  - Added reCAPTCHA Secret Key field for server-side verification\n  - Deposit History section added to Deposit page showing past transactions\n  - Referral History section added to Referral page with summary statistics\n- **2025-10-31**: Initial Replit setup completed\n  - Configured Vite build system for TypeScript/React\n  - Set up development server on port 5000\n  - Configured deployment settings\n  - App is fully functional and ready to use\n\n## Known Limitations\n- WebGL errors may appear in some screenshot/testing environments but won't affect real users\n- Tailwind CSS loaded via CDN (should be replaced with PostCSS plugin for production)\n- File-based JSON storage (suitable for development; consider PostgreSQL or MongoDB for high-traffic production)\n- Email verification requires EMAIL_USER and EMAIL_APP_PASSWORD environment variables to be configured\n- API keys for Cerebras chatbot and Gemini image generation need to be configured in admin panel\n\n## User Preferences\nNone set yet.\n","size_bytes":8813},"services/cerebrasService.ts":{"content":"import { ChatMessage, ChatbotSettings, ApiKeyStats } from '../types';\nimport { getChatbotSettings, saveChatbotSettings } from './userDataService';\n\nconst CEREBRAS_API_URL = 'https://corsproxy.io/?https://api.cerebras.ai/v1/chat/completions';\n// Defines the model fallback sequence.\nconst MODELS = ['llama3.1-70b', 'llama3.1-8b', 'llama3-70b'];\n\n// This function finds the next best key to use.\n// It prioritizes active keys that haven't been used for the longest time.\n// If all keys have failed, it falls back to the least recently used key to retry.\nconst getNextApiKey = (keys: ApiKeyStats[]): [ApiKeyStats | null, number] => {\n  if (!keys || keys.length === 0) return [null, -1];\n\n  const activeKeys = keys.filter(k => k.status === 'active');\n\n  if (activeKeys.length > 0) {\n    // Find the least recently used key among active ones for rotation.\n    const sortedActive = activeKeys.sort((a,b) => new Date(a.lastUsed || 0).getTime() - new Date(b.lastUsed || 0).getTime());\n    const nextKey = sortedActive[0];\n    const originalIndex = keys.findIndex(k => k.key === nextKey.key);\n    return [nextKey, originalIndex];\n  }\n\n  // Fallback: If no active keys, retry the least recently used key overall.\n  const sortedAll = [...keys].sort((a,b) => new Date(a.lastUsed || 0).getTime() - new Date(b.lastUsed || 0).getTime());\n  const fallbackKey = sortedAll[0];\n  const fallbackIndex = keys.findIndex(k => k.key === fallbackKey.key);\n  \n  if (fallbackKey) {\n    return [fallbackKey, fallbackIndex];\n  }\n  \n  return [null, -1];\n};\n\n\nexport const generateChatResponse = async (messages: ChatMessage[]): Promise<string> => {\n    const settings = await getChatbotSettings();\n    if (!settings.apiKeys || settings.apiKeys.length === 0) {\n        return \"Error: No API keys are configured. Please contact the administrator.\";\n    }\n\n    // Attempt each available key at most once per user request to prevent infinite loops.\n    for (let i = 0; i < settings.apiKeys.length; i++) {\n        const [apiKeyStat, keyIndex] = getNextApiKey(settings.apiKeys);\n\n        if (!apiKeyStat) {\n            break; // No keys are available to try.\n        }\n        \n        const keyToTry = settings.apiKeys[keyIndex];\n        let isKeyInvalid = false;\n\n        // Attempt each model in the fallback list with the current key.\n        for (const model of MODELS) {\n            try {\n                // Optimistically set a failed key to 'active' for a retry attempt.\n                if (keyToTry.status !== 'active') {\n                    keyToTry.status = 'active';\n                }\n\n                const systemMessage = { role: 'system', content: settings.personality };\n                const payload = {\n                    model: model,\n                    messages: [systemMessage, ...messages],\n                    max_tokens: 4096,\n                    temperature: 0.3,\n                    stream: false,\n                };\n\n                const response = await fetch(CEREBRAS_API_URL, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'Authorization': `Bearer ${keyToTry.key}`,\n                    },\n                    body: JSON.stringify(payload),\n                });\n                \n                // Always update lastUsed time for rotation logic.\n                keyToTry.lastUsed = new Date().toISOString();\n\n                if (response.ok) {\n                    const data = await response.json();\n                    keyToTry.usageCount += 1;\n                    await saveChatbotSettings(settings);\n                    return data.choices[0]?.message?.content || \"Sorry, I couldn't generate a response.\";\n                }\n\n                // Handle non-OK responses:\n                // If it's a 401 (Unauthorized) or 429 (Rate Limit), the key is bad.\n                const isKeyError = response.status === 401 || response.status === 429;\n                if (isKeyError) {\n                    keyToTry.status = response.status === 429 ? 'rate-limited' : 'failed';\n                    console.warn(`API key ${keyToTry.key.substring(0, 8)}... failed (status ${response.status}). Trying next key.`);\n                    isKeyInvalid = true;\n                    break; // Stop trying models with this failed key and get a new one.\n                } else {\n                    // Otherwise, it might be a model-specific issue (e.g., 404), so try the next model.\n                    console.warn(`Model '${model}' failed with status ${response.status}. Trying next model in fallback list...`);\n                }\n\n            } catch (error) {\n                // A network error likely means the key is bad or the service is down.\n                keyToTry.lastUsed = new Date().toISOString();\n                keyToTry.status = 'failed';\n                console.error(`Network error with API key ${keyToTry.key.substring(0, 8)}...`, error);\n                isKeyInvalid = true;\n                break; // Stop trying models and get a new key.\n            }\n        }\n        \n        // Save any status changes to the key before the next iteration.\n        await saveChatbotSettings(settings);\n        \n        // If the key failed, the outer loop will now fetch the next available key.\n    }\n\n    // This message is returned only if all keys and all models have failed.\n    return \"I'm having a bit of trouble thinking right now. Please give me a moment and try again.\";\n};","size_bytes":5471},"components/dashboard/ReferralsPage.tsx":{"content":"\nimport React from 'react';\nimport { UserData } from '../../types';\nimport DashboardPageLayout, { InteractiveCard } from './DashboardPageLayout';\nimport { Users, Copy } from 'lucide-react';\nimport { motion } from 'framer-motion';\n\nconst formatCurrency = (value: number) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n\nconst ReferralsPage: React.FC<{ userData: UserData; showToast: (msg: string) => void }> = ({ userData, showToast }) => {\n    const { referrals } = userData;\n\n    const handleCopy = () => {\n        if (referrals.link) {\n            navigator.clipboard.writeText(referrals.link);\n            showToast('Referral link copied!');\n        }\n    };\n\n    return (\n        <DashboardPageLayout title=\"Referrals\" icon={<Users size={28} />}>\n            <p className=\"text-brand-text-secondary\">Earn commissions by referring new users to TradePilot AI. You get a percentage of their profits, forever!</p>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <motion.div initial={{opacity: 0, x: -50}} animate={{opacity: 1, x: 0}} transition={{ duration: 0.5, delay: 0.1 }}>\n                    <InteractiveCard className=\"p-6\">\n                        <p className=\"text-brand-text-secondary\">Total Referrals</p>\n                        <p className=\"text-4xl font-bold text-white font-mono\">{referrals.count}</p>\n                    </InteractiveCard>\n                </motion.div>\n                <motion.div initial={{opacity: 0, x: 50}} animate={{opacity: 1, x: 0}} transition={{ duration: 0.5, delay: 0.2 }}>\n                     <InteractiveCard className=\"p-6\">\n                        <p className=\"text-brand-text-secondary\">Total Earnings</p>\n                        <p className=\"text-4xl font-bold text-white font-mono\">{formatCurrency(referrals.earnings)}</p>\n                    </InteractiveCard>\n                </motion.div>\n            </div>\n\n            <motion.div initial={{opacity: 0, y: 50}} animate={{opacity: 1, y: 0}} transition={{ duration: 0.5, delay: 0.3 }}>\n                <InteractiveCard className=\"p-6\">\n                    <h3 className=\"font-bold text-white text-lg mb-4\">Your Unique Referral Link</h3>\n                    <div className=\"flex items-center bg-brand-bg border border-white/20 rounded-lg p-2\">\n                        <input type=\"text\" readOnly value={referrals.link} className=\"w-full bg-transparent outline-none p-2 text-brand-text-secondary font-mono text-sm\" />\n                        <button onClick={handleCopy} className=\"p-2 text-white hover:text-brand-primary transition-colors\" disabled={!referrals.link}><Copy /></button>\n                    </div>\n                </InteractiveCard>\n            </motion.div>\n\n            <motion.div initial={{opacity: 0, y: 50}} animate={{opacity: 1, y: 0}} transition={{ duration: 0.5, delay: 0.4 }}>\n                <h3 className=\"font-bold text-white text-lg mb-4\">Referral History</h3>\n                <InteractiveCard className=\"p-6\">\n                    {referrals.count > 0 ? (\n                        <div className=\"space-y-3\">\n                            <p className=\"text-brand-text-secondary text-sm\">You have successfully referred {referrals.count} {referrals.count === 1 ? 'user' : 'users'} to TradePilot AI.</p>\n                            <div className=\"p-4 bg-brand-primary/10 rounded-lg border border-brand-primary/30\">\n                                <div className=\"flex justify-between items-center\">\n                                    <div>\n                                        <p className=\"text-brand-text-secondary text-sm\">Total Referrals</p>\n                                        <p className=\"text-2xl font-bold text-white font-mono\">{referrals.count}</p>\n                                    </div>\n                                    <div>\n                                        <p className=\"text-brand-text-secondary text-sm\">Total Earnings</p>\n                                        <p className=\"text-2xl font-bold text-brand-primary font-mono\">{formatCurrency(referrals.earnings)}</p>\n                                    </div>\n                                </div>\n                            </div>\n                            <div className=\"p-3 bg-green-500/10 border border-green-400/50 rounded-lg text-green-300 text-sm\">\n                                <p>💡 <strong>Keep sharing!</strong> You earn a commission for every user who signs up using your referral link and starts trading.</p>\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"text-center py-8\">\n                            <p className=\"text-brand-text-secondary mb-4\">You haven't referred anyone yet.</p>\n                            <p className=\"text-sm text-brand-text-secondary\">Share your referral link above to start earning commissions!</p>\n                        </div>\n                    )}\n                </InteractiveCard>\n            </motion.div>\n        </DashboardPageLayout>\n    );\n};\n\nexport default ReferralsPage;\n","size_bytes":5136},"components/auth/RegisterPage.tsx":{"content":"\nimport React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport AuthLayout from './AuthLayout';\nimport { User, PublicSystemSettings } from '../../types';\nimport { ArrowLeft } from 'lucide-react';\nimport { findUserByEmailOrName, createInitialUserData } from '../../services/userDataService';\nimport ReCaptcha from './ReCaptcha';\n\ninterface RegisterPageProps {\n  onNavigate: (view: 'login' | 'homepage') => void;\n  onRegisterSuccess: (user: User) => void;\n  settings: PublicSystemSettings | null;\n}\n\nconst RegisterPage: React.FC<RegisterPageProps> = ({ onNavigate, onRegisterSuccess, settings }) => {\n  const [name, setName] = useState('');\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [referralCode, setReferralCode] = useState('');\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [recaptchaToken, setRecaptchaToken] = useState<string>('');\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const refCode = params.get('ref');\n    if (refCode) {\n      setReferralCode(refCode);\n    }\n  }, []);\n\n  const handleRegister = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!name || !email || !password || !confirmPassword) {\n      setError('All fields (except referral) are required.');\n      return;\n    }\n    if (password !== confirmPassword) {\n      setError('Passwords do not match.');\n      return;\n    }\n    if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\n        setError('Please enter a valid email address.');\n        return;\n    }\n\n    if (settings?.recaptchaEnabled && !recaptchaToken) {\n      setError('Please complete the reCAPTCHA verification.');\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const existingUser = await findUserByEmailOrName(email);\n      if (existingUser) {\n          setError('An account with this email already exists.');\n          setIsLoading(false);\n          return;\n      }\n\n      const newUser: User = {\n          id: `user-${Date.now()}`,\n          name,\n          email,\n          password,\n          plan: 'Starter AI',\n          balance: 0,\n          totalProfit: 0,\n          hasSeenWelcome: false,\n          isVerified: true,\n      };\n\n      await createInitialUserData(newUser);\n      onRegisterSuccess(newUser);\n      setIsLoading(false);\n    } catch (error) {\n      console.error('Registration failed:', error);\n      setError('Registration failed. Please try again.');\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <AuthLayout>\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl relative\"\n        style={{ transform: 'translateZ(50px)' }}\n      >\n        <button onClick={() => onNavigate('homepage')} className=\"absolute top-4 left-4 text-brand-text-secondary hover:text-white transition-colors\">\n            <ArrowLeft size={24} />\n        </button>\n        <h1 className=\"text-3xl font-bold text-center text-white mb-2\">Create Your Account</h1>\n        <p className=\"text-center text-brand-text-secondary mb-8\">Join the financial revolution.</p>\n        \n        <form onSubmit={handleRegister} className=\"space-y-4\">\n          <input type=\"text\" placeholder=\"Username\" value={name} onChange={(e) => setName(e.target.value)} className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\" />\n          <input type=\"email\" placeholder=\"Email Address\" value={email} onChange={(e) => setEmail(e.target.value)} className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\" />\n          <input type=\"password\" placeholder=\"Password\" value={password} onChange={(e) => setPassword(e.target.value)} className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\" />\n          <input type=\"password\" placeholder=\"Confirm Password\" value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\" />\n          <input type=\"text\" placeholder=\"Referral Code (Optional)\" value={referralCode} onChange={(e) => setReferralCode(e.target.value)} className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\" />\n          \n          {error && <p className=\"text-red-400 text-sm text-center\">{error}</p>}\n          \n          {settings?.recaptchaEnabled && settings.recaptchaSiteKey && (\n            <ReCaptcha\n              siteKey={settings.recaptchaSiteKey}\n              onVerify={setRecaptchaToken}\n              onExpired={() => setRecaptchaToken('')}\n            />\n          )}\n          \n          <button type=\"submit\" disabled={isLoading || (settings?.recaptchaEnabled && !recaptchaToken)} className=\"w-full py-3 bg-gradient-to-br from-brand-primary to-brand-secondary text-brand-bg font-bold rounded-lg shadow-lg shadow-brand-primary/20 hover:shadow-xl hover:shadow-brand-primary/40 transform hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed\">\n            {isLoading ? <div className=\"w-6 h-6 border-2 border-brand-bg border-t-transparent rounded-full animate-spin mx-auto\"></div> : 'Register'}\n          </button>\n        </form>\n        \n        <p className=\"text-center mt-6 text-brand-text-secondary\">\n          Already have an account?{' '}\n          <button onClick={() => onNavigate('login')} className=\"font-bold text-brand-primary hover:underline\">\n            Login\n          </button>\n        </p>\n      </motion.div>\n    </AuthLayout>\n  );\n};\n\nexport default RegisterPage;","size_bytes":6214},"components/admin/WelcomePageEditor.tsx":{"content":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { WelcomePageTemplate } from '../../types';\nimport { getWelcomePageTemplate, saveWelcomePageTemplate } from '../../services/userDataService';\nimport { Save, Eye, Trash2 } from 'lucide-react';\n\nconst Card: React.FC<{children: React.ReactNode, className?: string}> = ({ children, className = '' }) => (\n    <div className={`bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-2xl shadow-lg ${className}`}>\n        {children}\n    </div>\n);\n\nconst WelcomePageEditor: React.FC = () => {\n    const [template, setTemplate] = useState<WelcomePageTemplate | null>(null);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isSaving, setIsSaving] = useState(false);\n    const [saveStatus, setSaveStatus] = useState('');\n    const [errorMessage, setErrorMessage] = useState('');\n\n    const loadTemplate = useCallback(async () => {\n        setIsLoading(true);\n        const data = await getWelcomePageTemplate();\n        setTemplate(data);\n        setIsLoading(false);\n    }, []);\n\n    useEffect(() => {\n        loadTemplate();\n    }, [loadTemplate]);\n\n    const handleSave = async () => {\n        if (template) {\n            try {\n                setIsSaving(true);\n                setErrorMessage('');\n                setSaveStatus('Saving template to server...');\n                \n                console.log('Saving template...', { \n                    hasImage: !!template.imageUrl, \n                    hasVideo: !!template.videoUrl,\n                    imageSize: template.imageUrl?.length || 0,\n                    videoSize: template.videoUrl?.length || 0\n                });\n                \n                await saveWelcomePageTemplate(template);\n                \n                console.log('Template saved successfully');\n                setSaveStatus('✅ Template saved successfully! Changes are permanent.');\n                setTimeout(() => setSaveStatus(''), 4000);\n            } catch (error) {\n                console.error('Failed to save template:', error);\n                setErrorMessage(`❌ Failed to save template. ${error instanceof Error ? error.message : 'Try a smaller video or check your connection.'}`);\n                setTimeout(() => setErrorMessage(''), 6000);\n            } finally {\n                setIsSaving(false);\n            }\n        }\n    };\n\n    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n        if (template) {\n            setTemplate({ ...template, [e.target.name]: e.target.value });\n        }\n    };\n\n    const fileToBase64 = (file: File): Promise<string> => {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(file);\n            reader.onload = () => resolve(reader.result as string);\n            reader.onerror = error => reject(error);\n        });\n    };\n\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>, type: 'image' | 'video') => {\n        const file = e.target.files?.[0];\n        \n        console.log('File upload triggered:', { type, file: file?.name, size: file?.size });\n        \n        if (!file) {\n            console.log('No file selected');\n            return;\n        }\n        \n        if (!template) {\n            console.error('Template not loaded');\n            setErrorMessage('Template not loaded. Please refresh the page.');\n            return;\n        }\n        \n        const maxSizeMB = 100;\n        const fileSizeMB = file.size / (1024 * 1024);\n        \n        console.log(`File size: ${fileSizeMB.toFixed(2)}MB`);\n        \n        if (fileSizeMB > maxSizeMB) {\n            setErrorMessage(`File too large! Maximum size is ${maxSizeMB}MB. Your file is ${fileSizeMB.toFixed(1)}MB.`);\n            setTimeout(() => setErrorMessage(''), 5000);\n            e.target.value = '';\n            return;\n        }\n        \n        setErrorMessage('');\n        setSaveStatus(`Uploading ${type}... (${fileSizeMB.toFixed(1)}MB)`);\n        \n        try {\n            console.log(`Converting ${type} to base64...`);\n            const base64 = await fileToBase64(file);\n            console.log(`${type} converted successfully, uploading to server...`);\n            \n            setSaveStatus(`Uploading ${type} to server...`);\n            \n            const response = await fetch('/api/storage/upload-media', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({\n                    type: 'welcome_page',\n                    mediaType: type,\n                    data: base64\n                }),\n            });\n            \n            const result = await response.json();\n            \n            if (!result.success) {\n                throw new Error(result.message || 'Upload failed');\n            }\n            \n            console.log(`${type} uploaded successfully:`, result.url);\n            \n            if (type === 'image') {\n                setTemplate({ ...template, imageUrl: result.url, videoUrl: '' });\n            }\n            if (type === 'video') {\n                setTemplate({ ...template, videoUrl: result.url, imageUrl: '' });\n            }\n            \n            setSaveStatus(`✅ ${type.charAt(0).toUpperCase() + type.slice(1)} uploaded! Click \"Save Template\" to confirm.`);\n            setTimeout(() => setSaveStatus(''), 5000);\n        } catch (error) {\n            console.error(`Failed to upload ${type}:`, error);\n            setErrorMessage(`Failed to upload ${type}. Error: ${error instanceof Error ? error.message : 'Unknown error'}`);\n            setTimeout(() => setErrorMessage(''), 5000);\n        }\n    };\n\n    const removeMedia = (type: 'image' | 'video') => {\n        if(template) {\n            if(type === 'image') setTemplate({...template, imageUrl: ''});\n            if(type === 'video') setTemplate({...template, videoUrl: ''});\n        }\n    }\n\n    if (isLoading || !template) {\n        return <div className=\"flex items-center justify-center h-64\"><div className=\"w-12 h-12 border-4 border-brand-primary border-t-transparent rounded-full animate-spin\"></div></div>;\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold\">Welcome Page Template</h1>\n            <p className=\"text-brand-text-secondary\">This is the full-screen page a user sees immediately after registration. Use it for a strong visual welcome.</p>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {/* Editor */}\n                <Card className=\"p-6 space-y-4\">\n                    <h2 className=\"text-xl font-bold\">Editor</h2>\n                    <div>\n                        <label className=\"text-sm text-brand-text-secondary\">Title</label>\n                        <input type=\"text\" name=\"title\" value={template.title} onChange={handleInputChange} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/>\n                    </div>\n                    <div>\n                        <label className=\"text-sm text-brand-text-secondary\">Message Body</label>\n                        <textarea name=\"text\" value={template.text} onChange={handleInputChange} rows={8} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/>\n                    </div>\n                     <div>\n                        <label className=\"text-sm text-brand-text-secondary\">Image (replaces video if both are set)</label>\n                        <input type=\"file\" accept=\"image/*\" onChange={e => handleFileChange(e, 'image')} className=\"w-full mt-1 p-1 file:mr-4 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-brand-primary/20 file:text-brand-primary hover:file:bg-brand-primary/40 text-sm text-brand-text-secondary bg-brand-bg rounded border border-white/20\"/>\n                    </div>\n                     <div>\n                        <label className=\"text-sm text-brand-text-secondary\">Video (replaces image if both are set)</label>\n                        <input type=\"file\" accept=\"video/*\" onChange={e => handleFileChange(e, 'video')} className=\"w-full mt-1 p-1 file:mr-4 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-brand-primary/20 file:text-brand-primary hover:file:bg-brand-primary/40 text-sm text-brand-text-secondary bg-brand-bg rounded border border-white/20\"/>\n                    </div>\n                </Card>\n\n                {/* Preview */}\n                <div className=\"space-y-4\">\n                    <h2 className=\"text-xl font-bold flex items-center gap-2\"><Eye size={20}/> Preview</h2>\n                    <Card className=\"p-6 text-center\">\n                        <h1 className=\"text-2xl font-bold text-white mb-4\">{template.title}</h1>\n                        {template.imageUrl && (\n                            <div className=\"relative inline-block\">\n                                <img src={template.imageUrl} alt=\"Preview\" className=\"my-4 rounded-lg max-h-40 mx-auto\"/>\n                                <button onClick={() => removeMedia('image')} className=\"absolute -top-2 -right-2 p-1 bg-red-500 rounded-full text-white\"><Trash2 size={12}/></button>\n                            </div>\n                        )}\n                        {template.videoUrl && (\n                             <div className=\"relative inline-block\">\n                                <video src={template.videoUrl} controls className=\"my-4 rounded-lg w-full max-w-xs mx-auto\"/>\n                                <button onClick={() => removeMedia('video')} className=\"absolute -top-2 -right-2 p-1 bg-red-500 rounded-full text-white\"><Trash2 size={12}/></button>\n                            </div>\n                        )}\n                        <p className=\"text-brand-text-secondary max-w-md mx-auto mb-6 whitespace-pre-wrap\">{template.text}</p>\n                    </Card>\n                </div>\n            </div>\n\n            <div className=\"flex items-center gap-4\">\n                <button \n                    onClick={handleSave} \n                    disabled={isSaving}\n                    className={`px-6 py-3 bg-brand-primary text-brand-bg font-bold rounded-lg flex items-center gap-2 transition-transform ${isSaving ? 'opacity-50 cursor-not-allowed' : 'hover:scale-105'}`}\n                >\n                    <Save size={18}/> {isSaving ? 'Saving...' : 'Save Template'}\n                </button>\n                <AnimatePresence>\n                {saveStatus && (\n                    <motion.p initial={{opacity: 0}} animate={{opacity: 1}} exit={{opacity: 0}} className=\"text-green-400\">{saveStatus}</motion.p>\n                )}\n                {errorMessage && (\n                    <motion.p initial={{opacity: 0}} animate={{opacity: 1}} exit={{opacity: 0}} className=\"text-red-400 font-semibold\">{errorMessage}</motion.p>\n                )}\n                </AnimatePresence>\n            </div>\n        </div>\n    );\n};\n\nexport default WelcomePageEditor;\n","size_bytes":11179},"components/auth/VerificationPage.tsx":{"content":"import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport AuthLayout from './AuthLayout';\nimport { User, UserData } from '../../types';\nimport { verifyUserCode, resendVerificationCode, getUserData } from '../../services/userDataService';\nimport { ArrowLeft, CheckCircle } from 'lucide-react';\n\ninterface VerificationPageProps {\n  user: User;\n  onNavigate: (view: 'register' | 'login') => void;\n  onVerificationSuccess: (user: UserData) => void;\n}\n\nconst VerificationPage: React.FC<VerificationPageProps> = ({ user, onNavigate, onVerificationSuccess }) => {\n  const [code, setCode] = useState<string[]>(Array(5).fill(''));\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [resendStatus, setResendStatus] = useState('');\n  const [resendCooldown, setResendCooldown] = useState(0);\n  const [shake, setShake] = useState(false);\n\n  const inputsRef = useRef<(HTMLInputElement | null)[]>([]);\n\n  useEffect(() => {\n    inputsRef.current[0]?.focus();\n  }, []);\n\n  useEffect(() => {\n    if (resendCooldown > 0) {\n      const timer = setTimeout(() => setResendCooldown(resendCooldown - 1), 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [resendCooldown]);\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>, index: number) => {\n    const { value } = e.target;\n    if (!/^\\d*$/.test(value)) return; // Only allow digits\n\n    const newCode = [...code];\n    newCode[index] = value.slice(-1);\n    setCode(newCode);\n\n    // Move to next input\n    if (value && index < 4) {\n      inputsRef.current[index + 1]?.focus();\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>, index: number) => {\n    if (e.key === 'Backspace' && !code[index] && index > 0) {\n      inputsRef.current[index - 1]?.focus();\n    }\n  };\n\n  const handlePaste = (e: React.ClipboardEvent<HTMLInputElement>) => {\n    e.preventDefault();\n    const pastedData = e.clipboardData.getData('text').trim().slice(0, 5);\n    if (/^\\d{5}$/.test(pastedData)) {\n      const newCode = pastedData.split('');\n      setCode(newCode);\n      inputsRef.current[4]?.focus();\n    }\n  };\n\n  const verifyCode = useCallback(async (fullCode: string) => {\n    setIsLoading(true);\n    setError('');\n    const success = await verifyUserCode(user.id, fullCode);\n    if (success) {\n      setIsSuccess(true);\n      const fullUserData = await getUserData(user.id);\n      setTimeout(() => {\n        if(fullUserData) {\n          onVerificationSuccess(fullUserData);\n        }\n      }, 1500);\n    } else {\n      setError('Invalid or expired code. Please try again.');\n      setShake(true);\n      setTimeout(() => setShake(false), 500);\n      setCode(Array(5).fill(''));\n      inputsRef.current[0]?.focus();\n      setIsLoading(false);\n    }\n  }, [user.id, onVerificationSuccess]);\n\n  useEffect(() => {\n    const fullCode = code.join('');\n    if (fullCode.length === 5 && !isLoading && !isSuccess) {\n      verifyCode(fullCode);\n    }\n  }, [code, isLoading, isSuccess, verifyCode]);\n\n  const handleResend = async () => {\n    if (resendCooldown > 0) return;\n    setResendStatus('Sending...');\n    const result = await resendVerificationCode(user.id);\n    setResendStatus(result.message);\n    setResendCooldown(60);\n    setTimeout(() => setResendStatus(''), 5000);\n  };\n\n  return (\n    <AuthLayout>\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl relative\"\n        style={{ transform: 'translateZ(50px)' }}\n      >\n        <button onClick={() => onNavigate('register')} className=\"absolute top-4 left-4 text-brand-text-secondary hover:text-white transition-colors\">\n          <ArrowLeft size={24} />\n        </button>\n        <AnimatePresence mode=\"wait\">\n          {isSuccess ? (\n            <motion.div\n              key=\"success\"\n              initial={{ opacity: 0, scale: 0.8 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, scale: 0.8 }}\n              className=\"text-center py-12 flex flex-col items-center\"\n            >\n              <CheckCircle className=\"text-green-400 w-20 h-20 mb-4\" />\n              <h2 className=\"text-2xl font-bold text-white\">Verification Successful!</h2>\n              <p className=\"text-brand-text-secondary mt-2\">Redirecting you to the welcome page...</p>\n            </motion.div>\n          ) : (\n            <motion.div key=\"form\">\n              <h1 className=\"text-3xl font-bold text-center text-brand-primary mb-2\">Check Your Email</h1>\n              <p className=\"text-center text-brand-text-secondary mb-8\">\n                We've sent a 5-digit verification code to <span className=\"font-bold text-white\">{user.email}</span>\n              </p>\n              \n              <motion.div \n                className=\"flex justify-center gap-2 sm:gap-4 mb-6\"\n                animate={shake ? { x: [-10, 10, -10, 10, 0] } : {}}\n                transition={{ duration: 0.5 }}\n              >\n                {code.map((digit, index) => (\n                  <input\n                    key={index}\n                    ref={el => { inputsRef.current[index] = el; }}\n                    type=\"tel\"\n                    maxLength={1}\n                    value={digit}\n                    onChange={(e) => handleInputChange(e, index)}\n                    onKeyDown={(e) => handleKeyDown(e, index)}\n                    onPaste={index === 0 ? handlePaste : undefined}\n                    disabled={isLoading}\n                    className=\"w-12 h-14 sm:w-16 sm:h-20 text-center text-3xl sm:text-4xl font-mono font-bold bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white transition-all duration-300 glow-input focus:border-brand-primary\"\n                  />\n                ))}\n              </motion.div>\n\n              {isLoading && <div className=\"flex justify-center\"><div className=\"w-6 h-6 border-2 border-brand-primary border-t-transparent rounded-full animate-spin\"></div></div>}\n              {error && <p className=\"text-red-400 text-sm text-center -mt-2 mb-4\">{error}</p>}\n\n              <div className=\"text-center text-brand-text-secondary text-sm\">\n                Didn't receive a code?{' '}\n                <button\n                  onClick={handleResend}\n                  disabled={resendCooldown > 0}\n                  className=\"font-bold text-brand-primary hover:underline disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Resend Code {resendCooldown > 0 ? `(${resendCooldown}s)` : ''}\n                </button>\n              </div>\n              {resendStatus && <p className=\"text-sm text-center mt-2 text-green-400\">{resendStatus}</p>}\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </motion.div>\n    </AuthLayout>\n  );\n};\n\nexport default VerificationPage;\n","size_bytes":7062},"components/three/NeuralNetwork.tsx":{"content":"import React, { useMemo, useRef } from 'react';\nimport { Canvas, useFrame } from '@react-three/fiber';\nimport { EffectComposer, Bloom } from '@react-three/postprocessing';\nimport * as THREE from 'three';\n\nconst COUNT = 50;\nconst RADIUS = 2;\n\n// FIX: Changed Node to a React.FC to correctly handle the 'key' prop during list rendering.\nconst Node: React.FC<{ position: THREE.Vector3 }> = ({ position }) => (\n    <mesh position={position}>\n        <sphereGeometry args={[0.05, 16, 16]} />\n        <meshBasicMaterial color=\"#00f5ff\" toneMapped={false} />\n    </mesh>\n);\n\nconst Nodes = () => {\n    const nodes = useMemo(() => {\n        const temp = [];\n        const phi = Math.PI * (3. - Math.sqrt(5.)); // golden angle in radians\n        for (let i = 0; i < COUNT; i++) {\n            const y = 1 - (i / (COUNT - 1)) * 2;  // y goes from 1 to -1\n            const radius = Math.sqrt(1 - y * y); // radius at y\n            const theta = phi * i; // golden angle increment\n            const x = Math.cos(theta) * radius;\n            const z = Math.sin(theta) * radius;\n            temp.push(new THREE.Vector3(x,y,z).multiplyScalar(RADIUS));\n        }\n        return temp;\n    }, []);\n\n    return <>{nodes.map((pos, i) => <Node key={i} position={pos} />)}</>;\n};\n\nconst Lines = () => {\n    const linesRef = useRef<THREE.LineSegments>(null!);\n\n    const [positions, indices] = useMemo(() => {\n        const pos = [];\n        const ind = [];\n        const phi = Math.PI * (3. - Math.sqrt(5.));\n        for (let i = 0; i < COUNT; i++) {\n            const y = 1 - (i / (COUNT - 1)) * 2;\n            const radius = Math.sqrt(1 - y * y);\n            const theta = phi * i;\n            pos.push(Math.cos(theta) * radius * RADIUS, y * RADIUS, Math.sin(theta) * radius * RADIUS);\n        }\n\n        for (let i = 0; i < COUNT; i++) {\n            for (let j = i + 1; j < COUNT; j++) {\n                const dist = new THREE.Vector3(pos[i*3], pos[i*3+1], pos[i*3+2]).distanceTo(new THREE.Vector3(pos[j*3], pos[j*3+1], pos[j*3+2]));\n                if (dist < 1.2) {\n                    ind.push(i, j);\n                }\n            }\n        }\n        return [new Float32Array(pos), new Uint16Array(ind)];\n    }, []);\n\n    return (\n        <lineSegments ref={linesRef}>\n            <bufferGeometry>\n                <bufferAttribute attach=\"position\" count={positions.length / 3} array={positions} itemSize={3} />\n                <bufferAttribute attach=\"index\" count={indices.length} array={indices} itemSize={1} />\n            </bufferGeometry>\n            <lineBasicMaterial color=\"#e040fb\" transparent opacity={0.3} toneMapped={false} />\n        </lineSegments>\n    );\n};\n\nconst Scene = () => {\n    const groupRef = useRef<THREE.Group>(null!);\n    useFrame(({ clock }) => {\n        if(groupRef.current) {\n            groupRef.current.rotation.y = clock.getElapsedTime() * 0.1;\n            groupRef.current.rotation.x = clock.getElapsedTime() * 0.05;\n        }\n    });\n    return <group ref={groupRef}><Nodes /><Lines /></group>;\n}\n\nconst NeuralNetwork = () => {\n    return (\n        <Canvas camera={{ position: [0, 0, 5], fov: 50 }}>\n            <Scene />\n            <EffectComposer>\n                <Bloom luminanceThreshold={0} luminanceSmoothing={0.9} height={300} intensity={1.5} />\n            </EffectComposer>\n        </Canvas>\n    );\n};\n\nexport default NeuralNetwork;\n","size_bytes":3362},"components/dashboard/DashboardPageLayout.tsx":{"content":"\nimport React, { useRef } from 'react';\nimport { motion, useMotionValue, useTransform } from 'framer-motion';\n\ninterface DashboardPageLayoutProps {\n  title: string;\n  icon: React.ReactNode;\n  children: React.ReactNode;\n}\n\nconst Card: React.FC<{children: React.ReactNode, className?: string}> = ({ children, className = '' }) => {\n    const ref = useRef<HTMLDivElement>(null);\n    const x = useMotionValue(0);\n    const y = useMotionValue(0);\n\n    const rotateX = useTransform(y, [-200, 200], [5, -5]);\n    const rotateY = useTransform(x, [-200, 200], [-5, 5]);\n\n    const handleMouseMove = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n        if(!ref.current) return;\n        const rect = ref.current.getBoundingClientRect();\n        x.set(e.clientX - rect.left - rect.width / 2);\n        y.set(e.clientY - rect.top - rect.height / 2);\n    };\n    \n    const handleMouseLeave = () => {\n        x.set(0);\n        y.set(0);\n    }\n    \n    return (\n        <motion.div\n            ref={ref}\n            onMouseMove={handleMouseMove}\n            onMouseLeave={handleMouseLeave}\n            style={{ rotateX, rotateY, transformStyle: 'preserve-3d' }}\n            className={`bg-brand-surface/20 backdrop-blur-lg border border-white/10 rounded-3xl shadow-2xl shadow-black/30 ${className}`}\n        >\n            <div style={{ transform: 'translateZ(20px)' }}>\n                {children}\n            </div>\n        </motion.div>\n    )\n};\n\n\nconst DashboardPageLayout: React.FC<DashboardPageLayoutProps> = ({ title, icon, children }) => {\n  const pageVariants = {\n    initial: { opacity: 0, y: 20, scale: 0.98 },\n    in: { opacity: 1, y: 0, scale: 1 },\n    out: { opacity: 0, y: -20, scale: 0.98 },\n  };\n\n  return (\n    <motion.div\n      key={title}\n      initial=\"initial\"\n      animate=\"in\"\n      exit=\"out\"\n      variants={pageVariants}\n      transition={{ duration: 0.4, ease: 'easeInOut' }}\n      className=\"flex flex-col gap-8 mt-12 lg:mt-0\"\n    >\n      <div className=\"flex items-center gap-4\">\n        <motion.div \n            className=\"p-3 bg-brand-primary/10 text-brand-primary rounded-full shadow-[0_0_20px_theme(colors.brand.primary)]\"\n            animate={{ scale: [1, 1.1, 1], y: [0, -5, 0] }}\n            transition={{ repeat: Infinity, duration: 3, ease: 'easeInOut' }}\n        >\n          {icon}\n        </motion.div>\n        <h1 className=\"text-3xl lg:text-4xl font-bold text-white tracking-wider\">{title}</h1>\n      </div>\n      {children}\n    </motion.div>\n  );\n};\n\nexport default DashboardPageLayout;\nexport { Card as InteractiveCard };\n","size_bytes":2559},"index.tsx":{"content":"\nimport React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\n\n// This is the entry point of your application.\n// It finds the 'root' element in your HTML and renders the main App component into it.\n\nconst rootElement = document.getElementById('root');\nif (!rootElement) {\n  throw new Error(\"Could not find root element to mount to\");\n}\n\nconst root = ReactDOM.createRoot(rootElement);\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n","size_bytes":488},"components/dashboard/MessagesPanel.tsx":{"content":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { UserData, Message } from '../../types';\nimport * as userDataService from '../../services/userDataService';\nimport { X, ArrowLeft, Mail } from 'lucide-react';\n\ninterface MessagesPanelProps {\n    isOpen: boolean;\n    onClose: () => void;\n    user: UserData;\n}\n\nconst MessagesPanel: React.FC<MessagesPanelProps> = ({ isOpen, onClose, user }) => {\n    const [messages, setMessages] = useState<Message[]>([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [selectedMessage, setSelectedMessage] = useState<Message | null>(null);\n\n    const loadMessages = useCallback(async () => {\n        if (!user) return;\n        setIsLoading(true);\n        const fetchedMessages = await userDataService.getMessages();\n        const userMessages = fetchedMessages\n            .filter(msg => !msg.recipientId || msg.recipientId === user.id)\n            .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n        setMessages(userMessages);\n        setIsLoading(false);\n    }, [user]);\n\n    useEffect(() => {\n        if (isOpen) {\n            loadMessages();\n        } else {\n            // Reset view when panel is closed to ensure it opens to the list view next time\n            const timer = setTimeout(() => setSelectedMessage(null), 300);\n            return () => clearTimeout(timer);\n        }\n    }, [isOpen, loadMessages]);\n\n    const panelVariants = {\n        hidden: { x: '100%' },\n        visible: { x: '0%', transition: { duration: 0.5, ease: [0.22, 1, 0.36, 1] } },\n        exit: { x: '100%', transition: { duration: 0.4, ease: [0.76, 0, 0.24, 1] } },\n    };\n    \n    const viewVariants = {\n        hidden: { opacity: 0, x: 20 },\n        visible: { opacity: 1, x: 0 },\n        exit: { opacity: 0, x: -20 },\n    };\n\n    const renderMessageList = () => (\n        <motion.div key=\"list\" initial=\"hidden\" animate=\"visible\" exit=\"exit\" variants={viewVariants} className=\"flex flex-col h-full\">\n            <div className=\"flex-shrink-0 flex justify-between items-center p-4 border-b border-white/10\">\n                <h2 className=\"text-xl font-bold text-white\">Inbox</h2>\n                <button onClick={onClose} className=\"p-2 rounded-full hover:bg-white/10\"><X size={20} /></button>\n            </div>\n            <div className=\"flex-grow overflow-y-auto\">\n            {isLoading ? (\n                <div className=\"flex items-center justify-center h-full\"><div className=\"w-8 h-8 border-2 border-brand-primary border-t-transparent rounded-full animate-spin\"></div></div>\n            ) : messages.length === 0 ? (\n                 <div className=\"flex flex-col items-center justify-center h-full text-center text-brand-text-secondary p-4\">\n                    <Mail size={40} className=\"mb-4\" />\n                    <p>Your inbox is empty.</p>\n                </div>\n            ) : (\n                <ul className=\"p-2\">\n                    {messages.map((msg, i) => (\n                        <motion.li \n                            key={msg.id}\n                            initial={{ opacity: 0, y: 20 }}\n                            animate={{ opacity: 1, y: 0, transition: { delay: i * 0.05 } }}\n                            onClick={() => setSelectedMessage(msg)}\n                            className=\"cursor-pointer mb-2\"\n                        >\n                            <div className=\"p-4 bg-brand-surface/30 hover:bg-brand-surface/60 border border-white/5 hover:border-brand-primary/50 rounded-lg transition-colors shadow-md hover:shadow-brand-primary/20\">\n                                <p className=\"font-bold text-white truncate\">{msg.title}</p>\n                                <p className=\"text-sm text-brand-text-secondary truncate mt-1\">{msg.text}</p>\n                                <p className=\"text-xs text-brand-text-secondary/60 mt-2\">{new Date(msg.createdAt).toLocaleString()}</p>\n                            </div>\n                        </motion.li>\n                    ))}\n                </ul>\n            )}\n            </div>\n        </motion.div>\n    );\n\n    const renderMessageDetail = () => (\n        <motion.div key=\"detail\" initial=\"hidden\" animate=\"visible\" exit=\"exit\" variants={viewVariants} className=\"flex flex-col h-full\">\n            <div className=\"flex-shrink-0 flex items-center p-4 border-b border-white/10\">\n                <motion.button \n                  onClick={() => setSelectedMessage(null)} \n                  className=\"p-2 rounded-full hover:bg-white/10 mr-2\"\n                  whileHover={{ scale: 1.1 }}\n                  whileTap={{ scale: 0.9 }}\n                >\n                    <ArrowLeft size={20} />\n                </motion.button>\n                <h2 className=\"text-xl font-bold text-white truncate\">{selectedMessage?.title}</h2>\n            </div>\n            <div className=\"flex-grow overflow-y-auto p-6\">\n                {selectedMessage?.imageUrl && <img src={selectedMessage.imageUrl} alt=\"Message visual\" className=\"mb-4 rounded-lg w-full\" />}\n                {selectedMessage?.videoEmbedHtml && <div className=\"mb-4 rounded-lg overflow-hidden\" dangerouslySetInnerHTML={{ __html: selectedMessage.videoEmbedHtml }} />}\n                {!selectedMessage?.videoEmbedHtml && selectedMessage?.videoUrl && <video src={selectedMessage.videoUrl} controls className=\"mb-4 rounded-lg w-full\" />}\n                <p className=\"text-brand-text-secondary whitespace-pre-wrap\">{selectedMessage?.text}</p>\n                <p className=\"text-xs text-brand-text-secondary/60 mt-6 text-right\">\n                    {new Date(selectedMessage?.createdAt || 0).toLocaleString()}\n                </p>\n            </div>\n        </motion.div>\n    );\n\n    return (\n        <AnimatePresence>\n            {isOpen && (\n                <>\n                    <motion.div \n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        exit={{ opacity: 0 }}\n                        className=\"fixed inset-0 bg-black/60 z-30\" \n                        onClick={onClose}\n                    />\n                    <motion.div\n                        variants={panelVariants}\n                        initial=\"hidden\"\n                        animate=\"visible\"\n                        exit=\"exit\"\n                        className=\"fixed top-0 right-0 h-full w-full max-w-md bg-brand-surface/80 backdrop-blur-xl border-l border-white/10 z-40 flex flex-col\"\n                    >\n                       <AnimatePresence mode=\"wait\">\n                           {selectedMessage ? renderMessageDetail() : renderMessageList()}\n                       </AnimatePresence>\n                    </motion.div>\n                </>\n            )}\n        </AnimatePresence>\n    );\n};\n\nexport default MessagesPanel;\n","size_bytes":6882},"components/dashboard/NotificationPermissionModal.tsx":{"content":"\nimport React from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Bell } from 'lucide-react';\nimport { requestNotificationPermission } from '../../services/userDataService';\n\ninterface NotificationPermissionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onPermissionResult: (permission: 'granted' | 'denied' | 'default') => void;\n}\n\nconst NotificationPermissionModal: React.FC<NotificationPermissionModalProps> = ({ isOpen, onClose, onPermissionResult }) => {\n  const handleAllow = async () => {\n    const permission = await requestNotificationPermission();\n    if (permission !== 'unsupported') {\n      onPermissionResult(permission);\n    }\n    onClose();\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          className=\"fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n        >\n          <motion.div\n            className=\"bg-brand-surface/50 backdrop-blur-xl border border-white/10 rounded-2xl w-full max-w-md p-8 shadow-2xl relative text-center\"\n            initial={{ scale: 0.9, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            exit={{ scale: 0.9, opacity: 0 }}\n            transition={{ type: 'spring', stiffness: 300, damping: 25 }}\n          >\n            <div className=\"flex justify-center mb-4\">\n                <div className=\"p-4 bg-brand-primary/10 rounded-full text-brand-primary shadow-[0_0_20px_theme(colors.brand.primary)]\">\n                    <Bell size={32} />\n                </div>\n            </div>\n            <h2 className=\"text-2xl font-bold mb-2 text-white\">Enable Notifications</h2>\n            <p className=\"text-brand-text-secondary mb-6\">\n                Get real-time updates on AI profits, new messages, and account activity. Stay in the loop!\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-4\">\n                <button\n                    onClick={onClose}\n                    className=\"w-full px-4 py-3 bg-white/10 text-white rounded-lg font-bold transition-colors hover:bg-white/20\"\n                >\n                    Maybe Later\n                </button>\n                <button\n                    onClick={handleAllow}\n                    className=\"w-full px-4 py-3 bg-brand-primary text-brand-bg rounded-lg font-bold transition-transform hover:scale-105\"\n                >\n                    Allow Notifications\n                </button>\n            </div>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default NotificationPermissionModal;","size_bytes":2685},"components/chatbot/ChatWindow.tsx":{"content":"\nimport React, { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Send, X } from 'lucide-react';\nimport { ChatMessage } from '../../types';\nimport { generateChatResponse } from '../../services/cerebrasService';\n\ninterface ChatWindowProps {\n    onClose: () => void;\n    onNewAiMessage: () => void;\n}\n\nconst ChatWindow: React.FC<ChatWindowProps> = ({ onClose, onNewAiMessage }) => {\n    const [messages, setMessages] = useState<ChatMessage[]>([]);\n    const [input, setInput] = useState('');\n    const [isTyping, setIsTyping] = useState(false);\n    const messagesEndRef = useRef<HTMLDivElement>(null);\n    const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n    const scrollToBottom = () => {\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n    };\n\n    useEffect(() => {\n        const sendInitialMessage = async () => {\n            setIsTyping(true);\n            try {\n                // This is a \"hidden\" user message to prompt the AI. The response will be the first visible message.\n                const prompt: ChatMessage[] = [{\n                    role: 'user',\n                    content: \"Hello! Please introduce yourself and start a friendly conversation.\"\n                }];\n                \n                const response = await generateChatResponse(prompt);\n                const aiMessage: ChatMessage = { role: 'assistant', content: response };\n                setMessages([aiMessage]);\n            } catch (error) {\n                console.error(\"Failed to get initial chat response:\", error);\n                const errorMessage: ChatMessage = { role: 'assistant', content: \"Hello! I'm the TradePilot AI assistant. How can I help you today?\" };\n                setMessages([errorMessage]);\n            } finally {\n                setIsTyping(false);\n            }\n        };\n\n        // Only run if there are no messages.\n        if (messages.length === 0) {\n            sendInitialMessage();\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    useEffect(scrollToBottom, [messages, isTyping]);\n\n    useEffect(() => {\n        if (textareaRef.current) {\n            textareaRef.current.style.height = 'auto';\n            const scrollHeight = textareaRef.current.scrollHeight;\n            textareaRef.current.style.height = `${scrollHeight}px`;\n        }\n    }, [input]);\n\n    const handleSend = async () => {\n        if (input.trim() === '' || isTyping) return;\n\n        const userMessage: ChatMessage = { role: 'user', content: input.trim() };\n        const newMessages = [...messages, userMessage];\n        setMessages(newMessages);\n        setInput('');\n        setIsTyping(true);\n\n        try {\n            const response = await generateChatResponse(newMessages);\n            const aiMessage: ChatMessage = { role: 'assistant', content: response };\n            setMessages(prev => [...prev, aiMessage]);\n            onNewAiMessage();\n        } catch (error) {\n            console.error(\"Failed to get chat response:\", error);\n            const errorMessage: ChatMessage = { role: 'assistant', content: \"I'm having a bit of trouble thinking right now. Please give me a moment and try again.\" };\n            setMessages(prev => [...prev, errorMessage]);\n        } finally {\n            setIsTyping(false);\n        }\n    };\n\n    return (\n        <motion.div\n            initial={{ y: \"100%\" }}\n            animate={{ y: \"0%\" }}\n            exit={{ y: \"100%\" }}\n            transition={{ duration: 0.5, ease: [0.22, 1, 0.36, 1] }}\n            className=\"fixed inset-0 z-[100] flex flex-col bg-brand-bg/80 backdrop-blur-2xl font-sans\"\n        >\n            {/* Header */}\n            <header className=\"flex-shrink-0 flex items-center justify-between p-4 border-b border-white/10\">\n                <div className=\"flex items-center gap-3\">\n                    <motion.div \n                        className=\"relative\"\n                        initial={{ scale: 0 }}\n                        animate={{ scale: 1, transition: { delay: 0.3 } }}\n                    >\n                         <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                            <defs>\n                                <linearGradient id=\"avatar-head-grad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                                    <stop offset=\"0%\" stopColor=\"#1a1a2e\"/>\n                                    <stop offset=\"100%\" stopColor=\"#0a0a1a\"/>\n                                </linearGradient>\n                                <filter id=\"avatar-glow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n                                    <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"1\" result=\"blur\"/>\n                                    <feMerge>\n                                        <feMergeNode in=\"blur\"/>\n                                        <feMergeNode in=\"SourceGraphic\"/>\n                                    </feMerge>\n                                </filter>\n                            </defs>\n                            <path d=\"M12 2C6.47715 2 2 6.47715 2 12V15C2 18.866 5.13401 22 9 22H15C18.866 22 22 18.866 22 15V12C22 6.47715 17.5228 2 12 2Z\" fill=\"url(#avatar-head-grad)\" stroke=\"#00f5ff\" strokeWidth=\"1\"/>\n                            <rect x=\"7\" y=\"9\" width=\"2\" height=\"2\" rx=\"1\" fill=\"#00f5ff\" filter=\"url(#avatar-glow)\"/>\n                            <rect x=\"15\" y=\"9\" width=\"2\" height=\"2\" rx=\"1\" fill=\"#00f5ff\" filter=\"url(#avatar-glow)\"/>\n                            <path d=\"M9 15.5C9.5 16.5 10.6667 17 12 17C13.3333 17 14.5 16.5 15 15.5\" stroke=\"#e040fb\" strokeWidth=\"1.5\" strokeLinecap=\"round\"/>\n                        </svg>\n                        <div className=\"absolute top-0 right-0 w-2.5 h-2.5 rounded-full bg-green-400 border-2 border-brand-bg animate-pulse shadow-[0_0_8px_theme(colors.green.400)]\"></div>\n                    </motion.div>\n                    <h3 className=\"text-xl font-bold text-white\">TradePilot AI</h3>\n                </div>\n                <motion.button \n                    onClick={onClose} \n                    className=\"p-2 rounded-full hover:bg-white/10 text-brand-text-secondary\"\n                    whileHover={{ scale: 1.1, rotate: 90 }}\n                    whileTap={{ scale: 0.9 }}\n                >\n                    <X size={24} />\n                </motion.button>\n            </header>\n\n            {/* Messages */}\n            <div className=\"flex-grow p-4 overflow-y-auto space-y-6\">\n                <AnimatePresence initial={false}>\n                    {messages.map((msg, index) => (\n                        <motion.div \n                            key={index} \n                            className={`flex items-end gap-2 ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                            layout\n                            initial={{ opacity: 0, y: 20 }}\n                            animate={{ opacity: 1, y: 0 }}\n                            exit={{ opacity: 0 }}\n                        >\n                            <div className={`max-w-[85%] px-4 py-3 rounded-2xl shadow-lg ${msg.role === 'user' ? 'bg-gradient-to-br from-brand-primary to-cyan-400 text-brand-bg rounded-br-none shadow-brand-primary/20' : 'bg-brand-surface border border-white/10 text-white rounded-bl-none shadow-black/30'}`}>\n                               <p className=\"text-sm whitespace-pre-wrap\">{msg.content}</p>\n                            </div>\n                        </motion.div>\n                    ))}\n                </AnimatePresence>\n                <AnimatePresence>\n                    {isTyping && (\n                        <motion.div \n                            initial={{ opacity: 0, y: 10 }}\n                            animate={{ opacity: 1, y: 0 }}\n                            exit={{ opacity: 0 }}\n                            className=\"flex justify-start\"\n                        >\n                            <div className=\"px-4 py-3 rounded-2xl rounded-bl-none bg-brand-surface border border-white/10 flex items-center gap-2 shadow-lg\">\n                                <motion.div className=\"w-2 h-2 bg-white/50 rounded-full\" animate={{ y: [0,-4,0] }} transition={{ duration: 0.8, repeat: Infinity, ease: \"easeInOut\" }}/>\n                                <motion.div className=\"w-2 h-2 bg-white/50 rounded-full\" animate={{ y: [0,-4,0] }} transition={{ duration: 0.8, repeat: Infinity, ease: \"easeInOut\", delay: 0.2 }}/>\n                                <motion.div className=\"w-2 h-2 bg-white/50 rounded-full\" animate={{ y: [0,-4,0] }} transition={{ duration: 0.8, repeat: Infinity, ease: \"easeInOut\", delay: 0.4 }}/>\n                            </div>\n                        </motion.div>\n                    )}\n                </AnimatePresence>\n                <div ref={messagesEndRef} />\n            </div>\n\n            {/* Input */}\n            <footer className=\"flex-shrink-0 p-4 border-t border-white/10\">\n                <div className=\"flex items-end gap-3 bg-brand-surface/50 p-2 rounded-2xl border border-white/10 focus-within:border-brand-primary transition-colors duration-300\">\n                    <textarea\n                        ref={textareaRef}\n                        value={input}\n                        onChange={(e) => setInput(e.target.value)}\n                        onKeyPress={(e) => {\n                            if (e.key === 'Enter' && !e.shiftKey) {\n                                e.preventDefault();\n                                handleSend();\n                            }\n                        }}\n                        placeholder=\"Ask anything...\"\n                        className=\"flex-grow w-full bg-transparent p-2 text-white placeholder-brand-text-secondary outline-none resize-none max-h-32\"\n                        rows={1}\n                    />\n                    <motion.button \n                        onClick={handleSend} \n                        className=\"w-11 h-11 flex-shrink-0 rounded-full bg-brand-primary text-brand-bg flex items-center justify-center disabled:opacity-50 disabled:scale-100\" \n                        disabled={isTyping || input.trim() === ''}\n                        whileHover={{ scale: 1.1 }}\n                        whileTap={{ scale: 0.95 }}\n                        aria-label=\"Send message\"\n                    >\n                        <Send size={20} />\n                    </motion.button>\n                </div>\n            </footer>\n        </motion.div>\n    );\n};\n\nexport default ChatWindow;","size_bytes":10574},"vite.config.ts":{"content":"import { defineConfig } from 'vite';\nimport react from '@vitejs/plugin-react';\n\nexport default defineConfig({\n  plugins: [react()],\n  server: {\n    host: '0.0.0.0',\n    port: 5000,\n    strictPort: true,\n    allowedHosts: true,\n    hmr: {\n      clientPort: 5000,\n    },\n    proxy: {\n      '/api': {\n        target: 'http://localhost:3000',\n        changeOrigin: true,\n      },\n    },\n  },\n  preview: {\n    host: '0.0.0.0',\n    port: 5000,\n    strictPort: true,\n    allowedHosts: true,\n  },\n});\n","size_bytes":493},"components/auth/ForgotPasswordPage.tsx":{"content":"\nimport React, { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport AuthLayout from './AuthLayout';\nimport { findUserByEmailOrName } from '../../services/userDataService';\nimport { ArrowLeft } from 'lucide-react';\n\ninterface ForgotPasswordPageProps {\n  onNavigate: (view: 'login' | 'homepage') => void;\n}\n\nconst ForgotPasswordPage: React.FC<ForgotPasswordPageProps> = ({ onNavigate }) => {\n  const [email, setEmail] = useState('');\n  const [message, setMessage] = useState('');\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleReset = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setMessage('');\n    setIsLoading(true);\n\n    if (!email) {\n      setError('Please enter your email address.');\n      setIsLoading(false);\n      return;\n    }\n\n    try {\n      const user = await findUserByEmailOrName(email);\n      if (user) {\n        // Simulate sending a reset link\n        setMessage('A password reset link has been sent to your email.');\n      } else {\n        setError('Email not registered.');\n      }\n    } catch (e) {\n      setError('An unexpected error occurred. Please try again.');\n    } finally {\n        setTimeout(() => setIsLoading(false), 1000);\n    }\n  };\n\n  return (\n    <AuthLayout>\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl relative\"\n        style={{ transform: 'translateZ(50px)' }}\n      >\n        <button onClick={() => onNavigate('homepage')} className=\"absolute top-4 left-4 text-brand-text-secondary hover:text-white transition-colors\">\n            <ArrowLeft size={24} />\n        </button>\n        <h1 className=\"text-3xl font-bold text-center text-white mb-2\">Reset Password</h1>\n        <p className=\"text-center text-brand-text-secondary mb-8\">Enter your email to receive a reset link.</p>\n        \n        {message ? (\n            <div className=\"text-center\">\n                <p className=\"text-green-400 mb-6\">{message}</p>\n                <button onClick={() => onNavigate('login')} className=\"w-full py-3 bg-gradient-to-br from-brand-primary to-brand-secondary text-brand-bg font-bold rounded-lg shadow-lg shadow-brand-primary/20 hover:shadow-xl hover:shadow-brand-primary/40 transform hover:-translate-y-1 transition-all duration-300\">\n                    Back to Login\n                </button>\n            </div>\n        ) : (\n            <form onSubmit={handleReset} className=\"space-y-4\">\n            <input\n                type=\"email\"\n                placeholder=\"Email Address\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\"\n            />\n            \n            {error && <p className=\"text-red-400 text-sm text-center\">{error}</p>}\n            \n            <button\n                type=\"submit\"\n                disabled={isLoading}\n                className=\"w-full py-3 bg-gradient-to-br from-brand-primary to-brand-secondary text-brand-bg font-bold rounded-lg shadow-lg shadow-brand-primary/20 hover:shadow-xl hover:shadow-brand-primary/40 transform hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n                {isLoading ? <div className=\"w-6 h-6 border-2 border-brand-bg border-t-transparent rounded-full animate-spin mx-auto\"></div> : 'Reset Password'}\n            </button>\n            </form>\n        )}\n        \n        <p className=\"text-center mt-6 text-brand-text-secondary\">\n          Remember your password?{' '}\n          <button onClick={() => onNavigate('login')} className=\"font-bold text-brand-primary hover:underline\">\n            Login\n          </button>\n        </p>\n      </motion.div>\n    </AuthLayout>\n  );\n};\n\nexport default ForgotPasswordPage;\n","size_bytes":4110},"components/auth/AuthBackground.tsx":{"content":"\nimport React, { useRef, useMemo } from 'react';\nimport { Canvas, useFrame } from '@react-three/fiber';\nimport * as THREE from 'three';\n\nconst Particles: React.FC<{ count: number }> = ({ count }) => {\n  const mesh = useRef<THREE.InstancedMesh>(null!);\n  const light = useRef<THREE.PointLight>(null!);\n  const dummy = useMemo(() => new THREE.Object3D(), []);\n\n  const particles = useMemo(() => {\n    const temp = [];\n    for (let i = 0; i < count; i++) {\n      const time = Math.random() * 100;\n      const factor = 20 + Math.random() * 100;\n      const speed = 0.005 + Math.random() / 200;\n      const x = (Math.random() - 0.5) * 80;\n      const y = (Math.random() - 0.5) * 80;\n      const z = (Math.random() - 0.5) * 80;\n      temp.push({ time, factor, speed, x, y, z });\n    }\n    return temp;\n  }, [count]);\n\n  useFrame((state) => {\n    if(!mesh.current) return;\n\n    particles.forEach((particle, i) => {\n      let { factor, speed, x, y, z } = particle;\n      const t = (particle.time += speed);\n      dummy.position.set(\n        x + Math.cos((t / 10) * factor) + (Math.sin(t * 1) * factor) / 10,\n        y + Math.sin((t / 10) * factor) + (Math.cos(t * 2) * factor) / 10,\n        z + Math.cos((t / 10) * factor) + (Math.sin(t * 3) * factor) / 10\n      );\n      dummy.scale.setScalar(0.15 + Math.sin(t*speed*10) * 0.1);\n      dummy.rotation.set(t, t, t);\n      dummy.updateMatrix();\n      mesh.current.setMatrixAt(i, dummy.matrix);\n    });\n    mesh.current.instanceMatrix.needsUpdate = true;\n    \n    if(light.current) {\n        light.current.position.set(state.pointer.x * 20, state.pointer.y * 20, 0);\n    }\n  });\n\n  return (\n    <>\n      <pointLight ref={light} distance={50} intensity={20} color=\"#00f5ff\" />\n      <instancedMesh ref={mesh} args={[undefined, undefined, count]}>\n        <icosahedronGeometry args={[0.2, 0]} />\n        <meshStandardMaterial color=\"#e040fb\" roughness={0.5} emissive=\"#e040fb\" emissiveIntensity={2} />\n      </instancedMesh>\n    </>\n  );\n};\n\nconst AuthBackground: React.FC = () => {\n  return (\n    <div className=\"absolute inset-0 z-0 bg-brand-bg\">\n      <Canvas camera={{ position: [0, 0, 40], fov: 75 }}>\n        <ambientLight intensity={0.2} />\n        <Particles count={300} />\n      </Canvas>\n    </div>\n  );\n};\n\nexport default AuthBackground;\n","size_bytes":2286},"components/three/DashboardBackground.tsx":{"content":"\nimport React, { useRef, useMemo } from 'react';\nimport { Canvas, useFrame } from '@react-three/fiber';\nimport * as THREE from 'three';\n\nconst Particles: React.FC<{ count: number }> = ({ count }) => {\n  const mesh = useRef<THREE.InstancedMesh>(null!);\n  const light = useRef<THREE.PointLight>(null!);\n  const dummy = useMemo(() => new THREE.Object3D(), []);\n\n  const particles = useMemo(() => {\n    const temp = [];\n    for (let i = 0; i < count; i++) {\n      const time = Math.random() * 100;\n      const factor = 20 + Math.random() * 100;\n      const speed = 0.005 + Math.random() / 200;\n      const x = (Math.random() - 0.5) * 60;\n      const y = (Math.random() - 0.5) * 60;\n      const z = (Math.random() - 0.5) * 60;\n      temp.push({ time, factor, speed, x, y, z });\n    }\n    return temp;\n  }, [count]);\n\n  useFrame((state, delta) => {\n    if(!mesh.current) return;\n\n    particles.forEach((particle, i) => {\n      let { factor, speed, x, y, z } = particle;\n      const t = (particle.time += speed);\n      dummy.position.set(\n        x + Math.cos((t / 10) * factor) + (Math.sin(t * 1) * factor) / 10,\n        y + Math.sin((t / 10) * factor) + (Math.cos(t * 2) * factor) / 10,\n        z + Math.cos((t / 10) * factor) + (Math.sin(t * 3) * factor) / 10\n      );\n      dummy.scale.setScalar(0.1);\n      dummy.rotation.set(t, t, t);\n      dummy.updateMatrix();\n      mesh.current.setMatrixAt(i, dummy.matrix);\n    });\n    mesh.current.instanceMatrix.needsUpdate = true;\n    \n    if(light.current) {\n        light.current.position.set(state.pointer.x * 10, state.pointer.y * 10, 0);\n    }\n  });\n\n  return (\n    <>\n      <pointLight ref={light} distance={40} intensity={15} color=\"#00f5ff\" />\n      <instancedMesh ref={mesh} args={[undefined, undefined, count]}>\n        <sphereGeometry args={[0.1, 32, 32]} />\n        <meshStandardMaterial color=\"#e040fb\" roughness={0.5} emissive=\"#e040fb\" emissiveIntensity={1} />\n      </instancedMesh>\n    </>\n  );\n};\n\nconst DashboardBackground: React.FC = () => {\n  return (\n    <div className=\"absolute inset-0 z-0 opacity-40\">\n      <Canvas camera={{ position: [0, 0, 30], fov: 75 }}>\n        <ambientLight intensity={0.1} />\n        <Particles count={200} />\n      </Canvas>\n    </div>\n  );\n};\n\nexport default DashboardBackground;\n","size_bytes":2272},"components/dashboard/WithdrawPage.tsx":{"content":"import React, { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\n// FIX: Imported the 'Transaction' type to resolve a type error in the handleWithdraw function.\nimport { UserData, WalletConfig, Transaction } from '../../types';\nimport DashboardPageLayout, { InteractiveCard } from './DashboardPageLayout';\nimport { getWalletConfig, addTransaction } from '../../services/userDataService';\nimport { ArrowUpFromLine } from 'lucide-react';\n\nconst formatCurrency = (value: number) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n\nconst CRYPTO_LOGOS: { [key: string]: string } = {\n    BTC: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/btc.svg',\n    ETH: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/eth.svg',\n    USDT: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/usdt.svg'\n};\n\nconst WithdrawPage: React.FC<{\n    userData: UserData;\n    showToast: (msg: string, type?: 'success' | 'error') => void;\n    onUpdate: () => void;\n}> = ({ userData, showToast, onUpdate }) => {\n    const [amount, setAmount] = useState('');\n    const [address, setAddress] = useState('');\n    const [selectedCrypto, setSelectedCrypto] = useState<string>('');\n    const [walletConfig, setWalletConfig] = useState<WalletConfig | null>(null);\n    const detailsRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        const fetchConfig = async () => {\n            const config = await getWalletConfig();\n            setWalletConfig(config);\n        };\n        fetchConfig();\n    }, []);\n\n    useEffect(() => {\n        if (selectedCrypto && detailsRef.current) {\n            const timer = setTimeout(() => {\n                detailsRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            }, 100);\n            return () => clearTimeout(timer);\n        }\n    }, [selectedCrypto]);\n\n    const handleWithdraw = async (txData: Omit<Transaction, 'id' | 'date' | 'status'>) => {\n        const updatedData = await addTransaction(userData.id, txData);\n        if (updatedData) {\n            onUpdate();\n        } else {\n             showToast('Transaction failed: Insufficient funds.', 'error');\n        }\n    };\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!walletConfig || !selectedCrypto) return;\n\n        const numericAmount = parseFloat(amount);\n        const wallet = walletConfig[selectedCrypto];\n        if (!wallet) {\n            showToast('Selected crypto wallet not found.', 'error');\n            return;\n        }\n\n        if (isNaN(numericAmount) || numericAmount <= 0) {\n            showToast('Please enter a valid amount.', 'error');\n            return;\n        }\n        if (numericAmount > userData.balance) {\n            showToast('Insufficient balance.', 'error');\n            return;\n        }\n        if (numericAmount < 10) {\n            showToast(`Minimum withdrawal is $10.00.`, 'error');\n            return;\n        }\n        if (!address) {\n            showToast('Please enter a withdrawal address.', 'error');\n            return;\n        }\n\n        handleWithdraw({\n            type: 'Withdrawal',\n            amount: numericAmount,\n            asset: selectedCrypto,\n            usdValue: numericAmount,\n        });\n        showToast('Withdrawal request submitted.');\n        setAmount('');\n        setAddress('');\n        setSelectedCrypto('');\n    };\n    \n    if (!walletConfig || Object.keys(walletConfig).length === 0) {\n        return <DashboardPageLayout title=\"Withdraw\" icon={<ArrowUpFromLine size={28} />}><div className=\"flex items-center justify-center h-full pt-20\"><div className=\"w-8 h-8 border-2 border-brand-primary border-t-transparent rounded-full animate-spin\"></div></div></DashboardPageLayout>;\n    }\n\n    return (\n        <DashboardPageLayout title=\"Withdraw\" icon={<ArrowUpFromLine size={28} />}>\n            <InteractiveCard className=\"p-6\">\n                <p className=\"text-brand-text-secondary\">Available for Withdrawal</p>\n                <p className=\"text-4xl font-bold font-mono text-white tracking-wider\">{formatCurrency(userData.balance)}</p>\n            </InteractiveCard>\n\n            <div className=\"space-y-4\">\n                 <h3 className=\"text-xl font-bold text-white\">1. Select Asset</h3>\n                 <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\" style={{ perspective: '1000px' }}>\n                     {Object.keys(walletConfig).map((key, index) => {\n                         const isSelected = selectedCrypto === key;\n                         return (\n                            <motion.div\n                                key={key}\n                                onClick={() => setSelectedCrypto(key)}\n                                className={`cursor-pointer rounded-2xl p-4 border-2 transition-all duration-300 relative overflow-hidden ${isSelected ? 'border-brand-primary' : 'border-white/10 bg-brand-surface/30'}`}\n                                whileHover={{ y: -10, rotateX: 5, scale: 1.05 }}\n                                initial={{ opacity: 0, y: 20 }}\n                                animate={{ opacity: 1, y: 0 }}\n                                transition={{ duration: 0.3, delay: 0.1 * index }}\n                            >\n                                {isSelected && <motion.div layoutId=\"withdraw-glow\" className=\"absolute inset-0 bg-brand-primary/20 -z-10 shadow-[0_0_20px_theme(colors.brand.primary)]\"/>}\n                                <div className=\"flex items-center gap-3\">\n                                    <img src={CRYPTO_LOGOS[key]} alt={key} className=\"w-10 h-10\"/>\n                                    <div>\n                                        <p className=\"font-bold text-white text-lg\">{walletConfig[key].name}</p>\n                                        <p className=\"text-sm text-brand-text-secondary\">{walletConfig[key].network}</p>\n                                    </div>\n                                </div>\n                            </motion.div>\n                         )\n                     })}\n                 </div>\n            </div>\n\n            <AnimatePresence>\n            {selectedCrypto && walletConfig[selectedCrypto] && (\n                <motion.div \n                    ref={detailsRef}\n                    initial={{ opacity: 0, y: 30 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: 30 }}\n                    transition={{ duration: 0.5, type: 'spring' }}\n                    className=\"space-y-4\"\n                >\n                    <h3 className=\"text-xl font-bold text-white\">2. Enter Details</h3>\n                    <InteractiveCard className=\"p-6 shadow-[0_0_25px_rgba(0,245,255,0.15)] border-brand-primary/30\">\n                        <form onSubmit={handleSubmit} className=\"space-y-6\">\n                            <div>\n                                <label className=\"block text-brand-text-secondary mb-2\">Amount (USD)</label>\n                                <div className=\"relative\">\n                                    <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-brand-text-secondary\">$</span>\n                                    <input \n                                        type=\"number\" \n                                        value={amount} \n                                        onChange={e => setAmount(e.target.value)} \n                                        placeholder=\"0.00\" \n                                        className=\"w-full pl-8 p-4 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white font-mono text-lg tracking-wider focus:outline-none transition-all duration-300 glow-input\" \n                                    />\n                                </div>\n                                 <p className=\"text-xs text-brand-text-secondary mt-2\">Minimum withdrawal: $10.00</p>\n                            </div>\n                             <div>\n                                <label className=\"block text-brand-text-secondary mb-2\">{walletConfig[selectedCrypto].name} Address ({walletConfig[selectedCrypto].network})</label>\n                                <input \n                                    type=\"text\" \n                                    value={address} \n                                    onChange={e => setAddress(e.target.value)} \n                                    placeholder={`Enter your ${walletConfig[selectedCrypto].network} address`} \n                                    className=\"w-full p-4 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white font-mono text-sm focus:outline-none transition-all duration-300 glow-input\"\n                                />\n                            </div>\n                            <motion.button \n                                type=\"submit\" \n                                className=\"w-full py-4 bg-gradient-to-r from-brand-primary to-brand-secondary text-brand-bg font-bold rounded-lg text-lg shadow-lg shadow-brand-primary/30\"\n                                whileHover={{ scale: 1.03, y: -2, boxShadow: '0 10px 20px rgba(0, 245, 255, 0.4)' }}\n                                whileTap={{ scale: 0.98, y: 0 }}\n                                transition={{ type: 'spring', stiffness: 400, damping: 15 }}\n                            >\n                                Submit Withdrawal Request\n                            </motion.button>\n                        </form>\n                    </InteractiveCard>\n                </motion.div>\n            )}\n            </AnimatePresence>\n        </DashboardPageLayout>\n    );\n};\n\nexport default WithdrawPage;","size_bytes":9717},"components/chatbot/ChatIcon.tsx":{"content":"\nimport React from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\ninterface ChatIconProps {\n    onClick: () => void;\n    hasNewMessage: boolean;\n    text: string;\n    showGreetingBubble: boolean;\n    greetingMessage: string;\n}\n\nconst GreetingBubble: React.FC<{ message: string }> = ({ message }) => {\n    return (\n        <motion.div\n            initial={{ opacity: 0, y: 20, scale: 0.8 }}\n            animate={{ \n                opacity: 1, \n                y: 0, \n                scale: 1,\n                transition: { type: 'spring', stiffness: 300, damping: 20 }\n            }}\n            exit={{ \n                opacity: 0, \n                y: 20, \n                scale: 0.8,\n                transition: { duration: 0.4, ease: 'easeIn' }\n            }}\n            className=\"absolute bottom-full right-full mr-4 mb-4 w-64 p-px rounded-3xl bg-gradient-to-br from-brand-primary to-brand-secondary shadow-2xl shadow-brand-primary/30\"\n            style={{ transformStyle: 'preserve-3d' }}\n        >\n            <motion.div \n                className=\"relative bg-brand-surface/80 backdrop-blur-xl rounded-[23px] px-5 py-4 text-center text-white\"\n                animate={{\n                    y: [0, -8, 0],\n                }}\n                transition={{\n                    duration: 6,\n                    repeat: Infinity,\n                    ease: \"easeInOut\"\n                }}\n                style={{ transform: 'translateZ(10px)' }}\n            >\n                <p className=\"text-sm leading-snug\">{message}</p>\n                 <div className=\"absolute top-0 left-0 w-full h-full rounded-[23px] overflow-hidden pointer-events-none\">\n                    <div className=\"absolute top-0 left-0 w-2/3 h-1/2 bg-white/10 -translate-x-1/4 -translate-y-1/4 rotate-45 blur-2xl\"></div>\n                </div>\n                <div className=\"absolute bottom-[-10px] right-6 w-0 h-0 border-l-[10px] border-l-transparent border-r-[10px] border-r-transparent border-t-[10px] border-t-brand-secondary/80\"></div>\n            </motion.div>\n        </motion.div>\n    );\n};\n\n\nconst ChatIcon: React.FC<ChatIconProps> = ({ onClick, hasNewMessage, text, showGreetingBubble, greetingMessage }) => {\n    return (\n        <motion.div\n            initial={{ scale: 0, y: 100 }}\n            animate={{ scale: 1, y: 0 }}\n            exit={{ scale: 0, y: 100 }}\n            transition={{ type: 'spring', stiffness: 260, damping: 20, delay: 0.5 }}\n            className=\"fixed bottom-24 right-6 lg:bottom-6 z-50\"\n        >\n            <div className=\"relative flex flex-col items-center gap-2\">\n                <AnimatePresence>\n                    {showGreetingBubble && <GreetingBubble message={greetingMessage} />}\n                </AnimatePresence>\n\n                <motion.button\n                    onClick={onClick}\n                    className=\"relative w-16 h-16 rounded-full bg-gradient-to-br from-brand-primary to-brand-secondary shadow-2xl shadow-brand-primary/40 flex items-center justify-center text-brand-bg\"\n                    whileHover={{ scale: 1.15, y: -5, transition: { type: 'spring', stiffness: 300 } }}\n                    whileTap={{ scale: 0.95 }}\n                    style={{ transformStyle: 'preserve-3d' }}\n                >\n                    <motion.div\n                        className=\"absolute inset-0 rounded-full bg-brand-primary opacity-50\"\n                        animate={{\n                            scale: [1, 1.3, 1],\n                            opacity: [0.7, 0.7, 0.3],\n                        }}\n                        transition={{ duration: 3, repeat: Infinity, ease: 'easeInOut' }}\n                    />\n                    \n                    <div style={{ transform: 'translateZ(20px)' }}>\n                        <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                            <defs>\n                                <linearGradient id=\"bubble-grad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                                    <stop offset=\"0%\" stopColor=\"#0a0a1a\" stopOpacity=\"0.8\"/>\n                                    <stop offset=\"100%\" stopColor=\"#1a1a2e\" stopOpacity=\"0.9\"/>\n                                </linearGradient>\n                                <filter id=\"icon-glow-filter\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n                                    <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"0.7\" result=\"blur\" />\n                                    <feMerge>\n                                        <feMergeNode in=\"blur\" />\n                                        <feMergeNode in=\"SourceGraphic\" />\n                                    </feMerge>\n                                </filter>\n                            </defs>\n                            <g>\n                                <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z\" fill=\"url(#bubble-grad)\" stroke=\"#00f5ff\" strokeWidth=\"1\"/>\n                                <circle cx=\"8\" cy=\"10\" r=\"1.2\" fill=\"#e040fb\" filter=\"url(#icon-glow-filter)\" />\n                                <circle cx=\"12\" cy=\"10\" r=\"1.2\" fill=\"#e040fb\" filter=\"url(#icon-glow-filter)\" />\n                                <circle cx=\"16\" cy=\"10\" r=\"1.2\" fill=\"#e040fb\" filter=\"url(#icon-glow-filter)\" />\n                            </g>\n                        </svg>\n                    </div>\n\n                    <AnimatePresence>\n                        {hasNewMessage && (\n                             <motion.div\n                                initial={{ scale: 0 }}\n                                animate={{ scale: 1 }}\n                                exit={{ scale: 0 }}\n                                className=\"absolute top-0 right-0 w-4 h-4 bg-red-500 rounded-full border-2 border-brand-surface shadow-[0_0_10px_theme(colors.red.500)]\"\n                                style={{ transform: 'translateZ(30px)' }}\n                            />\n                        )}\n                    </AnimatePresence>\n                </motion.button>\n                <span className=\"text-xs font-bold text-white bg-black/20 px-2 py-1 rounded-md\">{text}</span>\n            </div>\n        </motion.div>\n    );\n};\n\nexport default ChatIcon;","size_bytes":6256},"services/userDataService.ts":{"content":"import { User, UserData, Transaction, AdminTransaction, SystemSettings, PublicSystemSettings, WalletConfig, ActivePlan, Message, WelcomePageTemplate, WelcomeInboxMessageTemplate, LoginSession, LogEntry, ChatbotSettings, Testimonial } from '../types';\n\nconst API_BASE_URL = '/api/storage';\n\nconst apiCall = async (endpoint: string, method: string = 'GET', body?: any) => {\n    try {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), 600000);\n        \n        const options: RequestInit = {\n            method,\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            signal: controller.signal,\n        };\n        \n        if (body) {\n            options.body = JSON.stringify(body);\n        }\n        \n        const response = await fetch(`${API_BASE_URL}${endpoint}`, options);\n        clearTimeout(timeoutId);\n        \n        const result = await response.json();\n        \n        if (!result.success) {\n            throw new Error(result.message || 'API call failed');\n        }\n        \n        return result.data;\n    } catch (error) {\n        console.error(`API call failed: ${endpoint}`, error);\n        throw error;\n    }\n};\n\nexport const uploadMedia = async (type: 'welcome_page' | 'welcome_inbox', mediaType: 'image' | 'video', base64Data: string): Promise<string> => {\n    try {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), 600000);\n        \n        const response = await fetch(`${API_BASE_URL}/upload-media`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            signal: controller.signal,\n            body: JSON.stringify({ type, mediaType, data: base64Data }),\n        });\n        \n        clearTimeout(timeoutId);\n        \n        const result = await response.json();\n        \n        if (!result.success) {\n            throw new Error(result.message || 'Media upload failed');\n        }\n        \n        return result.url;\n    } catch (error) {\n        console.error('Failed to upload media:', error);\n        throw error;\n    }\n};\n\nexport const findUserByEmailOrName = async (identifier: string): Promise<UserData | null> => {\n    try {\n        const users: UserData[] = await apiCall('/users');\n        const user = users.find(u => \n            u.email.toLowerCase() === identifier.toLowerCase() || \n            u.name.toLowerCase() === identifier.toLowerCase()\n        );\n        return user || null;\n    } catch (error) {\n        console.error(\"Failed to find user:\", error);\n        return null;\n    }\n};\n\nexport const getUserData = async (userId: string): Promise<UserData | null> => {\n    try {\n        return await apiCall(`/users/${userId}`);\n    } catch (error) {\n        if (error instanceof Error && error.message.includes('not found')) {\n            return null;\n        }\n        console.error(\"Failed to get user data:\", error);\n        return null;\n    }\n};\n\nexport const saveUserData = async (userData: UserData): Promise<void> => {\n    try {\n        await apiCall(`/users/${userData.id}`, 'POST', userData);\n    } catch (error) {\n        console.error(\"Failed to save user data:\", error);\n        throw error;\n    }\n};\n\nexport const createInitialUserData = async (user: User): Promise<UserData> => {\n    const existingData = await getUserData(user.id);\n    if (existingData) {\n        return existingData;\n    }\n\n    const initialData: UserData = {\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        password: user.password,\n        plan: user.plan,\n        balance: user.balance,\n        totalProfit: user.totalProfit,\n        hasSeenWelcome: user.hasSeenWelcome,\n        registrationDate: new Date().toISOString(),\n        isVerified: true,\n        transactions: [],\n        referrals: {\n            count: 0,\n            earnings: 0,\n            link: `${window.location.origin}/ref/${user.name.toLowerCase().replace(/\\s/g, '')}${user.id.slice(-4)}`,\n        },\n        activePlan: undefined,\n        sessions: [],\n        loginHistory: [],\n        updateHistory: [],\n        notificationPreferences: {\n            email: { profitAlerts: true, systemAlerts: true, inboxMessages: true },\n            push: { profitAlerts: true, systemAlerts: true, inboxMessages: true },\n        },\n    };\n    await saveUserData(initialData);\n\n    try {\n        const welcomeTemplate = await getWelcomeInboxMessageTemplate();\n        const welcomeMessage: Message = {\n            id: `msg-welcome-${user.id}-${Date.now()}`,\n            ...welcomeTemplate,\n            createdAt: new Date().toISOString(),\n            recipientId: user.id,\n        };\n        const allMessages = await getMessages();\n        allMessages.unshift(welcomeMessage);\n        await saveMessages(allMessages);\n    } catch (error) {\n        console.error(\"Failed to create welcome message for new user:\", error);\n    }\n\n    return initialData;\n};\n\nexport const addTransaction = async (\n    userId: string, \n    transactionData: Omit<Transaction, 'id' | 'date' | 'status'>\n): Promise<UserData | null> => {\n    const userData = await getUserData(userId);\n    if (!userData) return null;\n\n    const newTransaction: Transaction = {\n        ...transactionData,\n        id: `tx-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        date: new Date().toISOString(),\n        status: transactionData.type === 'Withdrawal' ? 'Pending' : 'Confirmed'\n    };\n    \n    let newBalance = userData.balance;\n    if(newTransaction.type === 'Deposit') {\n        newBalance += (newTransaction.usdValue || newTransaction.amount);\n    } else if (newTransaction.type === 'Withdrawal') {\n        if (newBalance < newTransaction.amount) {\n            console.error('Insufficient funds for withdrawal');\n            return null;\n        }\n        newBalance -= newTransaction.amount;\n    }\n\n    userData.transactions.push(newTransaction);\n    userData.balance = newBalance;\n    \n    await saveUserData(userData);\n    return userData;\n};\n\nexport const recordProfitAndUpdateDate = async (userId: string, profitAmount: number): Promise<UserData | null> => {\n    const userData = await getUserData(userId);\n    if (!userData || !userData.activePlan || !userData.activePlan.isActive) return null;\n\n    const newTransaction: Transaction = {\n        id: `tx-profit-${Date.now()}`,\n        type: 'Profit',\n        amount: profitAmount,\n        date: new Date().toISOString(),\n        status: 'Confirmed',\n        asset: 'USD',\n        usdValue: profitAmount,\n    };\n\n    userData.balance += profitAmount;\n    userData.totalProfit += profitAmount;\n    userData.transactions.push(newTransaction);\n    if(userData.activePlan){\n        userData.activePlan.lastProfitDate = new Date().toISOString();\n    }\n\n    await saveUserData(userData);\n    return userData;\n};\n\nexport const investInPlan = async (userId: string, plan: { name: string, duration: number, dailyReturn: number }, investment: number): Promise<UserData | null> => {\n    const userData = await getUserData(userId);\n    if (!userData || userData.balance < investment) return null;\n\n    userData.balance -= investment;\n\n    const newPlan: ActivePlan = {\n        name: plan.name,\n        investment: investment,\n        dailyReturn: plan.dailyReturn,\n        duration: plan.duration,\n        isActive: false,\n    };\n\n    const newTransaction: Transaction = {\n        id: `tx-invest-${Date.now()}`,\n        type: 'Investment',\n        amount: investment,\n        date: new Date().toISOString(),\n        status: 'Confirmed',\n        asset: 'USD',\n        usdValue: investment,\n    };\n    \n    userData.activePlan = newPlan;\n    userData.transactions.push(newTransaction);\n\n    await saveUserData(userData);\n    return userData;\n};\n\nexport const activatePlan = async (userId: string): Promise<UserData | null> => {\n    const userData = await getUserData(userId);\n    if (!userData || !userData.activePlan) return null;\n\n    const now = new Date().toISOString();\n    userData.activePlan.isActive = true;\n    userData.activePlan.activationDate = now;\n    userData.activePlan.lastProfitDate = now;\n\n    await saveUserData(userData);\n    return userData;\n};\n\nconst logProfileUpdate = (userData: UserData, updates: Partial<UserData>): UserData => {\n    const changes: string[] = [];\n    if ('name' in updates && updates.name !== userData.name) changes.push(`name to \"${updates.name}\"`);\n    if ('email' in updates && updates.email !== userData.email) changes.push(`email to \"${updates.email}\"`);\n    if ('country' in updates && updates.country !== userData.country) changes.push(`country to \"${updates.country}\"`);\n    if ('password' in updates && updates.password) changes.push('password');\n    if ('notificationPreferences' in updates) changes.push('notification preferences');\n\n    if(changes.length > 0) {\n        const updateLog: LogEntry = {\n            id: `log-update-${Date.now()}`,\n            date: new Date().toISOString(),\n            action: 'Profile Update',\n            details: `Changed ${changes.join(', ')}.`,\n        };\n        userData.updateHistory.unshift(updateLog);\n        if (userData.updateHistory.length > 10) {\n            userData.updateHistory.pop();\n        }\n    }\n    return userData;\n}\n\nexport const updateUserData = async (userId: string, updates: Partial<UserData>): Promise<UserData | null> => {\n    let userData = await getUserData(userId);\n    if (!userData) return null;\n\n    userData = logProfileUpdate(userData, updates);\n    \n    const updatedData = { ...userData, ...updates };\n    await saveUserData(updatedData);\n    return updatedData;\n};\n\nconst getDeviceString = () => {\n    const ua = navigator.userAgent;\n    let browser = \"Unknown Browser\";\n    if (ua.includes(\"Firefox\")) browser = \"Firefox\";\n    else if (ua.includes(\"SamsungBrowser\")) browser = \"Samsung Browser\";\n    else if (ua.includes(\"Opera\") || ua.includes(\"OPR\")) browser = \"Opera\";\n    else if (ua.includes(\"Trident\")) browser = \"Internet Explorer\";\n    else if (ua.includes(\"Edge\")) browser = \"Edge\";\n    else if (ua.includes(\"Chrome\")) browser = \"Chrome\";\n    else if (ua.includes(\"Safari\")) browser = \"Safari\";\n    \n    let os = \"Unknown OS\";\n    if (ua.includes(\"Windows\")) os = \"Windows\";\n    else if (ua.includes(\"Mac\")) os = \"macOS\";\n    else if (ua.includes(\"Linux\")) os = \"Linux\";\n    else if (ua.includes(\"Android\")) os = \"Android\";\n    else if (ua.includes(\"like Mac\")) os = \"iOS\";\n\n    return `${browser} on ${os}`;\n};\n\nexport const logLogin = async (userId: string): Promise<UserData | null> => {\n    const userData = await getUserData(userId);\n    if (!userData) return null;\n\n    userData.sessions = userData.sessions?.map(s => ({ ...s, isCurrent: false })) || [];\n    \n    const newSession: LoginSession = {\n        id: `session-${Date.now()}`,\n        loggedInAt: new Date().toISOString(),\n        device: getDeviceString(),\n        ipAddress: `192.168.1.${Math.floor(Math.random() * 254) + 1}`,\n        isCurrent: true,\n    };\n    userData.sessions.push(newSession);\n    if(userData.sessions.length > 5) {\n        userData.sessions.shift();\n    }\n\n    const loginLog: LogEntry = {\n        id: `log-${Date.now()}`,\n        date: new Date().toISOString(),\n        action: 'Login',\n        details: `Logged in from ${newSession.device} (IP: ${newSession.ipAddress})`,\n    };\n    userData.loginHistory.unshift(loginLog);\n    if (userData.loginHistory.length > 10) {\n        userData.loginHistory.pop();\n    }\n\n    await saveUserData(userData);\n    return userData;\n};\n\nexport const logoutAllSessions = async (userId: string): Promise<void> => {\n    const userData = await getUserData(userId);\n    if (userData) {\n      userData.sessions = [];\n      await saveUserData(userData);\n    }\n};\n\nexport const getAllUsersData = async (): Promise<UserData[]> => {\n    try {\n        return await apiCall('/users');\n    } catch (error) {\n        console.error(\"Failed to get all users:\", error);\n        return [];\n    }\n};\n\nexport const getAllTransactions = async (): Promise<AdminTransaction[]> => {\n    const users = await getAllUsersData();\n    const transactions: AdminTransaction[] = [];\n    users.forEach(user => {\n        user.transactions.forEach(tx => {\n            transactions.push({\n                ...tx,\n                userId: user.id,\n                userName: user.name,\n            });\n        });\n    });\n    return transactions.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n};\n\nexport const deleteUser = async (userId: string): Promise<void> => {\n    try {\n        await apiCall(`/users/${userId}`, 'DELETE');\n    } catch (error) {\n        console.error(`Failed to delete user ${userId}:`, error);\n        throw error;\n    }\n};\n\nexport const adminAddBalance = async (userId: string, amount: number, asset: string): Promise<UserData | null> => {\n    return addTransaction(userId, {\n        type: 'Deposit',\n        amount: amount,\n        asset: asset,\n        usdValue: amount,\n    });\n};\n\nexport const updateTransactionStatus = async (userId: string, txId: string, status: 'Confirmed' | 'Failed'): Promise<UserData | null> => {\n    const userData = await getUserData(userId);\n    if (!userData) return null;\n\n    const txIndex = userData.transactions.findIndex(t => t.id === txId);\n    if (txIndex === -1) return null;\n    \n    const transaction = userData.transactions[txIndex];\n    \n    if (transaction.type === 'Withdrawal' && transaction.status === 'Pending' && status === 'Failed') {\n        userData.balance += transaction.amount;\n    }\n\n    userData.transactions[txIndex].status = status;\n    await saveUserData(userData);\n    return userData;\n};\n\nconst DEFAULT_WALLET_CONFIG: WalletConfig = {\n    BTC: { name: 'Bitcoin', symbol: 'BTC', network: 'Bitcoin (BTC)', address: 'bc1q60j2ze3t8jxvqlcar8c7h9mtmelqx7uprznhzy', qrCodeUrl: '', minDeposit: 0.0001, minWithdrawal: 0.0005, withdrawalFee: 0.0002 },\n    ETH: { name: 'Ethereum', symbol: 'ETH', network: 'Ethereum (ERC20)', address: '0x8419B4226a55DE67b45Fcbf2a277FB7e75451E07', qrCodeUrl: '', minDeposit: 0.01, minWithdrawal: 0.01, withdrawalFee: 0.005 },\n    USDT: { name: 'Tether', symbol: 'USDT', network: 'Tron (TRC20)', address: 'TU1bdYyAT95QvNG9v869LKUZWdb9FP3NCk', qrCodeUrl: '', minDeposit: 10, minWithdrawal: 20, withdrawalFee: 1 },\n};\n\nexport const getWalletConfig = async (): Promise<WalletConfig> => {\n    try {\n        const settings = await apiCall('/settings');\n        return (settings.walletConfig && Object.keys(settings.walletConfig).length > 0) ? settings.walletConfig : DEFAULT_WALLET_CONFIG;\n    } catch (error) {\n        console.error(\"Failed to get wallet config:\", error);\n        return DEFAULT_WALLET_CONFIG;\n    }\n};\n\nexport const saveWalletConfig = async (config: WalletConfig): Promise<void> => {\n    try {\n        const settings = await apiCall('/settings');\n        settings.walletConfig = config;\n        await apiCall('/settings', 'POST', settings);\n    } catch (error) {\n        console.error(\"Failed to save wallet config:\", error);\n        throw error;\n    }\n};\n\nconst DEFAULT_SYSTEM_SETTINGS: SystemSettings = {\n    siteName: 'TradePilot AI',\n    description: 'The future of automated crypto arbitrage.',\n    logoUrl: '',\n    maintenanceMode: false,\n    recaptchaEnabled: false,\n    recaptchaSiteKey: '',\n    recaptchaSecretKey: '',\n};\n\nexport const getSystemSettings = async (): Promise<SystemSettings> => {\n    try {\n        const settings = await apiCall('/settings');\n        return settings.systemSettings || DEFAULT_SYSTEM_SETTINGS;\n    } catch (error) {\n        console.error(\"Failed to get system settings:\", error);\n        return DEFAULT_SYSTEM_SETTINGS;\n    }\n};\n\nexport const getPublicSystemSettings = async (): Promise<PublicSystemSettings> => {\n    const settings = await getSystemSettings();\n    const { recaptchaSecretKey, ...publicSettings } = settings;\n    return publicSettings;\n};\n\nexport const saveSystemSettings = async (settings: SystemSettings): Promise<void> => {\n    try {\n        const allSettings = await apiCall('/settings');\n        allSettings.systemSettings = settings;\n        await apiCall('/settings', 'POST', allSettings);\n    } catch (error) {\n        console.error(\"Failed to save system settings:\", error);\n        throw error;\n    }\n};\n\nexport const sendVerificationEmail = async (userEmail: string, code: string): Promise<void> => {\n    try {\n        const response = await fetch('/api/send-verification-email', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ email: userEmail, code }),\n        });\n\n        const result = await response.json();\n        \n        if (!response.ok || !result.success) {\n            throw new Error(result.message || 'Failed to send verification email');\n        }\n    } catch (error) {\n        throw error;\n    }\n};\n\nexport const verifyUserCode = async (userId: string, code: string): Promise<boolean> => {\n    const userData = await getUserData(userId);\n    if (!userData || !userData.verificationCode || !userData.verificationCodeExpires) {\n        return false;\n    }\n    \n    const isExpired = new Date() > new Date(userData.verificationCodeExpires);\n    if (isExpired) {\n        userData.verificationCode = undefined;\n        userData.verificationCodeExpires = undefined;\n        await saveUserData(userData);\n        return false;\n    }\n    \n    if (userData.verificationCode === code) {\n        userData.isVerified = true;\n        userData.verificationCode = undefined;\n        userData.verificationCodeExpires = undefined;\n        await saveUserData(userData);\n        return true;\n    }\n    \n    return false;\n};\n\nexport const resendVerificationCode = async (userId: string): Promise<{ success: boolean; message: string }> => {\n    const userData = await getUserData(userId);\n    if (!userData) return { success: false, message: 'User not found.' };\n\n    const newCode = Math.floor(10000 + Math.random() * 90000).toString();\n    const newExpires = new Date(Date.now() + 5 * 60 * 1000).toISOString();\n    \n    userData.verificationCode = newCode;\n    userData.verificationCodeExpires = newExpires;\n    \n    await saveUserData(userData);\n    await sendVerificationEmail(userData.email, newCode);\n    \n    return { success: true, message: 'A new verification code has been sent.' };\n};\n\nconst DEFAULT_WELCOME_PAGE_TEMPLATE: WelcomePageTemplate = {\n    title: '🎉 Welcome to TradePilot AI!',\n    text: `Your account is ready and the future of automated trading is at your fingertips.\n\nWe're thrilled to have you onboard. Please check your inbox for a quick start guide and important information about your new account.\n\nLet's start your journey to passive income!`,\n    imageUrl: \"\"\n};\n\nexport const getWelcomePageTemplate = async (): Promise<WelcomePageTemplate> => {\n    try {\n        const settings = await apiCall('/settings');\n        return settings.welcomePageTemplate || DEFAULT_WELCOME_PAGE_TEMPLATE;\n    } catch (error) {\n        console.error(\"Failed to get welcome page template:\", error);\n        return DEFAULT_WELCOME_PAGE_TEMPLATE;\n    }\n};\n\nexport const saveWelcomePageTemplate = async (template: WelcomePageTemplate): Promise<void> => {\n    try {\n        const settings = await apiCall('/settings');\n        settings.welcomePageTemplate = template;\n        await apiCall('/settings', 'POST', settings);\n    } catch (error) {\n        console.error(\"Failed to save welcome page template:\", error);\n        throw error;\n    }\n};\n\nconst DEFAULT_WELCOME_INBOX_TEMPLATE: WelcomeInboxMessageTemplate = {\n    title: '🚀 Your Trading Journey Begins Now!',\n    text: `Hello and welcome to TradePilot AI!\n\nWe are excited to have you with us. Your account has been successfully created.\n\nHere are a few quick steps to get started:\n1.  **Fund Your Account:** Go to the 'Deposit' section to add funds.\n2.  **Choose Your AI:** Visit the 'AI Trading Plans' to select and activate your bot.\n3.  **Watch it Grow:** Monitor your progress from your dashboard.\n\nIf you have any questions, our support team is ready to assist you.\n\nHappy trading!\n- The TradePilot AI Team`,\n    imageUrl: '',\n    videoUrl: '',\n};\n\nexport const getWelcomeInboxMessageTemplate = async (): Promise<WelcomeInboxMessageTemplate> => {\n    try {\n        const settings = await apiCall('/settings');\n        return settings.welcomeInboxTemplate || DEFAULT_WELCOME_INBOX_TEMPLATE;\n    } catch (error) {\n        console.error(\"Failed to get welcome inbox message template:\", error);\n        return DEFAULT_WELCOME_INBOX_TEMPLATE;\n    }\n};\n\nexport const saveWelcomeInboxMessageTemplate = async (template: WelcomeInboxMessageTemplate): Promise<void> => {\n    try {\n        const settings = await apiCall('/settings');\n        settings.welcomeInboxTemplate = template;\n        await apiCall('/settings', 'POST', settings);\n    } catch (error) {\n        console.error(\"Failed to save welcome inbox message template:\", error);\n        throw error;\n    }\n};\n\nexport const getMessages = async (): Promise<Message[]> => {\n    try {\n        return await apiCall('/messages');\n    } catch (error) {\n        console.error(\"Failed to get messages:\", error);\n        return [];\n    }\n};\n\nexport const saveMessages = async (messages: Message[]): Promise<void> => {\n    try {\n        await apiCall('/messages', 'POST', messages);\n    } catch (error) {\n        console.error(\"Failed to save messages:\", error);\n        throw error;\n    }\n};\n\nexport const addMessage = async (newMessageData: Omit<Message, 'id' | 'createdAt'>): Promise<Message> => {\n    const messages = await getMessages();\n    const newMessage: Message = {\n        ...newMessageData,\n        id: `msg-${Date.now()}`,\n        createdAt: new Date().toISOString(),\n    };\n    messages.unshift(newMessage);\n    await saveMessages(messages);\n    return newMessage;\n};\n\nexport const updateMessage = async (messageId: string, updates: Partial<Message>): Promise<Message | null> => {\n    const messages = await getMessages();\n    const messageIndex = messages.findIndex(m => m.id === messageId);\n    if (messageIndex === -1) return null;\n\n    messages[messageIndex] = { ...messages[messageIndex], ...updates };\n    await saveMessages(messages);\n    return messages[messageIndex];\n};\n\nexport const deleteMessage = async (messageId: string): Promise<boolean> => {\n    let messages = await getMessages();\n    const initialLength = messages.length;\n    messages = messages.filter(m => m.id !== messageId);\n    if (messages.length < initialLength) {\n        await saveMessages(messages);\n        return true;\n    }\n    return false;\n};\n\nconst seedTestimonials = async () => {\n    const names = [\n        \"Liam Johnson\", \"Olivia Smith\", \"Noah Williams\", \"Emma Jones\", \"Oliver Brown\",\n        \"Ava Davis\", \"Elijah Miller\", \"Charlotte Wilson\", \"James Moore\", \"Sophia Taylor\",\n        \"William Anderson\", \"Isabella Thomas\", \"Henry Jackson\", \"Mia White\", \"Lucas Harris\",\n        \"Amelia Martin\", \"Benjamin Thompson\", \"Harper Garcia\", \"Theodore Martinez\", \"Evelyn Robinson\",\n        \"Alexander Clark\", \"Abigail Rodriguez\", \"Daniel Lewis\", \"Emily Lee\", \"Matthew Walker\",\n        \"Elizabeth Hall\", \"Joseph Allen\", \"Sofia Young\", \"David Hernandez\", \"Avery King\",\n        \"Samuel Wright\", \"Ella Lopez\", \"John Hill\", \"Grace Scott\", \"Robert Green\"\n    ];\n\n    const fullReviews = [\n        \"Honestly, I was skeptical at first. But after three months of using TradePilot, I'm genuinely impressed. The bot found opportunities I never would have spotted manually, and my portfolio has grown consistently. The interface is clean and doesn't overwhelm you with unnecessary data. Highly recommend giving it a shot!\",\n        \"This platform changed my approach to crypto entirely. I used to spend hours analyzing charts and still missed most arbitrage windows. Now the AI handles everything while I focus on my day job. The returns aren't crazy overnight gains, but they're steady and reliable, which is exactly what I wanted.\",\n        \"Been trading crypto for years, tried several bots before this one. TradePilot is different - the execution speed is incredible and I can actually see each trade happening in real-time. No black box nonsense. Started with a small amount to test, now I've significantly increased my investment.\",\n        \"As someone who works full-time and has a family, I needed something automated that actually works. TradePilot delivers. Set it up in under 10 minutes, and it's been running smoothly for months. The profits aren't huge every day, but they add up fast. Worth every penny.\",\n        \"The transparency here is what won me over. You can literally track every single trade the AI makes, see the profit margins, understand the strategy. It's not just a magic money printer - it's a sophisticated tool that you can learn from. My only regret? Not starting sooner.\"\n    ];\n\n    const adminReplies = [\n        \"Thank you for sharing your experience! We're thrilled the platform is working well for you.\",\n        \"We really appreciate your detailed feedback! Stories like yours make all our hard work worthwhile.\",\n        \"That's wonderful to hear! We're committed to delivering consistent results for all our users.\",\n        \"Thanks for the kind words! We're glad our technology is making a real difference in your portfolio.\",\n        \"Your success is our success! Thank you for being part of the TradePilot AI community.\"\n    ];\n\n    const randomElement = (arr: string[]) => arr[Math.floor(Math.random() * arr.length)];\n    \n    const testimonials: Testimonial[] = [];\n    \n    for (let i = 0; i < 5; i++) {\n        const hasAdminReply = Math.random() < 0.3;\n        const reviewDate = new Date(Date.now() - Math.random() * 90 * 24 * 60 * 60 * 1000);\n        const testimonial: Testimonial = {\n            id: `rev-${reviewDate.getTime()}-${i}`,\n            name: randomElement(names),\n            text: fullReviews[i],\n            rating: Math.random() < 0.7 ? 5 : 4,\n            createdAt: reviewDate.toISOString(),\n            adminReply: hasAdminReply ? randomElement(adminReplies) : undefined,\n            adminReplyAt: hasAdminReply ? new Date(reviewDate.getTime() + Math.random() * 5 * 24 * 60 * 60 * 1000).toISOString() : undefined,\n        };\n        testimonials.push(testimonial);\n    }\n    await saveTestimonials(testimonials);\n    return testimonials;\n};\n\nexport const getTestimonials = async (): Promise<Testimonial[]> => {\n    try {\n        const reviews = await apiCall('/reviews');\n        if (reviews && reviews.length > 0) {\n            return reviews.sort((a: Testimonial, b: Testimonial) => \n                new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n            );\n        }\n        return [];\n    } catch (error) {\n        console.error(\"Failed to get testimonials:\", error);\n        return [];\n    }\n};\n\nexport const saveTestimonials = async (testimonials: Testimonial[]): Promise<void> => {\n    try {\n        await apiCall('/reviews', 'POST', testimonials);\n    } catch (error) {\n        console.error(\"Failed to save testimonials:\", error);\n        throw error;\n    }\n};\n\nexport const addTestimonial = async (testimonialData: Omit<Testimonial, 'id' | 'createdAt'>): Promise<Testimonial> => {\n    const testimonials = await getTestimonials();\n    const newTestimonial: Testimonial = {\n        ...testimonialData,\n        id: `rev-user-${Date.now()}`,\n        createdAt: new Date().toISOString(),\n    };\n    testimonials.unshift(newTestimonial);\n    await saveTestimonials(testimonials);\n    return newTestimonial;\n};\n\nexport const updateTestimonial = async (testimonialId: string, updates: Partial<Testimonial>): Promise<Testimonial | null> => {\n    const testimonials = await getTestimonials();\n    const index = testimonials.findIndex(t => t.id === testimonialId);\n    if (index === -1) return null;\n    \n    if('adminReply' in updates) {\n        updates.adminReplyAt = new Date().toISOString();\n    }\n\n    testimonials[index] = { ...testimonials[index], ...updates };\n    await saveTestimonials(testimonials);\n    return testimonials[index];\n};\n\nexport const deleteTestimonial = async (testimonialId: string): Promise<boolean> => {\n    let testimonials = await getTestimonials();\n    const initialLength = testimonials.length;\n    testimonials = testimonials.filter(t => t.id !== testimonialId);\n    if (testimonials.length < initialLength) {\n        await saveTestimonials(testimonials);\n        return true;\n    }\n    return false;\n};\n\nexport const updateUserNotificationPermission = async (userId: string, permission: 'granted' | 'denied' | 'default'): Promise<UserData | null> => {\n    const userData = await getUserData(userId);\n    if (!userData) return null;\n\n    userData.notificationPermission = permission;\n    await saveUserData(userData);\n    return userData;\n};\n\nexport const showBrowserNotification = (title: string, options?: NotificationOptions) => {\n    if (!('Notification' in window)) {\n      console.log('This browser does not support desktop notification');\n      return;\n    }\n    \n    if (Notification.permission === 'granted') {\n      new Notification(title, options);\n    }\n};\n\nexport const requestNotificationPermission = async (): Promise<NotificationPermission> => {\n    if (!('Notification' in window)) {\n      console.log('This browser does not support notifications');\n      return 'denied';\n    }\n    \n    const permission = await Notification.requestPermission();\n    return permission;\n};\n\nconst DEFAULT_CEREBRAS_KEYS: string[] = [\n    'csk-fj5hkkykwtnnttrxj35nvrx5498drpnpjvwhr2yet36k6mte',\n    'csk-pddjmh5wfv25dpwj6fxxn9kmmr26dcp55w29vv9rhx2xxdfr',\n    'csk-k5mmn46rfjd6vhkxdwh69d3rxejhp86f9mxd2f39jrjkr33p'\n];\n\nconst DEFAULT_CHATBOT_SETTINGS: ChatbotSettings = {\n    personality: \"You are TradePilot AI, a friendly and professional crypto trading assistant. You are knowledgeable about cryptocurrency, arbitrage, and the features of the TradePilot AI platform. Keep your answers concise, helpful, and optimistic. Do not give financial advice. Always promote the platform's features when relevant.\",\n    apiKeys: DEFAULT_CEREBRAS_KEYS.map(key => ({\n        key,\n        status: 'active',\n        usageCount: 0,\n        lastUsed: null,\n    })),\n    iconText: 'TradePilot AI'\n};\n\nexport const getChatbotSettings = async (): Promise<ChatbotSettings> => {\n    try {\n        const settings = await apiCall('/settings');\n        if (settings.chatbotSettings && Array.isArray(settings.chatbotSettings.apiKeys)) {\n            return settings.chatbotSettings;\n        }\n        await saveChatbotSettings(DEFAULT_CHATBOT_SETTINGS);\n        return DEFAULT_CHATBOT_SETTINGS;\n    } catch (error) {\n        console.error(\"Failed to get chatbot settings:\", error);\n        return DEFAULT_CHATBOT_SETTINGS;\n    }\n};\n\nexport const saveChatbotSettings = async (settings: ChatbotSettings): Promise<void> => {\n    try {\n        const allSettings = await apiCall('/settings');\n        allSettings.chatbotSettings = settings;\n        await apiCall('/settings', 'POST', allSettings);\n    } catch (error) {\n        console.error(\"Failed to save chatbot settings:\", error);\n        throw error;\n    }\n};\n","size_bytes":31248},"services/geminiService.ts":{"content":"\nimport { GoogleGenAI } from \"@google/genai\";\nimport { AspectRatio } from \"../types\";\n\n// IMPORTANT: This service assumes the Gemini API key is available in the environment variables.\n// In a real application, this should be handled securely on a backend server.\nconst API_KEY = process.env.API_KEY;\n\nif (!API_KEY) {\n  // In a real app, you might want to show a more user-friendly error.\n  // For this example, we log a warning but allow the app to run,\n  // as the user might not use the image generation feature.\n  console.warn(\"Gemini API key not found. Image generation will not work.\");\n}\n\nconst ai = new GoogleGenAI({ apiKey: API_KEY! });\n\nexport const generateImage = async (prompt: string, aspectRatio: AspectRatio): Promise<string> => {\n  if (!API_KEY) {\n    throw new Error(\"API Key is not configured. Cannot generate image.\");\n  }\n  \n  try {\n    console.log(`Generating image with prompt: \"${prompt}\" and aspect ratio: ${aspectRatio}`);\n    \n    const response = await ai.models.generateImages({\n        model: 'imagen-4.0-generate-001',\n        prompt: prompt,\n        config: {\n          numberOfImages: 1,\n          outputMimeType: 'image/jpeg',\n          aspectRatio: aspectRatio,\n        },\n    });\n\n    if (response.generatedImages && response.generatedImages.length > 0) {\n      const base64ImageBytes: string = response.generatedImages[0].image.imageBytes;\n      return `data:image/jpeg;base64,${base64ImageBytes}`;\n    } else {\n      throw new Error(\"No image was generated by the API.\");\n    }\n  } catch (error) {\n    console.error(\"Error generating image with Gemini API:\", error);\n    throw new Error(\"Failed to generate image. Please try again.\");\n  }\n};\n","size_bytes":1679},"components/three/HomePageBackground.tsx":{"content":"import React, { useRef, useMemo } from 'react';\nimport { Canvas, useFrame, useThree } from '@react-three/fiber';\nimport * as THREE from 'three';\nimport { EffectComposer, Bloom } from '@react-three/postprocessing';\n\nconst Particles: React.FC<{ count: number }> = ({ count }) => {\n  const mesh = useRef<THREE.InstancedMesh>(null!);\n  const { viewport } = useThree();\n  const dummy = useMemo(() => new THREE.Object3D(), []);\n\n  const particles = useMemo(() => {\n    const temp = [];\n    for (let i = 0; i < count; i++) {\n      const time = Math.random() * 100;\n      const factor = 10 + Math.random() * 100;\n      const speed = 0.002 + Math.random() / 500;\n      const x = (Math.random() - 0.5) * viewport.width * 2;\n      const y = (Math.random() - 0.5) * viewport.height * 2;\n      const z = (Math.random() - 0.5) * 20;\n      temp.push({ time, factor, speed, x, y, z });\n    }\n    return temp;\n  }, [count, viewport.width, viewport.height]);\n\n  useFrame(() => {\n    if(!mesh.current) return;\n    \n    mesh.current.rotation.y += 0.0001;\n\n    particles.forEach((particle, i) => {\n      let { factor, speed, x, y, z } = particle;\n      const t = (particle.time += speed);\n      dummy.position.set(\n        x + Math.cos((t / 10) * factor) + (Math.sin(t * 1) * factor) / 5,\n        y + Math.sin((t / 10) * factor) + (Math.cos(t * 2) * factor) / 5,\n        z + Math.cos((t / 10) * factor) + (Math.sin(t * 3) * factor) / 5\n      );\n      const s = Math.max(0.1, Math.cos(t) * 0.3 + 0.3);\n      dummy.scale.set(s,s,s);\n      dummy.rotation.set(t, t, t);\n      dummy.updateMatrix();\n      mesh.current.setMatrixAt(i, dummy.matrix);\n    });\n    mesh.current.instanceMatrix.needsUpdate = true;\n  });\n\n  return (\n    <instancedMesh ref={mesh} args={[undefined, undefined, count]}>\n      <sphereGeometry args={[0.05, 16, 16]} />\n      <meshStandardMaterial color=\"#00f5ff\" emissive=\"#00f5ff\" emissiveIntensity={1.5} roughness={0.2} metalness={0.8} />\n    </instancedMesh>\n  );\n};\n\nconst HomePageBackground: React.FC = () => {\n  return (\n    <div className=\"absolute inset-0 z-0 opacity-40\">\n      <Canvas camera={{ position: [0, 0, 10], fov: 75 }}>\n        <ambientLight intensity={0.1} />\n        <pointLight position={[10, 10, 10]} intensity={2} color=\"#e040fb\" />\n        <pointLight position={[-10, -10, -10]} intensity={2} color=\"#00f5ff\" />\n        <Particles count={150} />\n         <EffectComposer>\n            <Bloom luminanceThreshold={0} luminanceSmoothing={0.9} height={300} intensity={1} />\n        </EffectComposer>\n      </Canvas>\n    </div>\n  );\n};\n\nexport default HomePageBackground;","size_bytes":2586},"components/three/HeroAIAnimation.tsx":{"content":"import React, { useMemo, useRef } from 'react';\nimport { Canvas, useFrame } from '@react-three/fiber';\nimport type { MotionValue } from 'framer-motion';\nimport { EffectComposer, Bloom } from '@react-three/postprocessing';\nimport * as THREE from 'three';\n\nconst COUNT = 80;\nconst RADIUS = 2.5;\n\nconst Nodes = () => {\n    const nodes = useMemo(() => {\n        const temp = [];\n        const phi = Math.PI * (3. - Math.sqrt(5.)); // golden angle in radians\n        for (let i = 0; i < COUNT; i++) {\n            const y = 1 - (i / (COUNT - 1)) * 2;  // y goes from 1 to -1\n            const radius = Math.sqrt(1 - y * y); // radius at y\n            const theta = phi * i; // golden angle increment\n            const x = Math.cos(theta) * radius;\n            const z = Math.sin(theta) * radius;\n            temp.push(new THREE.Vector3(x,y,z).multiplyScalar(RADIUS));\n        }\n        return temp;\n    }, []);\n\n    return <>{nodes.map((pos, i) => (\n         <mesh key={i} position={pos}>\n            <sphereGeometry args={[0.04, 16, 16]} />\n            <meshBasicMaterial color=\"#00f5ff\" toneMapped={false} />\n        </mesh>\n    ))}</>;\n};\n\nconst Lines = () => {\n    const linesRef = useRef<THREE.LineSegments>(null!);\n\n    const [positions, indices] = useMemo(() => {\n        const pos = [];\n        const ind = [];\n        const phi = Math.PI * (3. - Math.sqrt(5.));\n        for (let i = 0; i < COUNT; i++) {\n            const y = 1 - (i / (COUNT - 1)) * 2;\n            const radius = Math.sqrt(1 - y * y);\n            const theta = phi * i;\n            pos.push(Math.cos(theta) * radius * RADIUS, y * RADIUS, Math.sin(theta) * radius * RADIUS);\n        }\n\n        for (let i = 0; i < COUNT; i++) {\n            for (let j = i + 1; j < COUNT; j++) {\n                const p1 = new THREE.Vector3(pos[i*3], pos[i*3+1], pos[i*3+2]);\n                const p2 = new THREE.Vector3(pos[j*3], pos[j*3+1], pos[j*3+2]);\n                const dist = p1.distanceTo(p2);\n                if (dist < 1.0) { // Connect nodes that are close\n                    ind.push(i, j);\n                }\n            }\n        }\n        return [new Float32Array(pos), new Uint16Array(ind)];\n    }, []);\n\n    return (\n        <lineSegments ref={linesRef}>\n            <bufferGeometry>\n                <bufferAttribute attach=\"attributes-position\" count={positions.length / 3} array={positions} itemSize={3} args={[positions, 3]} />\n                <bufferAttribute attach=\"index\" count={indices.length} array={indices} itemSize={1} args={[indices, 1]} />\n            </bufferGeometry>\n            <lineBasicMaterial color=\"#e040fb\" transparent opacity={0.25} toneMapped={false} />\n        </lineSegments>\n    );\n};\n\nconst Scene = ({ scrollProgress }: { scrollProgress: MotionValue<number> }) => {\n    const groupRef = useRef<THREE.Group>(null!);\n    useFrame(({ clock }) => {\n        if(groupRef.current) {\n            groupRef.current.rotation.y = clock.getElapsedTime() * 0.05;\n            groupRef.current.rotation.x = clock.getElapsedTime() * 0.02;\n            groupRef.current.rotation.z = clock.getElapsedTime() * 0.03;\n            groupRef.current.position.y = scrollProgress.get() * 3;\n        }\n    });\n    return (\n        <group ref={groupRef}>\n            <Nodes />\n            <Lines />\n        </group>\n    );\n}\n\nconst HeroAIAnimation: React.FC<{ scrollProgress: MotionValue<number> }> = ({ scrollProgress }) => {\n    return (\n        <Canvas camera={{ position: [0, 0, 8], fov: 50 }}>\n            <fog attach=\"fog\" args={['#0a0a1a', 10, 20]} />\n            <Scene scrollProgress={scrollProgress} />\n            <EffectComposer>\n                <Bloom luminanceThreshold={0} luminanceSmoothing={0.9} height={300} intensity={1.5} />\n            </EffectComposer>\n        </Canvas>\n    );\n};\n\nexport default React.memo(HeroAIAnimation);","size_bytes":3817},"components/three/TradingVisualization.tsx":{"content":"import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { motion, AnimatePresence, useMotionValue, useTransform } from 'framer-motion';\nimport { Canvas, useFrame } from '@react-three/fiber';\nimport * as THREE from 'three';\n\n// --- CoinGecko API Logic & Types ---\n// Using multiple keys to rotate and avoid rate limits on the free tier.\nconst API_KEYS = [\n  'CG-V1Z1MdM5Bfk4C9P6VW5oYJUw',\n  'CG-Gz4wxBKfDbN7bHXZfm8rG9nX',\n  'CG-dZtR2c6qrHUdrxv2cpcBjpFT',\n  'CG-YijXd9KPMsv9RiVRFF8iJpNG',\n  'CG-ctftx4eQqLpwDUuPLXdu7khV',\n];\nlet keyIndex = 0;\n\nconst getApiKey = () => {\n  const key = API_KEYS[keyIndex];\n  keyIndex = (keyIndex + 1) % API_KEYS.length;\n  return key;\n};\n\ninterface Ticker {\n  market: { name: string; logo: string; };\n  converted_last: { usd: number; };\n  trust_score: string;\n}\n\ninterface ArbitrageOpportunity {\n  id: string;\n  coinName: string;\n  coinSymbol: string;\n  coinLogo: string;\n  buyExchange: { name: string; logo: string; price: number };\n  sellExchange: { name: string; logo: string; price: number };\n  profit: number;\n}\n\nconst COINS_TO_TRACK = [\n    { id: 'bitcoin', name: 'Bitcoin', symbol: 'BTC', logo: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/btc.svg' },\n    { id: 'ethereum', name: 'Ethereum', symbol: 'ETH', logo: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/eth.svg' },\n    { id: 'solana', name: 'Solana', symbol: 'SOL', logo: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/sol.svg' },\n];\n\nconst AnimatedHeader = () => (\n    <div className=\"relative text-center text-sm text-brand-text-secondary mb-4 overflow-hidden py-1 w-full max-w-lg mx-auto\">\n        <span className=\"relative z-10 font-mono\">🔍 Scanning crypto exchanges for live arbitrage opportunities...</span>\n        <motion.div\n            className=\"absolute inset-x-0 bottom-0 h-px bg-gradient-to-r from-transparent via-cyan-400/80 to-transparent\"\n            initial={{ x: \"-100%\" }}\n            animate={{ x: \"100%\" }}\n            transition={{ duration: 2, repeat: Infinity, ease: \"linear\" }}\n        />\n    </div>\n);\n\nconst formatPrice = (value: number) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: value > 1 ? 3 : 6 })}`;\nconst formatProfit = (value: number) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 4 })}`;\n\nconst Particles = React.memo(() => {\n    const points = useRef<THREE.Points>(null!);\n    const count = 150;\n    const radius = 6;\n\n    const particles = React.useMemo(() => {\n        const temp = new Float32Array(count * 3);\n        for (let i = 0; i < count; i++) {\n            const i3 = i * 3;\n            temp[i3] = (Math.random() - 0.5) * radius * 2;\n            temp[i3 + 1] = (Math.random() - 0.5) * radius * 2;\n            temp[i3 + 2] = (Math.random() - 0.5) * radius * 2;\n        }\n        return temp;\n    }, [count, radius]);\n\n    useFrame((state) => {\n        if(points.current) {\n            points.current.rotation.y += 0.0003;\n            points.current.rotation.x += 0.0001;\n            points.current.position.y = Math.sin(state.clock.elapsedTime * 0.1) * 0.2;\n        }\n    });\n\n    return (\n        <points ref={points}>\n            <bufferGeometry>\n                <bufferAttribute attach=\"position\" count={particles.length / 3} array={particles} itemSize={3} />\n            </bufferGeometry>\n            <pointsMaterial size={0.04} color=\"#00f5ff\" transparent sizeAttenuation opacity={0.7} />\n        </points>\n    );\n});\n\nconst TradingVisualization = () => {\n    const [opportunity, setOpportunity] = useState<ArbitrageOpportunity | null>(null);\n    const coinIndexRef = useRef(0);\n    const [isLoading, setIsLoading] = useState(true);\n    const [currentCoin, setCurrentCoin] = useState(COINS_TO_TRACK[0]);\n    const recentOppIds = useRef<string[]>([]);\n\n    const fetchArbitrageData = useCallback(async () => {\n        setIsLoading(true);\n        const coin = COINS_TO_TRACK[coinIndexRef.current];\n        setCurrentCoin(coin);\n        coinIndexRef.current = (coinIndexRef.current + 1) % COINS_TO_TRACK.length;\n\n        try {\n            const apiKey = getApiKey();\n            const response = await fetch(`https://api.coingecko.com/api/v3/coins/${coin.id}/tickers?x_cg_demo_api_key=${apiKey}&include_exchange_logo=true&depth=false&order=volume_desc`);\n            if (!response.ok) throw new Error(`API Error for ${coin.id}: ${response.statusText}`);\n\n            const data = await response.json();\n            const validTickers = data.tickers\n                .filter((t: Ticker) => t.trust_score === 'green' && t.converted_last.usd > 0)\n                .sort((a: Ticker, b: Ticker) => a.converted_last.usd - b.converted_last.usd);\n\n            let newOpportunity: ArbitrageOpportunity | null = null;\n\n            if (validTickers.length >= 2) {\n                const potentialBuys = validTickers.slice(0, 5); // Take top 5 cheapest\n                const potentialSells = validTickers.slice(-5).reverse(); // Take top 5 most expensive\n\n                for (const buy of potentialBuys) {\n                    for (const sell of potentialSells) {\n                        if (buy.market.name !== sell.market.name) {\n                            const profit = sell.converted_last.usd - buy.converted_last.usd;\n                            const oppId = `${coin.id}-${buy.market.name}-${sell.market.name}`;\n                            \n                            // Check for profit and if it's a new opportunity (not in recent history)\n                            if (profit > 0.01 && !recentOppIds.current.includes(oppId)) {\n                                newOpportunity = {\n                                    id: oppId,\n                                    coinName: coin.name, coinSymbol: coin.symbol, coinLogo: coin.logo,\n                                    buyExchange: { name: buy.market.name, logo: buy.market.logo, price: buy.converted_last.usd },\n                                    sellExchange: { name: sell.market.name, logo: sell.market.logo, price: sell.converted_last.usd },\n                                    profit: profit,\n                                };\n                                break;\n                            }\n                        }\n                    }\n                    if (newOpportunity) break;\n                }\n            }\n\n            if (newOpportunity) {\n                recentOppIds.current.unshift(newOpportunity.id);\n                if (recentOppIds.current.length > 5) {\n                    recentOppIds.current.pop();\n                }\n                setOpportunity(newOpportunity);\n            } else {\n                // Keep the last opportunity if no new one is found, to avoid flickering\n                // setOpportunity(null);\n            }\n        } catch (error) {\n            console.error(\"Error fetching arbitrage data:\", error);\n            // setOpportunity(null);\n        } finally {\n            setIsLoading(false);\n        }\n    }, []);\n\n    useEffect(() => {\n        fetchArbitrageData();\n        const interval = setInterval(fetchArbitrageData, 8000);\n        return () => clearInterval(interval);\n    }, [fetchArbitrageData]);\n\n    const cardRef = useRef<HTMLDivElement>(null);\n    const x = useMotionValue(0);\n    const y = useMotionValue(0);\n    const rotateX = useTransform(y, [-200, 200], [15, -15], { clamp: true });\n    const rotateY = useTransform(x, [-200, 200], [-15, 15], { clamp: true });\n    \n    const handleMouseMove = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n        if (!cardRef.current) return;\n        const rect = cardRef.current.getBoundingClientRect();\n        x.set(e.clientX - rect.left - rect.width / 2);\n        y.set(e.clientY - rect.top - rect.height / 2);\n    };\n\n    const handleMouseLeave = () => { x.set(0); y.set(0); };\n\n    return (\n        <div \n            ref={cardRef}\n            onMouseMove={handleMouseMove}\n            onMouseLeave={handleMouseLeave}\n            className=\"relative h-full flex flex-col p-4 text-white overflow-hidden rounded-2xl bg-gradient-to-br from-[#0a0a1a]/80 to-[#1a1a2e]/90\"\n            style={{ perspective: '1000px' }}\n        >\n            <div className=\"absolute inset-0 -z-10 opacity-60\">\n                 <Canvas><Particles /></Canvas>\n            </div>\n            <AnimatedHeader />\n            <motion.div style={{ transformStyle: 'preserve-3d', rotateX, rotateY }} className=\"flex-grow flex items-center justify-center\">\n                <AnimatePresence mode=\"wait\">\n                    {isLoading && !opportunity ? (\n                        <motion.div key=\"loader\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className=\"flex flex-col items-center gap-2\">\n                            <div className=\"w-8 h-8 border-2 border-brand-primary border-t-transparent rounded-full animate-spin\"></div>\n                             <p className=\"text-xs text-brand-text-secondary font-mono\">Scanning {currentCoin.name}...</p>\n                        </motion.div>\n                    ) : opportunity ? (\n                        <motion.div\n                            key={opportunity.id}\n                            className=\"relative w-full max-w-xl h-48\"\n                            initial={{ opacity: 0, scale: 0.95 }}\n                            animate={{ opacity: 1, scale: 1 }}\n                            exit={{ opacity: 0, scale: 0.95 }}\n                            transition={{ duration: 0.5 }}\n                            style={{ transformStyle: 'preserve-3d' }}\n                        >\n                           <div className=\"absolute inset-0 bg-white/5 backdrop-blur-md rounded-2xl border border-cyan-300/20 shadow-2xl shadow-black/50 p-4 flex flex-col justify-between group\" style={{ transform: 'translateZ(40px)' }}>\n                                <div className=\"absolute -inset-px rounded-2xl bg-gradient-to-r from-indigo-500/50 via-violet-600/50 to-purple-600/50 opacity-0 group-hover:opacity-100 transition-opacity duration-500 blur-2xl pointer-events-none\" />\n\n                                <div className=\"flex justify-between items-center\">\n                                    <div className=\"flex items-center gap-3\">\n                                        <motion.img whileHover={{ rotate: 360 }} transition={{ duration: 2, ease: \"linear\", repeat: Infinity }} src={opportunity.coinLogo} alt={opportunity.coinName} className=\"w-10 h-10\" />\n                                        <div>\n                                            <h3 className=\"text-xl font-bold text-white\">{opportunity.coinName}</h3>\n                                            <p className=\"text-xs text-brand-text-secondary\">{opportunity.coinSymbol}</p>\n                                        </div>\n                                    </div>\n                                    <div className=\"text-right\">\n                                        <p className=\"text-sm font-bold text-green-400 uppercase tracking-wider\">Profit</p>\n                                        <div \n                                            className=\"text-4xl font-bold font-mono text-green-400\"\n                                            style={{ textShadow: '0 0 10px #22c55e' }}\n                                        >\n                                            {formatProfit(opportunity.profit)}\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                                <div className=\"flex justify-between items-end text-center\">\n                                    {/* BUY SIDE */}\n                                    <div className=\"w-2/5 flex flex-col items-center\">\n                                        <span className=\"text-xs text-brand-text-secondary uppercase tracking-wider\">Buy At</span>\n                                        <div className=\"flex items-center justify-center gap-1.5 mt-1 font-semibold text-sm\">\n                                            <img src={opportunity.buyExchange.logo} className=\"w-5 h-5 rounded-full bg-white/10\" alt=\"\" />\n                                            <span className=\"truncate max-w-[100px]\">{opportunity.buyExchange.name}</span>\n                                        </div>\n                                        <p className=\"font-mono text-lg\">{formatPrice(opportunity.buyExchange.price)}</p>\n                                    </div>\n\n                                    {/* CONNECTOR */}\n                                    <div className=\"w-1/5 flex items-center justify-center -mb-2\">\n                                       <div className=\"w-full h-px bg-gradient-to-r from-transparent via-cyan-400 to-transparent relative\">\n                                            <motion.div \n                                                className=\"absolute -left-1 -top-1 w-2.5 h-2.5 rounded-full bg-cyan-400 shadow-[0_0_8px_theme(colors.cyan.400)]\"\n                                                animate={{ x: '1000%' }}\n                                                transition={{ duration: 1.2, ease: 'easeInOut', delay: 0.5, repeat: Infinity, repeatType: \"reverse\" }}\n                                            />\n                                        </div>\n                                    </div>\n                                    \n                                    {/* SELL SIDE */}\n                                    <div className=\"w-2/5 flex flex-col items-center\">\n                                        <span className=\"text-xs text-brand-text-secondary uppercase tracking-wider\">Sell At</span>\n                                         <div className=\"flex items-center justify-center gap-1.5 mt-1 font-semibold text-sm\">\n                                            <img src={opportunity.sellExchange.logo} className=\"w-5 h-5 rounded-full bg-white/10\" alt=\"\" />\n                                             <span className=\"truncate max-w-[100px]\">{opportunity.sellExchange.name}</span>\n                                        </div>\n                                        <p className=\"font-mono text-lg\">{formatPrice(opportunity.sellExchange.price)}</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </motion.div>\n                    ) : (\n                        <motion.div key=\"no-opp\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className=\"text-center text-brand-text-secondary\">\n                            <p className=\"font-mono\">No significant arbitrage opportunity for {currentCoin.symbol}.</p>\n                            <p className=\"text-xs\">Scanning next asset...</p>\n                        </motion.div>\n                    )}\n                </AnimatePresence>\n            </motion.div>\n        </div>\n    );\n};\n\nexport default TradingVisualization;","size_bytes":15009},"components/HomePage.tsx":{"content":"import React, { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Cpu, ShieldCheck, Zap, Repeat, TrendingUp, BarChart, Star, CheckCircle, Send } from 'lucide-react';\nimport { getTestimonials, addTestimonial } from '../services/userDataService';\nimport { Testimonial } from '../types';\n\nconst Header: React.FC<{ onLogoClick: () => void; onNavigate: (view: 'login' | 'register' | 'testimonials') => void; }> = ({ onLogoClick, onNavigate }) => (\n    <header \n      className=\"fixed top-0 left-0 right-0 z-50 py-4 px-4 sm:px-8\"\n    >\n      <div className=\"max-w-7xl mx-auto flex justify-between items-center p-4 bg-brand-surface/20 backdrop-blur-lg border border-white/10 rounded-full shadow-lg\">\n        <div onClick={onLogoClick} className=\"flex items-center gap-2 cursor-pointer\">\n          <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M12 2L2 7L12 12L22 7L12 2Z\" stroke=\"url(#logoGradient)\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M2 17L12 22L22 17\" stroke=\"url(#logoGradient)\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            <path d=\"M2 12L12 17L22 12\" stroke=\"url(#logoGradient)\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n             <defs>\n                <linearGradient id=\"logoGradient\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"1\">\n                    <stop offset=\"0%\" stopColor=\"#00f5ff\" />\n                    <stop offset=\"100%\" stopColor=\"#e040fb\" />\n                </linearGradient>\n            </defs>\n          </svg>\n          <span className=\"font-bold text-xl text-white\">TradePilot AI</span>\n        </div>\n        <nav className=\"hidden md:flex items-center gap-8 text-brand-text-secondary font-semibold\">\n          <a href=\"#features\" className=\"hover:text-white transition-colors duration-300\">Features</a>\n          <a href=\"#testimonials\" className=\"hover:text-white transition-colors duration-300\">Reviews</a>\n        </nav>\n        <div className=\"flex items-center gap-2\">\n            <button onClick={() => onNavigate('login')} className=\"hidden sm:block px-6 py-2 text-brand-text-secondary font-bold rounded-full transition-all duration-300 hover:text-white hover:bg-white/10\">\n                Login\n            </button>\n            <button onClick={() => onNavigate('register')} className=\"px-6 py-2 bg-brand-primary text-brand-bg font-bold rounded-full transition-all duration-300 hover:scale-105 hover:shadow-[0_0_20px_theme(colors.brand.primary)]\">\n            Get Started\n            </button>\n        </div>\n      </div>\n    </header>\n);\n\nconst Section: React.FC<{ children: React.ReactNode; id?: string; className?: string }> = ({ children, id, className }) => (\n    <section \n        id={id} \n        className={`py-24 px-4 sm:px-6 lg:px-8 relative ${className}`}\n    >\n        <div className=\"max-w-7xl mx-auto\">{children}</div>\n    </section>\n);\n\nconst SectionTitle: React.FC<{ subtitle: string; title: React.ReactNode; }> = ({ subtitle, title }) => (\n    <div className=\"text-center mb-16\">\n        <p className=\"text-lg text-brand-primary font-bold uppercase tracking-widest\">{subtitle}</p>\n        <h2 className=\"text-4xl sm:text-5xl md:text-6xl font-bold mt-2 text-white\">{title}</h2>\n    </div>\n);\n\nconst StatCounter: React.FC<{ to: number; label: string; suffix?: string; decimals?: number }> = ({ to, label, suffix = '', decimals = 0 }) => {\n    const [count, setCount] = useState(0);\n    const ref = useRef<HTMLDivElement>(null);\n    const [inView, setInView] = useState(false);\n\n    useEffect(() => {\n        const observer = new IntersectionObserver(\n            ([entry]) => {\n                if (entry.isIntersecting) {\n                    setInView(true);\n                }\n            },\n            { threshold: 0.1 }\n        );\n\n        if (ref.current) {\n            observer.observe(ref.current);\n        }\n\n        return () => {\n            if (ref.current) {\n                observer.unobserve(ref.current);\n            }\n        };\n    }, []);\n  \n    useEffect(() => {\n        if (!inView) return;\n\n        let start = 0;\n        const duration = 1200;\n        const end = to;\n        if (start === end) return;\n        \n        let startTimestamp: number | null = null;\n        const step = (timestamp: number) => {\n            if (!startTimestamp) startTimestamp = timestamp;\n            const progress = Math.min((timestamp - startTimestamp) / duration, 1);\n            const currentCount = progress * (end - start) + start;\n            setCount(parseFloat(currentCount.toFixed(decimals)));\n            if (progress < 1) {\n                window.requestAnimationFrame(step);\n            }\n        };\n        window.requestAnimationFrame(step);\n    }, [to, decimals, inView]);\n  \n    return (\n      <div ref={ref} className=\"text-center group\" style={{ perspective: '500px' }}>\n        <div className=\"transition-transform duration-500 group-hover:-translate-y-2 group-hover:rotate-x-[-10deg]\" style={{ transformStyle: 'preserve-3d' }}>\n            <p className=\"text-5xl md:text-6xl font-bold text-brand-primary font-mono\" style={{ textShadow: '0 4px 15px rgba(0, 245, 255, 0.4)' }}>{count.toLocaleString(undefined, { minimumFractionDigits: decimals, maximumFractionDigits: decimals })}{suffix}</p>\n            <p className=\"text-sm text-brand-text-secondary uppercase tracking-widest mt-2\">{label}</p>\n        </div>\n      </div>\n    );\n};\n\nconst FeatureCard: React.FC<{ icon: React.ReactNode, title: string, description: string }> = ({ icon, title, description }) => {\n    const ref = useRef<HTMLDivElement>(null);\n    const [isHovered, setIsHovered] = useState(false);\n\n    return (\n        <motion.div\n            ref={ref}\n            onHoverStart={() => setIsHovered(true)}\n            onHoverEnd={() => setIsHovered(false)}\n            className=\"relative p-8 rounded-3xl border border-white/10 bg-brand-surface/20 backdrop-blur-md text-center h-full flex flex-col items-center\"\n            style={{ transformStyle: 'preserve-3d', perspective: '1000px' }}\n        >\n            <AnimatePresence>\n            {isHovered && (\n                 <motion.div \n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    exit={{ opacity: 0 }}\n                    className=\"absolute -inset-px rounded-3xl bg-gradient-to-br from-brand-primary to-brand-secondary blur-lg opacity-50\"\n                 />\n            )}\n            </AnimatePresence>\n            <div className=\"relative z-10 flex flex-col items-center flex-grow\">\n                <motion.div \n                    className=\"inline-block p-4 bg-brand-primary/10 rounded-full text-brand-primary mb-6\"\n                    animate={{ y: isHovered ? -10 : 0, scale: isHovered ? 1.1 : 1 }}\n                    transition={{ type: 'spring', stiffness: 300, damping: 10 }}\n                >\n                    {icon}\n                </motion.div>\n                <h3 className=\"text-xl font-bold mt-4 text-white\">{title}</h3>\n                <p className=\"mt-2 text-brand-text-secondary flex-grow\">{description}</p>\n            </div>\n        </motion.div>\n    );\n}\n\nconst StarRating: React.FC<{ rating: number, className?: string }> = ({ rating, className }) => (\n    <div className={`flex gap-1 ${className}`}>\n        {[...Array(5)].map((_, i) => (\n            <Star key={i} size={16} className={i < rating ? 'text-yellow-400 fill-yellow-400' : 'text-gray-600'} />\n        ))}\n    </div>\n);\n\nconst StarRatingInput: React.FC<{ rating: number; setRating: (rating: number) => void }> = ({ rating, setRating }) => (\n    <div className=\"flex justify-center gap-2\">\n        {[...Array(5)].map((_, i) => {\n            const starValue = i + 1;\n            return (\n                <motion.div\n                    key={i}\n                    whileHover={{ scale: 1.2, y: -5 }}\n                    whileTap={{ scale: 0.9 }}\n                    onClick={() => setRating(starValue)}\n                    className=\"cursor-pointer\"\n                >\n                    <Star\n                        size={32}\n                        className={`transition-colors duration-200 ${starValue <= rating ? 'text-yellow-400 fill-yellow-400' : 'text-gray-600 hover:text-gray-400'}`}\n                    />\n                </motion.div>\n            );\n        })}\n    </div>\n);\n\nconst TestimonialCard: React.FC<{ testimonial: Testimonial }> = ({ testimonial }) => {\n    return (\n        <div className=\"h-full bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-3xl p-8 flex flex-col text-left shadow-lg transition-all duration-300 hover:border-brand-primary/50 hover:-translate-y-1\">\n            <div className=\"flex items-center gap-4 mb-4\">\n                <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center font-bold text-brand-bg text-xl\">\n                    {testimonial.name?.charAt(0) || 'A'}\n                </div>\n                <div>\n                    <p className=\"font-bold text-white text-lg\">{testimonial.name || 'Anonymous'}</p>\n                    <StarRating rating={testimonial.rating} />\n                </div>\n            </div>\n            <p className=\"text-brand-text-secondary italic my-2 flex-grow\">\"{testimonial.text}\"</p>\n        </div>\n    );\n};\n\n\nconst HomePage: React.FC<{ onNavigate: (view: 'login' | 'register' | 'homepage' | 'testimonials') => void, onLogoClick: () => void }> = ({ onNavigate, onLogoClick }) => {\n    const [testimonials, setTestimonials] = useState<Testimonial[]>([]);\n    \n    // Testimonial Form State\n    const [formRating, setFormRating] = useState(0);\n    const [formName, setFormName] = useState('');\n    const [formEmail, setFormEmail] = useState('');\n    const [formText, setFormText] = useState('');\n    const [formError, setFormError] = useState('');\n    const [isSubmitting, setIsSubmitting] = useState(false);\n    const [showSuccess, setShowSuccess] = useState(false);\n\n    useEffect(() => {\n        const fetchTestimonials = async () => {\n            const allTestimonials = await getTestimonials();\n            // Show the 6 most recent testimonials\n            setTestimonials(allTestimonials.slice(0, 6));\n        };\n        fetchTestimonials();\n    }, []);\n\n    const features = [\n        { icon: <Cpu size={28} />, title: \"AI-Powered Arbitrage\", description: \"Our machine learning algorithms scan 50+ exchanges in real-time to find and execute profitable trades.\" },\n        { icon: <Zap size={28} />, title: \"Fully Automated\", description: \"Set it and forget it. TradePilot AI operates 24/7, capitalizing on market opportunities while you sleep.\" },\n        { icon: <ShieldCheck size={28} />, title: \"Bank-Grade Security\", description: \"Your funds and data are protected with multi-layer encryption and industry-leading security protocols.\" },\n        { icon: <Repeat size={28} />, title: \"Instant Execution\", description: \"High-frequency trading infrastructure ensures your arbitrage opportunities are seized without delay.\" },\n        { icon: <TrendingUp size={28} />, title: \"Profit Tracking\", description: \"Monitor your AI's performance and track your profits with our intuitive dashboard.\" },\n        { icon: <BarChart size={28} />, title: \"Transparent Reporting\", description: \"Get detailed reports on every trade, ensuring complete transparency and trust.\" },\n    ];\n    \n    const handleTestimonialSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if(!formText || !formName) {\n            setFormError('Full Name and Testimonial text are required.');\n            return;\n        }\n        if(formRating < 1 || formRating > 5) {\n            setFormError('Please select a star rating.');\n            return;\n        }\n        setFormError('');\n        setIsSubmitting(true);\n        try {\n            const newTestimonial = await addTestimonial({ name: formName, email: formEmail, text: formText, rating: formRating });\n            setShowSuccess(true);\n            setFormName('');\n            setFormEmail('');\n            setFormText('');\n            setFormRating(0);\n            // Add new testimonial to the top of the list\n            setTestimonials(prev => [newTestimonial, ...prev.slice(0, 5)]);\n        } catch (error) {\n            setFormError('An error occurred. Please try again.');\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    return (\n        <div className=\"bg-brand-bg min-h-screen overflow-x-hidden text-brand-text selection:bg-brand-primary selection:text-brand-bg\">\n            <div className=\"fixed inset-0 z-0 bg-gradient-to-br from-brand-bg via-brand-bg to-purple-900/20\"></div>\n            <Header onLogoClick={onLogoClick} onNavigate={onNavigate} />\n            \n            <main>\n                <section className=\"relative h-screen flex items-center justify-center text-center px-4 overflow-hidden\">\n                    <div className=\"relative z-10\">\n                        <h1 \n                            className=\"text-5xl sm:text-6xl md:text-8xl font-bold text-white leading-tight tracking-tighter\"\n                            style={{ textShadow: '0 0 30px rgba(255, 255, 255, 0.3)' }}\n                        >\n                            The Future of <br/>\n                            <span className=\"bg-clip-text text-transparent bg-gradient-to-br from-brand-primary to-brand-secondary\">\n                                Intelligent Trading\n                            </span>\n                        </h1>\n                        <p \n                            className=\"mt-6 max-w-2xl mx-auto text-lg text-brand-text-secondary\"\n                        >\n                            TradePilot AI executes thousands of arbitrage trades per day, fully automated, across 50+ exchanges. Your passive income journey starts here.\n                        </p>\n                        <div\n                            className=\"mt-10 flex justify-center items-center gap-4\"\n                        >\n                             <button onClick={() => onNavigate('register')} className=\"px-8 py-4 bg-brand-primary text-brand-bg font-bold rounded-full text-lg transition-all duration-300 hover:scale-105 hover:shadow-[0_0_30px_theme(colors.brand.primary)]\">\n                                Start Earning Now\n                            </button>\n                        </div>\n                    </div>\n                </section>\n\n                <Section className=\"bg-brand-bg\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-12\">\n                        <StatCounter to={50} suffix=\"+\" label=\"Exchanges Monitored\" />\n                        <StatCounter to={24000} suffix=\"+\" label=\"Active Users\" />\n                        <StatCounter to={2.7} decimals={1} suffix=\"M+\" label=\"USD Daily Volume\" />\n                    </div>\n                </Section>\n                \n                <Section id=\"features\" className=\"bg-brand-bg\">\n                    <SectionTitle subtitle=\"Why TradePilot\" title={<>An <span className=\"bg-clip-text text-transparent bg-gradient-to-br from-brand-primary to-brand-secondary\">Unfair</span> Advantage</>} />\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                        {features.map((feature) => (\n                            <div key={feature.title}>\n                                <FeatureCard {...feature} />\n                            </div>\n                        ))}\n                    </div>\n                </Section>\n\n                <Section id=\"testimonials\" className=\"bg-brand-bg\">\n                    <SectionTitle subtitle=\"Social Proof\" title=\"Trusted by Thousands\" />\n                    <p className=\"text-center max-w-3xl mx-auto -mt-8 mb-16 text-lg text-brand-text-secondary\">\n                        Hear from our community and share your success story. Your feedback helps us innovate and grow. Real stories, real results.\n                    </p>\n\n                     <div className=\"max-w-2xl mx-auto mb-20\">\n                        <div className=\"relative p-8 bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-3xl\">\n                            <AnimatePresence mode=\"wait\">\n                            {showSuccess ? (\n                                <motion.div \n                                    key=\"success\"\n                                    initial={{ opacity: 0, scale: 0.8 }}\n                                    animate={{ opacity: 1, scale: 1 }}\n                                    exit={{ opacity: 0, scale: 0.8 }}\n                                    className=\"text-center py-12\"\n                                >\n                                    <CheckCircle className=\"mx-auto text-green-400 w-16 h-16 mb-4\" />\n                                    <h3 className=\"text-2xl font-bold text-white\">Thank You!</h3>\n                                    <p className=\"text-brand-text-secondary mt-2\">Your testimonial has been submitted.</p>\n                                    <button onClick={() => setShowSuccess(false)} className=\"mt-6 px-6 py-2 bg-brand-primary text-brand-bg font-bold rounded-full\">Submit Another</button>\n                                </motion.div>\n                            ) : (\n                                <motion.form \n                                    key=\"form\"\n                                    onSubmit={handleTestimonialSubmit} \n                                    className=\"space-y-6\"\n                                    initial={{ opacity: 0 }}\n                                    animate={{ opacity: 1 }}\n                                >\n                                    <div className=\"text-center\">\n                                        <label className=\"text-brand-text-secondary mb-3 block\">Click to select your rating</label>\n                                        <StarRatingInput rating={formRating} setRating={setFormRating} />\n                                    </div>\n                                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\n                                        <input type=\"text\" placeholder=\"Full Name (required)\" value={formName} onChange={e => setFormName(e.target.value)} required className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\" />\n                                        <input type=\"email\" placeholder=\"Email (optional)\" value={formEmail} onChange={e => setFormEmail(e.target.value)} className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\" />\n                                    </div>\n                                    <textarea placeholder=\"Your testimonial... (required)\" value={formText} onChange={e => setFormText(e.target.value)} rows={5} required className=\"w-full p-3 bg-brand-bg/50 border-2 border-white/10 rounded-lg text-white placeholder-brand-text-secondary transition-all duration-300 glow-input\" />\n                                    {formError && <p className=\"text-red-400 text-sm text-center\">{formError}</p>}\n                                    <button type=\"submit\" disabled={isSubmitting} className=\"w-full py-3 bg-gradient-to-r from-brand-primary to-brand-secondary text-brand-bg font-bold rounded-lg flex items-center justify-center gap-2 transition-transform hover:scale-105 disabled:opacity-50\">\n                                        {isSubmitting ? <div className=\"w-5 h-5 border-2 border-brand-bg border-t-transparent rounded-full animate-spin\"></div> : <><Send size={18}/> Submit Review</>}\n                                    </button>\n                                </motion.form>\n                            )}\n                            </AnimatePresence>\n                        </div>\n                    </div>\n                    \n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                        {testimonials.map((testimonial) => (\n                            <div \n                                key={testimonial.id}\n                                className=\"h-full\"\n                            >\n                                <TestimonialCard testimonial={testimonial} />\n                            </div>\n                        ))}\n                    </div>\n                    <div className=\"text-center mt-12\">\n                        <button onClick={() => onNavigate('testimonials')} className=\"px-8 py-3 bg-brand-surface/50 border border-white/20 text-white font-bold rounded-full transition-all duration-300 hover:bg-white/10 hover:border-white/40\">\n                            View All Testimonials\n                        </button>\n                    </div>\n                </Section>\n            </main>\n\n            <footer className=\"bg-transparent border-t border-white/10 py-8 px-4 sm:px-6 lg:px-8 mt-16\">\n                <div className=\"max-w-7xl mx-auto text-center text-brand-text-secondary\">\n                    <p>&copy; {new Date().getFullYear()} TradePilot AI. All Rights Reserved.</p>\n                </div>\n            </footer>\n        </div>\n    );\n};\n\nexport default HomePage;","size_bytes":21438},"components/admin/WelcomeMessageEditor.tsx":{"content":"\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { WelcomeInboxMessageTemplate } from '../../types';\nimport { getWelcomeInboxMessageTemplate, saveWelcomeInboxMessageTemplate } from '../../services/userDataService';\nimport { Save, Eye, Trash2 } from 'lucide-react';\n\nconst Card: React.FC<{children: React.ReactNode, className?: string}> = ({ children, className = '' }) => (\n    <div className={`bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-2xl shadow-lg ${className}`}>\n        {children}\n    </div>\n);\n\nconst WelcomeMessageEditor: React.FC = () => {\n    const [template, setTemplate] = useState<WelcomeInboxMessageTemplate | null>(null);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isSaving, setIsSaving] = useState(false);\n    const [saveStatus, setSaveStatus] = useState('');\n    const [errorMessage, setErrorMessage] = useState('');\n\n    const loadTemplate = useCallback(async () => {\n        setIsLoading(true);\n        const data = await getWelcomeInboxMessageTemplate();\n        setTemplate(data);\n        setIsLoading(false);\n    }, []);\n\n    useEffect(() => {\n        loadTemplate();\n    }, [loadTemplate]);\n\n    const handleSave = async () => {\n        if (template) {\n            try {\n                setIsSaving(true);\n                setErrorMessage('');\n                setSaveStatus('Saving template to server...');\n                \n                const savedTemplate = { ...template };\n                \n                const currentTemplate = await getWelcomeInboxMessageTemplate();\n                if (currentTemplate.videoEmbedHtml) {\n                    savedTemplate.videoEmbedHtml = currentTemplate.videoEmbedHtml;\n                }\n                \n                console.log('Saving template...', { \n                    hasImage: !!savedTemplate.imageUrl, \n                    hasVideo: !!savedTemplate.videoUrl,\n                    hasPermanentEmbed: !!savedTemplate.videoEmbedHtml,\n                    imageSize: savedTemplate.imageUrl?.length || 0,\n                    videoSize: savedTemplate.videoUrl?.length || 0\n                });\n                \n                await saveWelcomeInboxMessageTemplate(savedTemplate);\n                \n                console.log('Template saved successfully');\n                setSaveStatus('✅ Template saved successfully! Changes are permanent.');\n                setTimeout(() => setSaveStatus(''), 4000);\n            } catch (error) {\n                console.error('Failed to save template:', error);\n                setErrorMessage(`❌ Failed to save template. ${error instanceof Error ? error.message : 'Try a smaller video or check your connection.'}`);\n                setTimeout(() => setErrorMessage(''), 6000);\n            } finally {\n                setIsSaving(false);\n            }\n        }\n    };\n\n    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n        if (template) {\n            setTemplate({ ...template, [e.target.name]: e.target.value });\n        }\n    };\n\n    const fileToBase64 = (file: File): Promise<string> => {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(file);\n            reader.onload = () => resolve(reader.result as string);\n            reader.onerror = error => reject(error);\n        });\n    };\n\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>, type: 'image' | 'video') => {\n        const file = e.target.files?.[0];\n        \n        console.log('File upload triggered:', { type, file: file?.name, size: file?.size });\n        \n        if (!file) {\n            console.log('No file selected');\n            return;\n        }\n        \n        if (!template) {\n            console.error('Template not loaded');\n            setErrorMessage('Template not loaded. Please refresh the page.');\n            return;\n        }\n        \n        if (template.videoEmbedHtml) {\n            setErrorMessage(`Cannot upload ${type} - a permanent video is already embedded. Only title and text can be edited.`);\n            setTimeout(() => setErrorMessage(''), 5000);\n            e.target.value = '';\n            return;\n        }\n        \n        const maxSizeMB = 100;\n        const fileSizeMB = file.size / (1024 * 1024);\n        \n        console.log(`File size: ${fileSizeMB.toFixed(2)}MB`);\n        \n        if (fileSizeMB > maxSizeMB) {\n            setErrorMessage(`File too large! Maximum size is ${maxSizeMB}MB. Your file is ${fileSizeMB.toFixed(1)}MB.`);\n            setTimeout(() => setErrorMessage(''), 5000);\n            e.target.value = '';\n            return;\n        }\n        \n        setErrorMessage('');\n        setSaveStatus(`Uploading ${type}... (${fileSizeMB.toFixed(1)}MB)`);\n        \n        try {\n            console.log(`Converting ${type} to base64...`);\n            const base64 = await fileToBase64(file);\n            console.log(`${type} converted successfully, uploading to server...`);\n            \n            setSaveStatus(`Uploading ${type} to server...`);\n            \n            const response = await fetch('/api/storage/upload-media', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({\n                    type: 'welcome_inbox',\n                    mediaType: type,\n                    data: base64\n                }),\n            });\n            \n            const result = await response.json();\n            \n            if (!result.success) {\n                throw new Error(result.message || 'Upload failed');\n            }\n            \n            console.log(`${type} uploaded successfully:`, result.url);\n            \n            if (type === 'image') {\n                setTemplate({ ...template, imageUrl: result.url, videoUrl: '' });\n            }\n            if (type === 'video') {\n                setTemplate({ ...template, videoUrl: result.url, imageUrl: '' });\n            }\n            \n            setSaveStatus(`✅ ${type.charAt(0).toUpperCase() + type.slice(1)} uploaded! Click \"Save Template\" to confirm.`);\n            setTimeout(() => setSaveStatus(''), 5000);\n        } catch (error) {\n            console.error(`Failed to upload ${type}:`, error);\n            setErrorMessage(`Failed to upload ${type}. Error: ${error instanceof Error ? error.message : 'Unknown error'}`);\n            setTimeout(() => setErrorMessage(''), 5000);\n        }\n    };\n\n    const removeMedia = (type: 'image' | 'video') => {\n        if(template) {\n            if(type === 'image') setTemplate({...template, imageUrl: ''});\n            if(type === 'video') setTemplate({...template, videoUrl: ''});\n        }\n    }\n\n    if (isLoading || !template) {\n        return <div className=\"flex items-center justify-center h-64\"><div className=\"w-12 h-12 border-4 border-brand-primary border-t-transparent rounded-full animate-spin\"></div></div>;\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold\">Welcome Inbox Message</h1>\n            <p className=\"text-brand-text-secondary\">This is the first message a new user sees in their inbox. Use it to provide key information and next steps.</p>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {/* Editor */}\n                <Card className=\"p-6 space-y-4\">\n                    <h2 className=\"text-xl font-bold\">Editor</h2>\n                    <div>\n                        <label className=\"text-sm text-brand-text-secondary\">Title</label>\n                        <input type=\"text\" name=\"title\" value={template.title} onChange={handleInputChange} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/>\n                    </div>\n                    <div>\n                        <label className=\"text-sm text-brand-text-secondary\">Message Body</label>\n                        <textarea name=\"text\" value={template.text} onChange={handleInputChange} rows={8} className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"/>\n                    </div>\n                     {template.videoEmbedHtml && (\n                        <div className=\"p-3 bg-blue-500/10 border border-blue-500/30 rounded\">\n                            <p className=\"text-sm text-blue-400 mb-2\">\n                                ℹ️ <strong>Permanent Video</strong>: The welcome video is embedded and cannot be changed. Only the title and text are editable.\n                            </p>\n                        </div>\n                    )}\n                    {!template.videoEmbedHtml && (\n                        <>\n                            <div>\n                                <label className=\"text-sm text-brand-text-secondary\">Image (optional)</label>\n                                <input type=\"file\" accept=\"image/*\" onChange={e => handleFileChange(e, 'image')} className=\"w-full mt-1 p-1 file:mr-4 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-brand-primary/20 file:text-brand-primary hover:file:bg-brand-primary/40 text-sm text-brand-text-secondary bg-brand-bg rounded border border-white/20\"/>\n                            </div>\n                            <div>\n                                <label className=\"text-sm text-brand-text-secondary\">Video (optional)</label>\n                                <input type=\"file\" accept=\"video/*\" onChange={e => handleFileChange(e, 'video')} className=\"w-full mt-1 p-1 file:mr-4 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-brand-primary/20 file:text-brand-primary hover:file:bg-brand-primary/40 text-sm text-brand-text-secondary bg-brand-bg rounded border border-white/20\"/>\n                            </div>\n                        </>\n                    )}\n                </Card>\n\n                {/* Preview */}\n                <div className=\"space-y-4\">\n                    <h2 className=\"text-xl font-bold flex items-center gap-2\"><Eye size={20}/> Preview (As seen in Inbox)</h2>\n                    <Card className=\"p-6\">\n                        <h3 className=\"text-xl font-bold text-white mb-2\">{template.title}</h3>\n                        {template.imageUrl && (\n                            <div className=\"relative inline-block my-4\">\n                                <img src={template.imageUrl} alt=\"Message visual\" className=\"rounded-lg max-h-40 w-auto\"/>\n                                <button onClick={() => removeMedia('image')} className=\"absolute -top-2 -right-2 p-1 bg-red-500 rounded-full text-white\"><Trash2 size={12}/></button>\n                            </div>\n                        )}\n                        {template.videoEmbedHtml && (\n                            <div className=\"my-4 rounded-lg overflow-hidden max-w-md\" dangerouslySetInnerHTML={{ __html: template.videoEmbedHtml }} />\n                        )}\n                        {!template.videoEmbedHtml && template.videoUrl && (\n                            <div className=\"relative inline-block my-4\">\n                                <video src={template.videoUrl} controls className=\"rounded-lg w-full max-w-xs\"/>\n                                <button onClick={() => removeMedia('video')} className=\"absolute -top-2 -right-2 p-1 bg-red-500 rounded-full text-white\"><Trash2 size={12}/></button>\n                            </div>\n                        )}\n                        <p className=\"text-brand-text-secondary whitespace-pre-wrap\">{template.text}</p>\n                    </Card>\n                </div>\n            </div>\n\n            <div className=\"flex items-center gap-4\">\n                <button \n                    onClick={handleSave} \n                    disabled={isSaving}\n                    className={`px-6 py-3 bg-brand-primary text-brand-bg font-bold rounded-lg flex items-center gap-2 transition-transform ${isSaving ? 'opacity-50 cursor-not-allowed' : 'hover:scale-105'}`}\n                >\n                    <Save size={18}/> {isSaving ? 'Saving...' : 'Save Template'}\n                </button>\n                <AnimatePresence>\n                {saveStatus && (\n                    <motion.p initial={{opacity: 0}} animate={{opacity: 1}} exit={{opacity: 0}} className=\"text-green-400\">{saveStatus}</motion.p>\n                )}\n                {errorMessage && (\n                    <motion.p initial={{opacity: 0}} animate={{opacity: 1}} exit={{opacity: 0}} className=\"text-red-400 font-semibold\">{errorMessage}</motion.p>\n                )}\n                </AnimatePresence>\n            </div>\n        </div>\n    );\n};\n\nexport default WelcomeMessageEditor;\n","size_bytes":12808},"components/Dashboard.tsx":{"content":"\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { User, UserData, Transaction } from '../types';\nimport { motion, AnimatePresence, useSpring, useTransform } from 'framer-motion';\nimport { \n    LayoutDashboard, LogOut, Bot, X, Menu, TrendingUp, Rocket, Wallet, Mail, Users, ArrowUpFromLine, ArrowDownToLine, LineChart as HistoryIcon, User as UserIcon, Download, MessageSquare\n} from 'lucide-react';\nimport DashboardBackground from './three/DashboardBackground';\nimport { getUserData, recordProfitAndUpdateDate, getMessages, showBrowserNotification, updateUserNotificationPermission } from '../services/userDataService';\n\n// Import new page components\nimport HistoryPage from './dashboard/HistoryPage';\nimport ProfilePage from './dashboard/ProfilePage';\nimport DepositPage from './dashboard/DepositPage';\nimport WithdrawPage from './dashboard/WithdrawPage';\nimport PlansPage from './dashboard/PlansPage';\nimport ReferralsPage from './dashboard/ReferralsPage';\nimport InboxPage from './dashboard/InboxPage';\nimport MessagesPanel from './dashboard/MessagesPanel'; // Import the new MessagesPanel\nimport NotificationPermissionModal from './dashboard/NotificationPermissionModal';\nimport BottomNavBar from './dashboard/BottomNavBar';\n\nconst useInterval = (callback: () => void, delay: number | null) => {\n  const savedCallback = React.useRef<() => void>();\n  useEffect(() => { savedCallback.current = callback; }, [callback]);\n  useEffect(() => {\n    function tick() { if (savedCallback.current) savedCallback.current(); }\n    if (delay !== null) {\n      const id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n};\n\nexport type DashboardView = 'overview' | 'history' | 'profile' | 'deposit' | 'withdraw' | 'plans' | 'referrals' | 'inbox';\n\nconst Dashboard: React.FC<{ user: User; onLogout: () => void; initialView?: DashboardView }> = ({ user, onLogout, initialView = 'overview' }) => {\n    const [activeView, setActiveView] = useState<DashboardView>(initialView);\n    const [isSidebarOpen, setSidebarOpen] = useState(true);\n    const [isMessagesPanelOpen, setMessagesPanelOpen] = useState(false);\n    const [userData, setUserData] = useState<UserData | null>(null);\n    const [isLoading, setIsLoading] = useState(true);\n    const [toast, setToast] = useState<{ message: string, type: 'success' | 'error' } | null>(null);\n    \n    const [installPrompt, setInstallPrompt] = useState<Event | null>(null);\n    const [isAppInstalled, setIsAppInstalled] = useState(false);\n    const [isNotificationModalOpen, setNotificationModalOpen] = useState(false);\n    const [hasNewMessages, setHasNewMessages] = useState(false);\n    const [newMessageCount, setNewMessageCount] = useState(0);\n    const [showNotificationPopup, setShowNotificationPopup] = useState(false);\n    const notificationIntervalRef = React.useRef<ReturnType<typeof setInterval> | null>(null);\n\n    const showToast = (message: string, type: 'success' | 'error' = 'success') => {\n        setToast({ message, type });\n        setTimeout(() => setToast(null), 3000);\n    };\n\n    const loadUserData = useCallback(async () => {\n        setIsLoading(true);\n        const data = await getUserData(user.id);\n        if (data) {\n            setUserData(data);\n            if (data.notificationPermission === 'default') {\n                const timer = setTimeout(() => setNotificationModalOpen(true), 5000);\n                return () => clearTimeout(timer);\n            }\n        }\n        setIsLoading(false);\n    }, [user.id]);\n    \n    useEffect(() => {\n        loadUserData();\n    }, [loadUserData]);\n\n    // PWA Install & Notification Permission Logic\n    useEffect(() => {\n        const handleInstallPrompt = (e: Event) => {\n            e.preventDefault();\n            setInstallPrompt(e);\n        };\n        window.addEventListener('beforeinstallprompt', handleInstallPrompt);\n        \n        if (window.matchMedia('(display-mode: standalone)').matches) {\n            setIsAppInstalled(true);\n        }\n\n        return () => window.removeEventListener('beforeinstallprompt', handleInstallPrompt);\n    }, []);\n\n    const handleInstallClick = () => {\n        if (!installPrompt) return;\n        (installPrompt as any).prompt();\n        (installPrompt as any).userChoice.then(() => {\n            setInstallPrompt(null);\n            setIsAppInstalled(true);\n        });\n    };\n\n    // Daily profit generation logic & notification\n    useEffect(() => {\n        const checkAndAddProfit = async () => {\n            if (userData?.activePlan?.isActive) {\n                const { activePlan } = userData;\n                const now = new Date();\n                const lastProfit = activePlan.lastProfitDate ? new Date(activePlan.lastProfitDate) : new Date(activePlan.activationDate!);\n\n                const msInDay = 24 * 60 * 60 * 1000;\n                if (now.getTime() - lastProfit.getTime() >= msInDay) {\n                    const dailyProfit = activePlan.investment * (activePlan.dailyReturn / 100);\n                    \n                    const updatedData = await recordProfitAndUpdateDate(userData.id, parseFloat(dailyProfit.toFixed(2)));\n                    if (updatedData) {\n                        setUserData(updatedData);\n                        const profitText = `+${formatCurrency(dailyProfit)} profit generated!`;\n                        showToast(profitText);\n                        showBrowserNotification('Profit Generated!', { body: `Your AI has generated ${formatCurrency(dailyProfit)}. New balance: ${formatCurrency(updatedData.balance)}.` });\n                    }\n                }\n            }\n        };\n\n        if (userData) {\n            const timer = setTimeout(() => checkAndAddProfit(), 2000); // Check 2s after data loads\n            return () => clearTimeout(timer);\n        }\n    }, [userData]);\n\n    // New messages check for indicator and notifications\n    const checkNewMessages = useCallback(async () => {\n        if (!userData) return;\n\n        const allMessages = await getMessages();\n        const lastCheck = localStorage.getItem(`lastMessageCheck_${userData.id}`) || new Date(0).toISOString();\n        \n        const newMessages = allMessages\n            .filter(msg => new Date(msg.createdAt) > new Date(lastCheck))\n            .filter(msg => !msg.recipientId || msg.recipientId === userData.id);\n        \n        const newCount = newMessages.length;\n        setNewMessageCount(newCount);\n        \n        const newMessagesExist = newCount > 0;\n        \n        if (newMessagesExist && !hasNewMessages) {\n            setHasNewMessages(true);\n            // Show browser notification only once per check if permission granted\n            if (Notification.permission === 'granted') {\n                const latestMessage = newMessages.sort((a,b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())[0];\n                showBrowserNotification(`New Message: ${latestMessage.title}`, {\n                    body: latestMessage.text.substring(0, 100) + '...',\n                });\n            }\n        } else if (!newMessagesExist) {\n            setHasNewMessages(false);\n        }\n    }, [userData, hasNewMessages]);\n\n    useInterval(checkNewMessages, 15000); // Check every 15 seconds for new messages\n\n    // Effect to handle the repeating notification popup\n    useEffect(() => {\n        if (hasNewMessages) {\n            const showAndHidePopup = () => {\n                setShowNotificationPopup(true);\n                setTimeout(() => setShowNotificationPopup(false), 4000); // Popup visible for 4s\n            };\n    \n            showAndHidePopup(); // Show immediately once\n            notificationIntervalRef.current = setInterval(showAndHidePopup, 20000); // Then repeat every 20s\n    \n            return () => {\n                if (notificationIntervalRef.current) {\n                    clearInterval(notificationIntervalRef.current);\n                }\n            };\n        } else {\n            setShowNotificationPopup(false);\n            if (notificationIntervalRef.current) {\n                clearInterval(notificationIntervalRef.current);\n            }\n        }\n    }, [hasNewMessages]);\n\n\n    useEffect(() => {\n        const mediaQuery = window.matchMedia('(min-width: 1024px)');\n        const handleResize = () => setSidebarOpen(mediaQuery.matches);\n        handleResize();\n        window.addEventListener('resize', handleResize);\n        return () => window.removeEventListener('resize', handleResize);\n    }, []);\n\n    const handleInboxOpened = useCallback(() => {\n        if (userData) {\n            localStorage.setItem(`lastMessageCheck_${userData.id}`, new Date().toISOString());\n            setHasNewMessages(false);\n            setNewMessageCount(0);\n        }\n    }, [userData]);\n    \n    const renderContent = () => {\n        if (isLoading || !userData) {\n            return (\n                <div className=\"flex items-center justify-center h-full pt-20\">\n                    <div className=\"w-16 h-16 border-4 border-brand-primary border-t-transparent rounded-full animate-spin\"></div>\n                </div>\n            );\n        }\n        \n        switch(activeView) {\n            case 'overview': return <OverviewContent userData={userData} />;\n            case 'history': return <HistoryPage transactions={userData.transactions} />;\n            case 'profile': return <ProfilePage user={userData} showToast={showToast} onUpdate={loadUserData} onLogout={onLogout} />;\n            case 'deposit': return <DepositPage userData={userData} showToast={showToast} onUpdate={loadUserData} />;\n            case 'withdraw': return <WithdrawPage userData={userData} showToast={showToast} onUpdate={loadUserData} />;\n            case 'plans': return <PlansPage userData={userData} showToast={showToast} onUpdate={loadUserData} />;\n            case 'referrals': return <ReferralsPage userData={userData} showToast={showToast} />;\n            case 'inbox': return <InboxPage user={userData} />;\n            default: return <OverviewContent userData={userData} />;\n        }\n    };\n\n    const NavItem: React.FC<{ view: DashboardView; icon: React.ReactNode; label: string }> = ({ view, icon, label }) => (\n        <button\n            onClick={() => {\n                setActiveView(view);\n                if (window.innerWidth < 1024) {\n                    setSidebarOpen(false);\n                }\n            }}\n            className={`flex items-center w-full px-4 py-3 text-left rounded-lg transition-all duration-300 transform hover:scale-105 ${activeView === view ? 'bg-brand-primary/20 text-brand-primary shadow-[0_0_15px_rgba(0,245,255,0.5)]' : 'text-brand-text-secondary hover:bg-white/10 hover:text-white'}`}\n        >\n            {icon}\n            <span className=\"ml-4 whitespace-nowrap\">{label}</span>\n        </button>\n    );\n\n    return (\n        <div className=\"flex min-h-screen bg-brand-bg font-sans\">\n            <AnimatePresence>\n                {isSidebarOpen && (\n                    <motion.div\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      exit={{ opacity: 0 }}\n                      className=\"fixed inset-0 bg-black/50 z-40 lg:hidden\"\n                      onClick={() => setSidebarOpen(false)}\n                    />\n                )}\n            </AnimatePresence>\n            \n            <aside className={`fixed lg:relative inset-y-0 left-0 w-64 bg-brand-surface/50 backdrop-blur-xl border-r border-white/10 z-50 flex flex-col p-4 transform transition-transform duration-500 ease-in-out ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>\n                <div className=\"flex items-center justify-between mb-8\">\n                    <h1 className=\"text-2xl font-bold text-brand-primary\">TradePilot</h1>\n                    <button onClick={() => setSidebarOpen(false)} className=\"lg:hidden p-2 rounded-full hover:bg-white/10 text-brand-text-secondary\">\n                        <X size={20} />\n                    </button>\n                </div>\n                <nav className=\"flex flex-col gap-2\">\n                    <NavItem view=\"overview\" icon={<LayoutDashboard size={20}/>} label=\"Overview\" />\n                    <NavItem view=\"history\" icon={<HistoryIcon size={20}/>} label=\"History\" />\n                    <NavItem view=\"profile\" icon={<UserIcon size={20}/>} label=\"Profile\" />\n                </nav>\n                <div className=\"mt-auto\">\n                    {installPrompt && !isAppInstalled && (\n                        <button\n                            onClick={handleInstallClick}\n                            className=\"flex items-center justify-center w-full px-4 py-3 rounded-lg text-white bg-gradient-to-br from-brand-primary/50 to-brand-secondary/50 border border-white/20 shadow-lg mb-2\n                                       transition-all duration-300 transform hover:scale-105 hover:shadow-brand-primary/40 focus:outline-none focus:ring-2 focus:ring-brand-primary\"\n                        >\n                            <Download size={20} className=\"mr-3\"/>\n                            <span className=\"font-semibold whitespace-nowrap\">Download App</span>\n                        </button>\n                    )}\n                    <button onClick={onLogout} className=\"flex items-center w-full px-4 py-3 text-left rounded-lg text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-all duration-300 transform hover:scale-105\">\n                        <LogOut size={20}/>\n                        <span className=\"ml-4\">Logout</span>\n                    </button>\n                </div>\n            </aside>\n\n            <main className=\"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto relative pb-24 lg:pb-8\">\n                <DashboardBackground />\n                 <button onClick={() => setSidebarOpen(true)} className={`lg:hidden p-2 absolute top-6 left-6 text-white z-20 transition-opacity ${isSidebarOpen ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}>\n                    <Menu size={28}/>\n                </button>\n                <motion.button\n                    onClick={() => {\n                        if (userData) {\n                            handleInboxOpened();\n                            setMessagesPanelOpen(true);\n                        }\n                    }}\n                    className=\"fixed top-6 right-6 lg:right-8 z-20 text-white p-3 bg-brand-surface/50 backdrop-blur-lg rounded-full border border-white/10 shadow-lg\"\n                    whileHover={{ scale: 1.1, boxShadow: '0 0 20px rgba(0, 245, 255, 0.5)' }}\n                    whileTap={{ scale: 0.95 }}\n                    aria-label=\"Open Inbox\"\n                    style={{ transformStyle: 'preserve-3d' }}\n                >\n                    <Mail size={24} />\n                    <AnimatePresence>\n                    {hasNewMessages && (\n                        <motion.div \n                            className=\"absolute top-0 right-0 w-3.5 h-3.5 bg-red-500 rounded-full border-2 border-brand-surface shadow-[0_0_12px_2px_theme(colors.red.500)]\"\n                            style={{ transform: 'translateZ(10px)' }}\n                            initial={{ scale: 0 }}\n                            animate={{ scale: [1, 1.3, 1] }}\n                            exit={{ scale: 0 }}\n                            transition={{ duration: 1.5, repeat: Infinity, ease: 'easeInOut', repeatType: 'mirror' }}\n                        />\n                    )}\n                    </AnimatePresence>\n                </motion.button>\n                <AnimatePresence>\n                    {showNotificationPopup && (\n                        <motion.div\n                            initial={{ opacity: 0, y: 50, x: 50, scale: 0.8, rotateX: -20 }}\n                            animate={{ opacity: 1, y: 0, x: 0, scale: 1, rotateX: 0 }}\n                            exit={{ opacity: 0, y: 50, x: 50, scale: 0.8, rotateX: 20, transition: { duration: 0.4 } }}\n                            transition={{ type: 'spring', stiffness: 200, damping: 20 }}\n                            className=\"fixed top-24 right-6 lg:right-8 z-50 p-4 w-full max-w-xs bg-brand-surface/70 backdrop-blur-2xl border border-brand-primary/50 rounded-2xl shadow-2xl shadow-brand-primary/30\"\n                            style={{ pointerEvents: 'auto', perspective: '800px' }}\n                        >\n                            <div style={{ transformStyle: 'preserve-3d' }}>\n                                <div style={{ transform: 'translateZ(20px)' }} className=\"flex items-center gap-3\">\n                                    <div className=\"p-2 bg-brand-primary/20 rounded-full text-brand-primary\">\n                                        <Mail size={24} />\n                                    </div>\n                                    <div>\n                                        <p className=\"font-bold text-white\">You have {newMessageCount} unread message{newMessageCount === 1 ? '' : 's'}.</p>\n                                        <p className=\"text-sm text-brand-text-secondary\">Check your inbox.</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </motion.div>\n                    )}\n                </AnimatePresence>\n\n                <div className=\"relative z-10 max-w-7xl mx-auto\">\n                    {renderContent()}\n                </div>\n            </main>\n\n            <BottomNavBar activeView={activeView} setActiveView={setActiveView} />\n            <Toast toast={toast} />\n            {userData && <MessagesPanel \n                isOpen={isMessagesPanelOpen} \n                onClose={() => setMessagesPanelOpen(false)}\n                user={userData}\n            />}\n            <NotificationPermissionModal \n                isOpen={isNotificationModalOpen} \n                onClose={() => setNotificationModalOpen(false)}\n                onPermissionResult={(permission) => {\n                    if (userData) {\n                        updateUserNotificationPermission(userData.id, permission);\n                    }\n                }}\n            />\n        </div>\n    );\n};\n\nconst Card: React.FC<{children: React.ReactNode, className?: string, isHoverable?: boolean}> = ({ children, className = '', isHoverable = true }) => (\n    <div className={`bg-gradient-to-br from-brand-surface/40 to-brand-surface/20 backdrop-blur-lg border border-white/10 rounded-2xl shadow-lg transition-all duration-300 relative overflow-hidden group ${isHoverable && 'hover:border-violet-500/50 hover:shadow-violet-500/20 hover:-translate-y-1'} ${className}`}>\n        <div className=\"absolute -inset-px rounded-2xl bg-gradient-to-r from-indigo-500/40 to-violet-600/40 opacity-0 group-hover:opacity-100 transition-opacity duration-500 blur-2xl pointer-events-none\" />\n        <div className=\"relative h-full w-full\">\n            {children}\n        </div>\n    </div>\n);\n\nconst formatCurrency = (value: number) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\nconst formatCryptoPrice = (value: number) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: value > 1 ? 3 : 6 })}`;\n\nconst AnimatedCounter: React.FC<{ value: number }> = ({ value }) => {\n    return (\n        <AnimatePresence mode=\"wait\">\n            <motion.span\n                key={value}\n                initial={{ opacity: 0, y: -10 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: 10 }}\n                transition={{ duration: 0.3 }}\n            >\n                {formatCurrency(value)}\n            </motion.span>\n        </AnimatePresence>\n    );\n};\n\nconst ArbitrageDisplay: React.FC = () => {\n    const TradingVisualization = React.lazy(() => import('./three/TradingVisualization'));\n\n    return (\n        <Card className=\"h-[280px] p-0\" isHoverable={false}>\n            <React.Suspense fallback={<div className=\"w-full h-full flex items-center justify-center text-brand-text-secondary\">Loading live feed...</div>}>\n                <TradingVisualization />\n            </React.Suspense>\n        </Card>\n    );\n};\n\nconst UserSummary: React.FC<{ userData: UserData }> = ({ userData }) => {\n    const recentTransactions = [...userData.transactions]\n        .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\n        .slice(0, 3);\n\n    return (\n        <Card className=\"p-6\" isHoverable={false}>\n            <h3 className=\"font-bold text-white text-lg mb-4\">Recent Activity</h3>\n            {recentTransactions.length > 0 ? (\n                <ul className=\"space-y-3\">\n                    {recentTransactions.map(tx => (\n                        <li key={tx.id} className=\"flex justify-between items-center text-sm\">\n                            <div>\n                                <p className=\"font-semibold text-white\">{tx.type}</p>\n                                <p className=\"text-xs text-brand-text-secondary\">{new Date(tx.date).toLocaleDateString()}</p>\n                            </div>\n                            <p className={`font-mono font-bold ${tx.type === 'Deposit' || tx.type === 'Profit' ? 'text-green-400' : 'text-red-400'}`}>\n                                {tx.type === 'Deposit' || tx.type === 'Profit' ? '+' : '-'}{formatCurrency(tx.usdValue || tx.amount)}\n                            </p>\n                        </li>\n                    ))}\n                </ul>\n            ) : (\n                <p className=\"text-brand-text-secondary text-center py-4\">No recent transactions.</p>\n            )}\n        </Card>\n    );\n};\n\nconst OverviewContent: React.FC<{ userData: UserData; }> = ({ userData }) => (\n    <div className=\"flex flex-col gap-6 mt-12 lg:mt-0\">\n        <DashboardHeader user={userData} />\n        <WalletSummary userData={userData} />\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <AiPerformance userData={userData} />\n            <ArbitrageDisplay />\n        </div>\n        <UserSummary userData={userData} />\n    </div>\n);\n\nconst DashboardHeader: React.FC<{ user: UserData; }> = ({ user }) => (\n    <div className=\"p-6 bg-brand-surface/40 backdrop-blur-lg border border-white/10 rounded-2xl flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n            <h2 className=\"text-2xl md:text-3xl font-bold text-white\">Welcome, {user.name}!</h2>\n            <div className=\"flex items-center gap-3 mt-2\">\n                {user.activePlan?.isActive ? (\n                    <div className=\"flex items-center gap-2 text-green-400\">\n                        <div className=\"w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse shadow-[0_0_10px_theme(colors.green.400)]\"></div>\n                        <span className=\"font-semibold text-sm\">AI Trading Active</span>\n                    </div>\n                ) : user.activePlan && !user.activePlan.isActive ? (\n                     <div className=\"flex items-center gap-2 text-yellow-400\">\n                        <div className=\"w-2.5 h-2.5 rounded-full bg-yellow-400\"></div>\n                        <span className=\"font-semibold text-sm\">AI Inactive - Activate your plan</span>\n                    </div>\n                ) : (\n                    <div className=\"flex items-center gap-2 text-red-400\">\n                        <div className=\"w-2.5 h-2.5 rounded-full bg-red-400\"></div>\n                        <span className=\"font-semibold text-sm\">No Active Plan</span>\n                    </div>\n                )}\n            </div>\n        </div>\n        <div className=\"flex items-center gap-4\">\n            <p className=\"font-bold text-white px-3 py-1 bg-brand-primary/20 border border-brand-primary/80 rounded-full text-sm\">{user.activePlan?.name || \"No Plan\"}</p>\n        </div>\n    </div>\n);\n\nconst WalletSummary: React.FC<{ userData: UserData }> = ({ userData }) => {\n    const WalletCard: React.FC<{ title: string, value: number, icon: React.ReactNode }> = ({ title, value, icon }) => (\n        <Card className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n                <div className=\"p-3 bg-brand-primary/10 text-brand-primary rounded-full\">{icon}</div>\n                <div>\n                    <p className=\"text-sm text-brand-text-secondary\">{title}</p>\n                    <p className=\"text-lg md:text-xl font-bold text-white font-mono\"><AnimatedCounter value={value} /></p>\n                </div>\n            </div>\n        </Card>\n    );\n\n    return (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n            <WalletCard title=\"Available Balance\" value={userData.balance} icon={<Wallet size={24}/>} />\n            <WalletCard title=\"Total Profit\" value={userData.totalProfit} icon={<TrendingUp size={24}/>} />\n            <WalletCard title=\"Active Investment\" value={userData.activePlan?.investment || 0} icon={<Rocket size={24}/>} />\n        </div>\n    );\n};\n\nconst AnimatedNumber = ({ value, formatter }: { value: number, formatter: (val: number) => string }) => {\n    const spring = useSpring(value, { mass: 0.8, stiffness: 100, damping: 20 });\n    const display = useTransform(spring, (current) => formatter(current));\n\n    useEffect(() => {\n        spring.set(value);\n    }, [spring, value]);\n\n    return <motion.span>{display}</motion.span>;\n};\n\nconst AiPerformance: React.FC<{ userData: UserData }> = ({ userData }) => {\n    const NeuralNetwork = React.lazy(() => import('./three/NeuralNetwork'));\n    \n    const [duration, setDuration] = useState('0d, 0h');\n\n    useEffect(() => {\n        if (!userData.activePlan?.isActive || !userData.activePlan.activationDate) {\n            setDuration('0d, 0h');\n            return;\n        }\n\n        const timer = setInterval(() => {\n            const activationTime = new Date(userData.activePlan!.activationDate!).getTime();\n            const now = new Date().getTime();\n            const diff = now - activationTime;\n\n            if (diff < 0) {\n                setDuration(\"0d, 0h\");\n                return;\n            }\n\n            let seconds = Math.floor(diff / 1000);\n            let hours = Math.floor(seconds / 3600);\n            const days = Math.floor(hours / 24);\n            hours = hours % 24;\n            setDuration(`${days}d, ${hours}h`);\n        }, 1000);\n\n        return () => clearInterval(timer);\n    }, [userData.activePlan]);\n\n    const performanceMetrics = useMemo(() => {\n        const totalTrades = userData.transactions.filter(t => t.type === 'Profit').length;\n\n        if (!userData.activePlan) {\n            return { dailyROI: 0, totalTrades, daysLeft: 'N/A', cycleProgress: 0 };\n        }\n        \n        const { dailyReturn, activationDate, duration, isActive } = userData.activePlan;\n        \n        if (!isActive || !activationDate) {\n             return { dailyROI: dailyReturn, totalTrades, daysLeft: '0 days', cycleProgress: 0 };\n        }\n\n        const activationTime = new Date(activationDate).getTime();\n        const now = new Date().getTime();\n        const endTime = activationTime + duration * 24 * 60 * 60 * 1000;\n        const timeLeft = endTime - now;\n        \n        const daysLeft = timeLeft <= 0 ? \"0 days\" : `${Math.ceil(timeLeft / (1000 * 60 * 60 * 24))} days`;\n\n        const totalDurationMs = duration * 24 * 60 * 60 * 1000;\n        const elapsedTimeMs = now - activationTime;\n        const cycleProgress = Math.min(100, Math.max(0, (elapsedTimeMs / totalDurationMs) * 100));\n\n        return { dailyROI: dailyReturn, totalTrades, daysLeft, cycleProgress };\n    }, [userData]);\n    \n    const CircularProgress: React.FC<{ progress: number }> = ({ progress }) => {\n        const radius = 18; const stroke = 3;\n        const normalizedRadius = radius - stroke;\n        const circumference = normalizedRadius * 2 * Math.PI;\n        const strokeDashoffset = circumference - (progress / 100) * circumference;\n        return (\n            <svg height={radius * 2} width={radius * 2} className=\"-rotate-90\">\n                <circle stroke=\"rgba(255,255,255,0.1)\" fill=\"transparent\" strokeWidth={stroke} r={normalizedRadius} cx={radius} cy={radius} />\n                <motion.circle\n                    stroke=\"url(#progressGradient)\" fill=\"transparent\" strokeWidth={stroke} strokeDasharray={circumference}\n                    style={{ strokeDashoffset }} r={normalizedRadius} cx={radius} cy={radius}\n                    initial={{ strokeDashoffset: circumference }} animate={{ strokeDashoffset }} transition={{ duration: 1, ease: 'easeInOut' }}\n                />\n                <defs><linearGradient id=\"progressGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\"><stop offset=\"0%\" stopColor=\"#00f5ff\" /><stop offset=\"100%\" stopColor=\"#e040fb\" /></linearGradient></defs>\n            </svg>\n        );\n    };\n\n    const StatCard: React.FC<{ title: string; children: React.ReactNode, className?: string }> = ({ title, children, className }) => (\n        <motion.div\n            whileHover={{ y: -5, scale: 1.05 }}\n            className={`bg-white/5 backdrop-blur-sm p-3 rounded-xl border border-white/10 text-center flex flex-col justify-center items-center ${className}`}\n            style={{ transformStyle: 'preserve-3d' }}\n        >\n            <div style={{ transform: 'translateZ(20px)' }}>\n                <p className=\"text-xs text-brand-text-secondary mb-1\">{title}</p>\n                {children}\n            </div>\n        </motion.div>\n    );\n\n    return (\n        <Card className=\"p-4 flex flex-col h-[280px] overflow-hidden\" isHoverable={false}>\n            <div className=\"flex-shrink-0 text-center mb-2 relative\">\n                <h3 className=\"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-brand-primary to-brand-secondary\" style={{ textShadow: '0 0 10px rgba(0, 245, 255, 0.5)'}}>\n                    AI Performance\n                </h3>\n                <p className=\"text-xs text-brand-text-secondary/80\">Live metrics powered by real AI trading data</p>\n                <div className=\"absolute inset-x-0 bottom-[-5px] h-px bg-gradient-to-r from-transparent via-brand-primary/50 to-transparent animate-pulse\"></div>\n            </div>\n\n            <div className=\"flex-grow relative flex items-center justify-center\">\n                <div className=\"absolute inset-0 z-0 opacity-50\">\n                    <React.Suspense fallback={null}><NeuralNetwork /></React.Suspense>\n                </div>\n                \n                <div className=\"relative z-10 grid grid-cols-2 grid-rows-2 gap-3 w-full max-w-sm\">\n                    <StatCard title=\"Daily ROI\">\n                        <p className=\"text-2xl font-bold font-mono text-green-400\">\n                           +<AnimatedNumber value={performanceMetrics.dailyROI} formatter={(v) => v.toFixed(2)} />%\n                        </p>\n                    </StatCard>\n                    <StatCard title=\"Profit Trades\">\n                        <p className=\"text-2xl font-bold font-mono text-white\">\n                            <AnimatedNumber value={performanceMetrics.totalTrades} formatter={(v) => Math.round(v).toLocaleString()} />\n                        </p>\n                    </StatCard>\n                    <StatCard title=\"Active Duration\">\n                        <p className=\"text-lg font-bold font-mono text-white\">{duration}</p>\n                    </StatCard>\n                     <StatCard title=\"Days Left\">\n                        <div className=\"flex items-center justify-center gap-2\">\n                            <CircularProgress progress={performanceMetrics.cycleProgress} />\n                            <p className=\"text-lg font-bold font-mono text-white\">{performanceMetrics.daysLeft}</p>\n                        </div>\n                    </StatCard>\n                </div>\n            </div>\n        </Card>\n    );\n};\n\nconst Toast: React.FC<{ toast: { message: string, type: 'success' | 'error' } | null }> = ({ toast }) => {\n    return (\n        <AnimatePresence>\n            {toast && (\n                <motion.div\n                    initial={{ opacity: 0, y: 50, scale: 0.3 }}\n                    animate={{ opacity: 1, y: 0, scale: 1 }}\n                    exit={{ opacity: 0, y: 20, scale: 0.5 }}\n                    className={`fixed bottom-24 lg:bottom-10 right-10 z-50 p-4 rounded-lg shadow-lg text-white ${toast.type === 'success' ? 'bg-green-500' : 'bg-red-500'}`}\n                >\n                    {toast.message}\n                </motion.div>\n            )}\n        </AnimatePresence>\n    );\n};\n\nexport default Dashboard;","size_bytes":32577},"components/admin/ChatbotSettings.tsx":{"content":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport type { ChatbotSettings, ApiKeyStats } from '../../types';\nimport { getChatbotSettings, saveChatbotSettings } from '../../services/userDataService';\nimport { Save, PlusCircle, Trash2 } from 'lucide-react';\n\nconst Card: React.FC<{children: React.ReactNode, className?: string}> = ({ children, className = '' }) => (\n    <div className={`bg-brand-surface/30 backdrop-blur-xl border border-white/10 rounded-2xl shadow-lg ${className}`}>\n        {children}\n    </div>\n);\n\nconst ChatbotSettings: React.FC = () => {\n    const [settings, setSettings] = useState<ChatbotSettings | null>(null);\n    const [newApiKey, setNewApiKey] = useState('');\n    const [saveStatus, setSaveStatus] = useState('');\n    const [isLoading, setIsLoading] = useState(true);\n\n    const loadSettings = useCallback(async () => {\n        setIsLoading(true);\n        const data = await getChatbotSettings();\n        setSettings(data);\n        setIsLoading(false);\n    }, []);\n\n    useEffect(() => {\n        loadSettings();\n    }, [loadSettings]);\n\n    const handleSave = async () => {\n        if (settings) {\n            await saveChatbotSettings(settings);\n            setSaveStatus('Settings saved successfully!');\n            setTimeout(() => setSaveStatus(''), 3000);\n        }\n    };\n    \n    const handleAddKey = () => {\n        if (newApiKey.trim() && settings) {\n            if (settings.apiKeys.some(k => k.key === newApiKey.trim())) {\n                alert(\"This API key already exists.\");\n                return;\n            }\n            const newKeyStat: ApiKeyStats = {\n                key: newApiKey.trim(),\n                status: 'active',\n                usageCount: 0,\n                lastUsed: null\n            };\n            setSettings({ ...settings, apiKeys: [...settings.apiKeys, newKeyStat] });\n            setNewApiKey('');\n        }\n    };\n    \n    const handleDeleteKey = (keyToDelete: string) => {\n        if (settings) {\n            setSettings({ ...settings, apiKeys: settings.apiKeys.filter(k => k.key !== keyToDelete) });\n        }\n    };\n\n    if (isLoading || !settings) {\n        return <div className=\"flex items-center justify-center h-64\"><div className=\"w-12 h-12 border-4 border-brand-primary border-t-transparent rounded-full animate-spin\"></div></div>;\n    }\n    \n    const StatusIndicator: React.FC<{status: ApiKeyStats['status']}> = ({ status }) => {\n        const color = {\n            active: 'bg-green-500',\n            failed: 'bg-red-500',\n            'rate-limited': 'bg-yellow-500'\n        }[status];\n        return <div className={`w-3 h-3 rounded-full ${color}`} title={status}/>\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold\">Chatbot Settings</h1>\n\n            <Card className=\"p-6 space-y-4\">\n                <h2 className=\"text-xl font-bold\">AI Personality</h2>\n                <p className=\"text-sm text-brand-text-secondary\">This instruction defines the chatbot's persona and behavior. The AI will strictly follow these guidelines.</p>\n                <textarea \n                    value={settings.personality}\n                    onChange={(e) => setSettings({ ...settings, personality: e.target.value })}\n                    rows={6}\n                    className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20 font-mono text-sm\"\n                />\n            </Card>\n\n            <Card className=\"p-6 space-y-4\">\n                <h2 className=\"text-xl font-bold\">Chat Icon Text</h2>\n                 <p className=\"text-sm text-brand-text-secondary\">The text displayed below the floating chat icon.</p>\n                <input\n                    type=\"text\"\n                    value={settings.iconText}\n                    onChange={(e) => setSettings({ ...settings, iconText: e.target.value })}\n                    className=\"w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"\n                />\n            </Card>\n\n            <Card className=\"p-6 space-y-4\">\n                <h2 className=\"text-xl font-bold\">Cerebras API Keys</h2>\n                <p className=\"text-sm text-brand-text-secondary\">The system automatically rotates keys for each request and skips failed keys.</p>\n                <div className=\"flex gap-2\">\n                    <input \n                        type=\"text\"\n                        value={newApiKey}\n                        onChange={(e) => setNewApiKey(e.target.value)}\n                        placeholder=\"Enter new Cerebras API key (csk-...)\"\n                        className=\"flex-grow w-full mt-1 p-2 bg-brand-bg rounded border border-white/20\"\n                    />\n                    <button onClick={handleAddKey} className=\"px-4 py-2 bg-brand-primary text-brand-bg font-bold rounded-lg flex items-center gap-2\"><PlusCircle size={16}/> Add Key</button>\n                </div>\n                \n                <div className=\"max-h-72 overflow-y-auto pr-2\">\n                    <table className=\"w-full text-left text-sm\">\n                        <thead>\n                            <tr className=\"border-b border-white/20\">\n                                <th className=\"p-2\">Status</th>\n                                <th className=\"p-2\">Key (Partial)</th>\n                                <th className=\"p-2 text-center\">Usage</th>\n                                <th className=\"p-2\">Last Used</th>\n                                <th className=\"p-2 text-right\">Action</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            {settings.apiKeys.map(apiKey => (\n                                <tr key={apiKey.key} className=\"border-b border-white/10 last:border-0 font-mono\">\n                                    <td className=\"p-2\"><div className=\"flex justify-center\"><StatusIndicator status={apiKey.status} /></div></td>\n                                    <td className=\"p-2\">{`${apiKey.key.substring(0, 7)}...${apiKey.key.slice(-4)}`}</td>\n                                    <td className=\"p-2 text-center\">{apiKey.usageCount}</td>\n                                    <td className=\"p-2\">{apiKey.lastUsed ? new Date(apiKey.lastUsed).toLocaleString() : 'Never'}</td>\n                                    <td className=\"p-2 text-right\">\n                                        <button onClick={() => handleDeleteKey(apiKey.key)} className=\"p-1 text-red-400 hover:text-red-300\"><Trash2 size={16} /></button>\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            </Card>\n            \n            <div className=\"flex items-center gap-4\">\n                <button onClick={handleSave} className=\"px-6 py-3 bg-brand-primary text-brand-bg font-bold rounded-lg flex items-center gap-2 transition-transform hover:scale-105\">\n                    <Save size={18}/> Save All Settings\n                </button>\n                <AnimatePresence>\n                {saveStatus && (\n                    <motion.p initial={{opacity: 0}} animate={{opacity: 1}} exit={{opacity: 0}} className=\"text-green-400\">{saveStatus}</motion.p>\n                )}\n                </AnimatePresence>\n            </div>\n        </div>\n    );\n};\n\nexport default ChatbotSettings;\n","size_bytes":7459},"components/three/FloatingCoins.tsx":{"content":"import React, { useRef, useMemo, Suspense } from 'react';\nimport { Canvas, useFrame } from '@react-three/fiber';\nimport { Float, Billboard, Text } from '@react-three/drei';\nimport * as THREE from 'three';\n\nconst COIN_DATA = [\n  { symbol: 'BTC', color: '#F7931A', texture: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/btc.svg' },\n  { symbol: 'ETH', color: '#627EEA', texture: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/eth.svg' },\n  { symbol: 'USDT', color: '#26A17B', texture: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/usdt.svg' },\n  { symbol: 'SOL', color: '#9945FF', texture: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/sol.svg' },\n];\n\n// FIX: Define a props interface for the Coin component to resolve typing issues.\ninterface CoinProps {\n  position: [number, number, number];\n  textureUrl: string;\n  color: string;\n}\n\n// FIX: Converted the Coin component to a React.FC to correctly type its props,\n// allowing it to accept the 'key' prop required for list rendering without type errors.\nconst Coin: React.FC<CoinProps> = ({ position, textureUrl, color }) => {\n  const meshRef = useRef<THREE.Mesh>(null!);\n  const texture = useMemo(() => new THREE.TextureLoader().load(textureUrl), [textureUrl]);\n\n  return (\n    <Float speed={1.5} rotationIntensity={1} floatIntensity={2}>\n        <mesh position={position} ref={meshRef}>\n            <cylinderGeometry args={[0.5, 0.5, 0.1, 64]} />\n            {/* Side material */}\n            <meshStandardMaterial color={color} roughness={0.5} metalness={0.8} />\n             {/* Front face */}\n            <meshStandardMaterial map={texture} attach=\"material-1\" roughness={0.5} metalness={0.5} />\n            {/* Back face */}\n            <meshStandardMaterial map={texture} attach=\"material-2\" roughness={0.5} metalness={0.5} />\n        </mesh>\n    </Float>\n  );\n};\n\nfunction Particles({ count = 200 }) {\n    const mesh = useRef<THREE.InstancedMesh>(null!);\n    const dummy = useMemo(() => new THREE.Object3D(), []);\n  \n    const particles = useMemo(() => {\n      const temp = [];\n      for (let i = 0; i < count; i++) {\n        const t = Math.random() * 100;\n        const factor = 20 + Math.random() * 100;\n        const speed = 0.01 + Math.random() / 200;\n        const x = (Math.random() - 0.5) * 30;\n        const y = (Math.random() - 0.5) * 30;\n        const z = (Math.random() - 0.5) * 30;\n        temp.push({ t, factor, speed, x, y, z });\n      }\n      return temp;\n    }, [count]);\n  \n    useFrame(() => {\n      if (!mesh.current) return;\n      particles.forEach((particle, i) => {\n        let { factor, speed, x, y, z } = particle;\n        particle.t += speed;\n        dummy.position.set(\n          x + Math.cos((particle.t / 10) * factor) + (Math.sin(particle.t * 1) * factor) / 10,\n          y + Math.sin((particle.t / 10) * factor) + (Math.cos(particle.t * 2) * factor) / 10,\n          z + Math.cos((particle.t / 10) * factor) + (Math.sin(particle.t * 3) * factor) / 10\n        );\n        const s = Math.cos(particle.t) * 0.1 + 0.1;\n        dummy.scale.set(s,s,s);\n        dummy.updateMatrix();\n        mesh.current.setMatrixAt(i, dummy.matrix);\n      });\n      mesh.current.instanceMatrix.needsUpdate = true;\n    });\n  \n    return (\n      <instancedMesh ref={mesh} args={[undefined, undefined, count]}>\n        <sphereGeometry args={[0.1]} />\n        <meshStandardMaterial color=\"#00f5ff\" emissive=\"#00f5ff\" emissiveIntensity={2} />\n      </instancedMesh>\n    );\n  }\n\nconst FloatingCoins = () => {\n  const coinPositions = useMemo(() => Array.from({ length: 12 }, () => [\n    (Math.random() - 0.5) * 15,\n    (Math.random() - 0.5) * 10,\n    (Math.random() - 0.5) * 10 - 5,\n  ] as [number, number, number]), []);\n\n  return (\n    <Canvas camera={{ position: [0, 0, 10], fov: 50 }}>\n      <ambientLight intensity={0.5} />\n      <pointLight position={[10, 10, 10]} intensity={1.5} color=\"#e040fb\" />\n      <pointLight position={[-10, -10, 10]} intensity={2} color=\"#00f5ff\" />\n      <Suspense fallback={null}>\n        {coinPositions.map((pos, i) => {\n          const coinData = COIN_DATA[i % COIN_DATA.length];\n          return <Coin key={i} position={pos} textureUrl={coinData.texture} color={coinData.color} />;\n        })}\n        <Particles />\n      </Suspense>\n    </Canvas>\n  );\n};\n\nexport default FloatingCoins;\n","size_bytes":4363},"components/dashboard/DepositPage.tsx":{"content":"import React, { useState, useMemo, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { UserData, WalletConfig } from '../../types';\nimport DashboardPageLayout, { InteractiveCard } from './DashboardPageLayout';\nimport { ArrowDownToLine, Copy } from 'lucide-react';\nimport { getWalletConfig } from '../../services/userDataService';\n\nconst CRYPTO_LOGOS: { [key: string]: string } = {\n    BTC: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/btc.svg',\n    ETH: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/eth.svg',\n    USDT: 'https://cdn.jsdelivr.net/gh/spothq/cryptocurrency-icons/svg/color/usdt.svg'\n};\n\nconst formatCurrency = (value: number) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n\nconst DepositPage: React.FC<{ userData: UserData; showToast: (msg: string, type?: 'success' | 'error') => void; onUpdate: () => void; }> = ({ userData, showToast }) => {\n    const [walletConfig, setWalletConfig] = useState<WalletConfig | null>(null);\n    const [selectedCrypto, setSelectedCrypto] = useState<string>('');\n    const detailsRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        const fetchConfig = async () => {\n            const config = await getWalletConfig();\n            setWalletConfig(config);\n            if (Object.keys(config).length > 0) {\n                // Don't auto-select to let user choose\n            }\n        };\n        fetchConfig();\n    }, []);\n\n    useEffect(() => {\n        if (selectedCrypto && detailsRef.current) {\n            const timer = setTimeout(() => {\n                detailsRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            }, 100); // Short delay to allow element to render before scrolling\n            return () => clearTimeout(timer);\n        }\n    }, [selectedCrypto]);\n\n\n    const handleCopy = (address: string) => {\n        navigator.clipboard.writeText(address);\n        showToast('Address Copied!');\n    };\n\n    const deposits = useMemo(() => userData.transactions.filter(t => t.type === 'Deposit'), [userData.transactions]);\n\n    if (!walletConfig) {\n        return (\n            <DashboardPageLayout title=\"Deposit\" icon={<ArrowDownToLine size={28} />}>\n                <div className=\"flex items-center justify-center h-full pt-20\">\n                    <div className=\"w-8 h-8 border-2 border-brand-primary border-t-transparent rounded-full animate-spin\"></div>\n                </div>\n            </DashboardPageLayout>\n        );\n    }\n\n    const selectedWallet = walletConfig[selectedCrypto];\n\n    return (\n        <DashboardPageLayout title=\"Deposit\" icon={<ArrowDownToLine size={28} />}>\n            <InteractiveCard className=\"p-6 flex flex-col sm:flex-row justify-between items-start sm:items-center\">\n                 <div>\n                    <p className=\"text-brand-text-secondary\">Current Balance</p>\n                    <p className=\"text-3xl font-bold font-mono text-white\">{formatCurrency(userData.balance)}</p>\n                </div>\n            </InteractiveCard>\n\n            <h3 className=\"text-xl font-bold text-white mt-4\">Select Crypto to Deposit</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                {Object.keys(walletConfig).map(key => {\n                    const crypto = walletConfig[key];\n                    return (\n                        <motion.div \n                            key={key} \n                            onClick={() => setSelectedCrypto(key)} \n                            whileHover={{ y: -8, scale: 1.03 }} \n                            className={`cursor-pointer bg-brand-surface/30 backdrop-blur-lg border-2 rounded-2xl p-4 transition-all duration-300 relative overflow-hidden ${selectedCrypto === key ? 'border-brand-primary' : 'border-white/10'}`}\n                        >\n                             {selectedCrypto === key && (\n                                <motion.div \n                                    layoutId=\"deposit-glow\" \n                                    className=\"absolute inset-0 bg-brand-primary/20 -z-10 shadow-[0_0_20px_theme(colors.brand.primary)]\"\n                                    transition={{type: 'spring', stiffness: 300, damping: 25}}\n                                />\n                             )}\n                            <div className=\"flex items-center gap-3 mb-3\">\n                                <img src={CRYPTO_LOGOS[key]} alt={key} className=\"w-10 h-10\"/>\n                                <span className=\"text-xl font-bold text-white\">{crypto.name}</span>\n                            </div>\n                            <p className=\"text-sm text-brand-text-secondary\">Network: {crypto.network}</p>\n                        </motion.div>\n                    )\n                })}\n            </div>\n\n            <AnimatePresence>\n            {selectedWallet && (\n                <motion.div \n                    ref={detailsRef}\n                    initial={{ opacity: 0, y: 20 }} \n                    animate={{ opacity: 1, y: 0 }} \n                    exit={{ opacity: 0, y: 20 }} \n                    className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-2\"\n                >\n                   <InteractiveCard className=\"p-6 shadow-[0_0_25px_rgba(0,245,255,0.15)] border-brand-primary/30\">\n                        <h3 className=\"font-bold text-white text-lg mb-4\">Deposit {selectedWallet.name}</h3>\n                        <p className=\"text-brand-text-secondary text-sm mb-2\">Only send {selectedWallet.name} ({selectedWallet.symbol}) to this address.</p>\n                        <div className=\"flex items-center bg-brand-bg border border-white/20 rounded-lg p-2\">\n                            <input type=\"text\" readOnly value={selectedWallet.address} className=\"w-full bg-transparent outline-none p-2 text-brand-text-secondary font-mono text-sm\" />\n                            <button onClick={() => handleCopy(selectedWallet.address)} className=\"p-2 text-white hover:text-brand-primary transition-colors\"><Copy /></button>\n                        </div>\n                        <div className=\"mt-4 p-4 bg-yellow-500/10 border border-yellow-400/50 rounded-lg text-yellow-300 text-xs\">\n                            Any amount sent will be automatically converted to USD upon confirmation.\n                        </div>\n                   </InteractiveCard>\n                   <InteractiveCard className=\"p-6 shadow-[0_0_25px_rgba(0,245,255,0.15)] border-brand-primary/30\">\n                       <h3 className=\"font-bold text-white text-lg mb-4\">Important Instructions</h3>\n                       <ul className=\"list-disc list-inside space-y-2 text-brand-text-secondary text-sm\">\n                           <li>Ensure you select the correct network ({selectedWallet.network}).</li>\n                           <li>Do not send any other assets to this address.</li>\n                           <li>Deposits are typically confirmed within 5-30 minutes.</li>\n                       </ul>\n                   </InteractiveCard>\n                </motion.div>\n            )}\n            </AnimatePresence>\n\n            {deposits.length > 0 && (\n                <div className=\"mt-8\">\n                    <h3 className=\"text-xl font-bold text-white mb-4\">Deposit History</h3>\n                    <InteractiveCard className=\"p-4 overflow-x-auto\">\n                        <table className=\"w-full min-w-[600px] text-left\">\n                            <thead>\n                                <tr className=\"border-b border-white/20\">\n                                    <th className=\"p-3 text-brand-text-secondary\">Date</th>\n                                    <th className=\"p-3 text-brand-text-secondary\">Asset</th>\n                                    <th className=\"p-3 text-brand-text-secondary\">Amount (USD)</th>\n                                    <th className=\"p-3 text-brand-text-secondary\">Status</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {deposits.map(deposit => (\n                                    <tr key={deposit.id} className=\"border-b border-white/10 last:border-b-0\">\n                                        <td className=\"p-3 text-brand-text\">{new Date(deposit.date).toLocaleString()}</td>\n                                        <td className=\"p-3 text-brand-text\">{deposit.asset}</td>\n                                        <td className=\"p-3 text-white font-mono\">{formatCurrency(deposit.usdValue || deposit.amount)}</td>\n                                        <td className=\"p-3\">\n                                            <span className={`px-2 py-1 text-xs rounded-full ${\n                                                deposit.status === 'Confirmed' ? 'bg-green-500/20 text-green-400' :\n                                                deposit.status === 'Pending' ? 'bg-yellow-500/20 text-yellow-400' :\n                                                'bg-red-500/20 text-red-400'\n                                            }`}>\n                                                {deposit.status}\n                                            </span>\n                                        </td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    </InteractiveCard>\n                </div>\n            )}\n        </DashboardPageLayout>\n    );\n};\n\nexport default DepositPage;","size_bytes":9584},"components/AuthModal.tsx":{"content":"","size_bytes":0},"components/three/HeroAnimation.tsx":{"content":"","size_bytes":0},"server.js":{"content":"import express from 'express';\nimport cors from 'cors';\nimport nodemailer from 'nodemailer';\nimport { promises as fs } from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst app = express();\nconst PORT = process.env.PORT || 3000;\n\napp.use(cors());\napp.use(express.json({ limit: '200mb' }));\napp.use(express.urlencoded({ limit: '200mb', extended: true }));\n\napp.use((req, res, next) => {\n  req.setTimeout(600000);\n  res.setTimeout(600000);\n  next();\n});\n\nconst STORAGE_DIR = path.join(__dirname, 'storage');\nconst USERS_FILE = path.join(STORAGE_DIR, 'users.json');\nconst SETTINGS_FILE = path.join(STORAGE_DIR, 'settings.json');\nconst MESSAGES_FILE = path.join(STORAGE_DIR, 'messages.json');\nconst REVIEWS_FILE = path.join(STORAGE_DIR, 'reviews.json');\nconst PROFITS_FILE = path.join(STORAGE_DIR, 'profits.json');\nconst ACTIVITY_LOG_FILE = path.join(STORAGE_DIR, 'activity.log');\n\nconst ensureStorageExists = async () => {\n  try {\n    await fs.access(STORAGE_DIR);\n  } catch {\n    await fs.mkdir(STORAGE_DIR, { recursive: true });\n    await fs.mkdir(path.join(STORAGE_DIR, 'inbox_media'), { recursive: true });\n    await fs.mkdir(path.join(STORAGE_DIR, 'media'), { recursive: true });\n    await fs.mkdir(path.join(STORAGE_DIR, 'media', 'welcome_page'), { recursive: true });\n    await fs.mkdir(path.join(STORAGE_DIR, 'media', 'welcome_inbox'), { recursive: true });\n  }\n};\n\nconst readJSONFile = async (filePath, defaultValue = []) => {\n  try {\n    const data = await fs.readFile(filePath, 'utf-8');\n    return JSON.parse(data);\n  } catch (error) {\n    if (error.code === 'ENOENT') {\n      await writeJSONFile(filePath, defaultValue);\n      return defaultValue;\n    }\n    throw error;\n  }\n};\n\nconst writeJSONFile = async (filePath, data) => {\n  await fs.writeFile(filePath, JSON.stringify(data), 'utf-8');\n};\n\n// Serve static files from dist directory\napp.use(express.static(path.join(__dirname, 'dist')));\n\napp.get('/api/storage/users', async (req, res) => {\n  try {\n    const users = await readJSONFile(USERS_FILE, []);\n    res.json({ success: true, data: users });\n  } catch (error) {\n    console.error('Error reading users:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.get('/api/storage/users/:userId', async (req, res) => {\n  try {\n    const users = await readJSONFile(USERS_FILE, []);\n    const user = users.find(u => u.id === req.params.userId);\n    if (user) {\n      res.json({ success: true, data: user });\n    } else {\n      res.status(404).json({ success: false, message: 'User not found' });\n    }\n  } catch (error) {\n    console.error('Error reading user:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.post('/api/storage/users/:userId', async (req, res) => {\n  try {\n    const users = await readJSONFile(USERS_FILE, []);\n    const userIndex = users.findIndex(u => u.id === req.params.userId);\n    \n    if (userIndex >= 0) {\n      users[userIndex] = req.body;\n    } else {\n      users.push(req.body);\n    }\n    \n    await writeJSONFile(USERS_FILE, users);\n    res.json({ success: true, data: req.body });\n  } catch (error) {\n    console.error('Error saving user:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.delete('/api/storage/users/:userId', async (req, res) => {\n  try {\n    const users = await readJSONFile(USERS_FILE, []);\n    const filteredUsers = users.filter(u => u.id !== req.params.userId);\n    await writeJSONFile(USERS_FILE, filteredUsers);\n    res.json({ success: true, message: 'User deleted' });\n  } catch (error) {\n    console.error('Error deleting user:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.get('/api/storage/settings', async (req, res) => {\n  try {\n    const defaultSettings = {\n      systemSettings: {\n        recaptchaEnabled: false,\n        recaptchaSiteKey: \"\",\n        recaptchaSecretKey: \"\"\n      },\n      walletConfig: {},\n      welcomePageTemplate: {},\n      welcomeInboxTemplate: {},\n      chatbotSettings: {},\n      testimonials: []\n    };\n    const settings = await readJSONFile(SETTINGS_FILE, defaultSettings);\n    res.json({ success: true, data: settings });\n  } catch (error) {\n    console.error('Error reading settings:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.post('/api/storage/settings', async (req, res) => {\n  try {\n    await writeJSONFile(SETTINGS_FILE, req.body);\n    res.json({ success: true, data: req.body });\n  } catch (error) {\n    console.error('Error saving settings:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.get('/api/storage/messages', async (req, res) => {\n  try {\n    const messages = await readJSONFile(MESSAGES_FILE, []);\n    res.json({ success: true, data: messages });\n  } catch (error) {\n    console.error('Error reading messages:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.post('/api/storage/messages', async (req, res) => {\n  try {\n    await writeJSONFile(MESSAGES_FILE, req.body);\n    res.json({ success: true, data: req.body });\n  } catch (error) {\n    console.error('Error saving messages:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.get('/api/storage/reviews', async (req, res) => {\n  try {\n    const reviews = await readJSONFile(REVIEWS_FILE, []);\n    res.json({ success: true, data: reviews });\n  } catch (error) {\n    console.error('Error reading reviews:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.post('/api/storage/reviews', async (req, res) => {\n  try {\n    await writeJSONFile(REVIEWS_FILE, req.body);\n    res.json({ success: true, data: req.body });\n  } catch (error) {\n    console.error('Error saving reviews:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.get('/api/storage/profits', async (req, res) => {\n  try {\n    const profits = await readJSONFile(PROFITS_FILE, []);\n    res.json({ success: true, data: profits });\n  } catch (error) {\n    console.error('Error reading profits:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.post('/api/storage/profits', async (req, res) => {\n  try {\n    await writeJSONFile(PROFITS_FILE, req.body);\n    res.json({ success: true, data: req.body });\n  } catch (error) {\n    console.error('Error saving profits:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.post('/api/storage/activity-log', async (req, res) => {\n  try {\n    const logs = await readJSONFile(ACTIVITY_LOG_FILE, []);\n    const newLog = {\n      timestamp: new Date().toISOString(),\n      ...req.body\n    };\n    logs.push(newLog);\n    await writeJSONFile(ACTIVITY_LOG_FILE, logs);\n    res.json({ success: true, data: newLog });\n  } catch (error) {\n    console.error('Error adding activity log:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.post('/api/storage/upload-media', async (req, res) => {\n  try {\n    const { type, mediaType, data } = req.body;\n    \n    if (!type || !mediaType || !data) {\n      return res.status(400).json({ \n        success: false, \n        message: 'Missing required fields: type, mediaType, data' \n      });\n    }\n\n    if (!['welcome_page', 'welcome_inbox'].includes(type)) {\n      return res.status(400).json({ \n        success: false, \n        message: 'Invalid type. Must be welcome_page or welcome_inbox' \n      });\n    }\n\n    if (!['image', 'video'].includes(mediaType)) {\n      return res.status(400).json({ \n        success: false, \n        message: 'Invalid mediaType. Must be image or video' \n      });\n    }\n\n    const base64Match = data.match(/^data:([a-zA-Z0-9]+\\/[a-zA-Z0-9-.+]+);base64,(.*)$/);\n    if (!base64Match) {\n      return res.status(400).json({ \n        success: false, \n        message: 'Invalid base64 data format' \n      });\n    }\n\n    const mimeType = base64Match[1];\n    const base64Data = base64Match[2];\n    const buffer = Buffer.from(base64Data, 'base64');\n    \n    const maxSizeMB = 100;\n    const sizeMB = buffer.length / 1024 / 1024;\n    if (sizeMB > maxSizeMB) {\n      return res.status(400).json({ \n        success: false, \n        message: `File too large. Maximum size is ${maxSizeMB}MB. Your file is ${sizeMB.toFixed(1)}MB.` \n      });\n    }\n    \n    const extension = mimeType.split('/')[1].split('+')[0];\n    const filename = `${mediaType}_${Date.now()}.${extension}`;\n    const mediaDir = path.join(STORAGE_DIR, 'media', type);\n    const filePath = path.join(mediaDir, filename);\n    \n    await fs.writeFile(filePath, buffer);\n    \n    console.log(`✅ Media file saved: ${filename} (${sizeMB.toFixed(2)}MB)`);\n    \n    try {\n      const files = await fs.readdir(mediaDir);\n      const oldFiles = files.filter(f => f.startsWith(`${mediaType}_`) && f !== filename);\n      \n      for (const oldFile of oldFiles) {\n        try {\n          await fs.unlink(path.join(mediaDir, oldFile));\n          console.log(`🗑️  Deleted old media: ${oldFile}`);\n        } catch (err) {\n          console.error(`Failed to delete old media ${oldFile}:`, err);\n        }\n      }\n    } catch (err) {\n      console.log('No old files to clean up');\n    }\n    \n    const fileUrl = `/api/storage/media/${type}/${filename}`;\n    res.json({ success: true, url: fileUrl, filename });\n  } catch (error) {\n    console.error('Error uploading media:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\napp.get('/api/storage/media/:type/:filename', async (req, res) => {\n  try {\n    const { type, filename } = req.params;\n    \n    if (!['welcome_page', 'welcome_inbox'].includes(type)) {\n      return res.status(400).json({ \n        success: false, \n        message: 'Invalid type' \n      });\n    }\n\n    if (!filename || filename.includes('..') || filename.includes('/') || filename.includes('\\\\')) {\n      return res.status(400).json({ \n        success: false, \n        message: 'Invalid filename' \n      });\n    }\n\n    const mediaDir = path.join(STORAGE_DIR, 'media', type);\n    const filePath = path.join(mediaDir, filename);\n    const resolvedPath = path.resolve(filePath);\n    const resolvedMediaDir = path.resolve(mediaDir);\n    \n    if (!resolvedPath.startsWith(resolvedMediaDir)) {\n      return res.status(403).json({ \n        success: false, \n        message: 'Access denied' \n      });\n    }\n    \n    try {\n      await fs.access(filePath);\n      res.sendFile(filePath);\n    } catch {\n      res.status(404).json({ success: false, message: 'File not found' });\n    }\n  } catch (error) {\n    console.error('Error serving media:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\nconst createTransporter = () => {\n  const emailUser = process.env.EMAIL_USER;\n  const emailPass = process.env.EMAIL_APP_PASSWORD;\n\n  if (!emailUser || !emailPass) {\n    console.error('⚠️ EMAIL_USER and EMAIL_APP_PASSWORD environment variables must be set!');\n    return null;\n  }\n\n  return nodemailer.createTransport({\n    service: 'gmail',\n    auth: {\n      user: emailUser,\n      pass: emailPass,\n    },\n  });\n};\n\nconst createVerificationEmailHTML = (code) => {\n  return `\n  <!DOCTYPE html>\n  <html lang=\"en\">\n  <head>\n      <meta charset=\"UTF-8\">\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n      <title>Your TradePilot AI Verification Code</title>\n      <style>\n          body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; background-color: #0a0a1a; color: #e0e0e0; }\n          .container { max-width: 600px; margin: 40px auto; background-color: #1a1a2e; border-radius: 16px; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.1); }\n          .header { padding: 40px; text-align: center; background: linear-gradient(45deg, #00f5ff, #e040fb); color: #0a0a1a; }\n          .header-logo { width: 60px; height: 60px; margin-bottom: 20px; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.3)); }\n          .header h1 { margin: 0; font-size: 28px; font-weight: 700; }\n          .content { padding: 40px; }\n          .content p { font-size: 16px; line-height: 1.6; margin: 0 0 20px; }\n          .code-container { text-align: center; margin: 30px 0; }\n          .code { font-size: 48px; font-weight: 700; letter-spacing: 12px; color: #00f5ff; background-color: #0a0a1a; padding: 15px 30px; border-radius: 8px; border: 1px dashed #00f5ff; display: inline-block; }\n          .expiry-note { font-size: 14px; color: #a0a0b0; text-align: center; }\n          .footer { padding: 20px; text-align: center; font-size: 12px; color: #a0a0b0; border-top: 1px solid rgba(255, 255, 255, 0.1); }\n          .footer a { color: #00f5ff; text-decoration: none; }\n      </style>\n      <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n      <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n      <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap\" rel=\"stylesheet\">\n  </head>\n  <body>\n      <div class=\"container\">\n          <div class=\"header\">\n               <img src=\"https://i.imgur.com/uN19t3y.png\" alt=\"TradePilot AI Logo\" class=\"header-logo\">\n              <h1>Welcome to TradePilot AI</h1>\n          </div>\n          <div class=\"content\">\n              <p>Your crypto automation hub awaits. Please use the verification code below to complete your registration.</p>\n              <div class=\"code-container\">\n                  <span class=\"code\">${code}</span>\n              </div>\n              <p class=\"expiry-note\">This code will expire in 5 minutes.</p>\n          </div>\n          <div class=\"footer\">\n              <p>&copy; ${new Date().getFullYear()} TradePilot AI. All Rights Reserved.<br>\n              If you have any questions, contact our support team at <a href=\"mailto:support@tradepilot.ai\">support@tradepilot.ai</a></p>\n          </div>\n      </div>\n  </body>\n  </html>\n  `;\n};\n\napp.post('/api/send-verification-email', async (req, res) => {\n  try {\n    const { email, code } = req.body;\n\n    if (!email || !code) {\n      return res.status(400).json({ success: false, message: 'Email and code are required' });\n    }\n\n    const transporter = createTransporter();\n    \n    if (!transporter) {\n      return res.status(500).json({ \n        success: false, \n        message: 'Email service not configured. Please set EMAIL_USER and EMAIL_APP_PASSWORD environment variables.' \n      });\n    }\n\n    const mailOptions = {\n      from: `TradePilot AI <${process.env.EMAIL_USER}>`,\n      to: email,\n      subject: 'Your TradePilot AI Verification Code',\n      html: createVerificationEmailHTML(code),\n    };\n\n    await transporter.sendMail(mailOptions);\n    console.log(`✅ Verification email sent to: ${email}`);\n    \n    res.json({ success: true, message: 'Verification email sent successfully' });\n  } catch (error) {\n    console.error('❌ Error sending email:', error);\n    res.status(500).json({ \n      success: false, \n      message: 'Failed to send verification email',\n      error: error.message \n    });\n  }\n});\n\napp.get('/api/health', (req, res) => {\n  const hasCredentials = !!(process.env.EMAIL_USER && process.env.EMAIL_APP_PASSWORD);\n  res.json({ \n    status: 'ok', \n    emailConfigured: hasCredentials,\n    message: hasCredentials \n      ? 'Email service is configured and ready' \n      : 'Email service needs EMAIL_USER and EMAIL_APP_PASSWORD to be set'\n  });\n});\n\n// Catch-all route to serve index.html for client-side routing\napp.get('*', (req, res) => {\n  res.sendFile(path.join(__dirname, 'dist', 'index.html'));\n});\n\nensureStorageExists().then(() => {\n  app.listen(PORT, '0.0.0.0', () => {\n    console.log(`🚀 Backend server running on port ${PORT}`);\n    console.log(`💾 File storage: ${STORAGE_DIR}`);\n    console.log(`📧 Email service: ${process.env.EMAIL_USER ? 'Configured ✅' : 'Not configured ⚠️'}`);\n  });\n}).catch(error => {\n  console.error('Failed to initialize storage:', error);\n  process.exit(1);\n});\n","size_bytes":16194},"components/auth/ReCaptcha.tsx":{"content":"import React, { useEffect, useRef, useCallback } from 'react';\n\ndeclare global {\n  interface Window {\n    grecaptcha: any;\n    recaptchaOnLoad?: () => void;\n  }\n}\n\ninterface ReCaptchaProps {\n  siteKey: string;\n  onVerify: (token: string) => void;\n  onExpired?: () => void;\n}\n\nconst ReCaptcha: React.FC<ReCaptchaProps> = ({ siteKey, onVerify, onExpired }) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const widgetIdRef = useRef<number | null>(null);\n  const [isLoading, setIsLoading] = React.useState(true);\n  const [error, setError] = React.useState<string | null>(null);\n\n  const renderRecaptcha = useCallback(() => {\n    if (!containerRef.current || !window.grecaptcha || !window.grecaptcha.render) {\n      console.log('ReCAPTCHA: Waiting for grecaptcha to load...');\n      return;\n    }\n\n    if (containerRef.current) {\n      containerRef.current.innerHTML = '';\n    }\n\n    try {\n      console.log('ReCAPTCHA: Rendering widget with siteKey:', siteKey?.substring(0, 10) + '...');\n      widgetIdRef.current = window.grecaptcha.render(containerRef.current, {\n        sitekey: siteKey,\n        callback: (token: string) => {\n          console.log('ReCAPTCHA: Verification successful');\n          onVerify(token);\n        },\n        'expired-callback': () => {\n          console.log('ReCAPTCHA: Token expired');\n          if (onExpired) onExpired();\n        },\n        theme: 'dark',\n      });\n      setIsLoading(false);\n      setError(null);\n      console.log('ReCAPTCHA: Widget rendered successfully, ID:', widgetIdRef.current);\n    } catch (error) {\n      console.error('ReCAPTCHA: Render error:', error);\n      setError('Failed to load reCAPTCHA. Please refresh the page.');\n      setIsLoading(false);\n    }\n  }, [siteKey, onVerify, onExpired]);\n\n  useEffect(() => {\n    if (!siteKey) {\n      console.log('ReCAPTCHA: No site key provided');\n      setError('reCAPTCHA site key is missing');\n      setIsLoading(false);\n      return;\n    }\n\n    console.log('ReCAPTCHA: Initializing with site key:', siteKey?.substring(0, 10) + '...');\n    \n    // Check if script already exists to prevent duplicates\n    const existingScript = document.querySelector('script[src*=\"google.com/recaptcha/api.js\"]');\n    \n    if (!window.grecaptcha && !existingScript) {\n      console.log('ReCAPTCHA: Loading script...');\n      const script = document.createElement('script');\n      script.src = 'https://www.google.com/recaptcha/api.js?onload=recaptchaOnLoad&render=explicit';\n      script.async = true;\n      script.defer = true;\n      \n      window.recaptchaOnLoad = () => {\n        console.log('ReCAPTCHA: Script loaded, rendering widget...');\n        setTimeout(() => renderRecaptcha(), 100);\n      };\n      \n      script.onerror = () => {\n        console.error('ReCAPTCHA: Failed to load script');\n        setError('Failed to load reCAPTCHA script');\n        setIsLoading(false);\n      };\n      \n      document.head.appendChild(script);\n    } else if (window.grecaptcha?.render) {\n      console.log('ReCAPTCHA: Script already loaded, rendering widget...');\n      setTimeout(() => renderRecaptcha(), 100);\n    } else {\n      console.log('ReCAPTCHA: grecaptcha exists but render not ready, waiting...');\n      let checkInterval: NodeJS.Timeout | null = null;\n      let timeoutId: NodeJS.Timeout | null = null;\n      \n      checkInterval = setInterval(() => {\n        if (window.grecaptcha?.render) {\n          if (checkInterval) clearInterval(checkInterval);\n          renderRecaptcha();\n        }\n      }, 100);\n      \n      timeoutId = setTimeout(() => {\n        if (checkInterval) clearInterval(checkInterval);\n        if (!window.grecaptcha?.render) {\n          setError('reCAPTCHA failed to initialize');\n          setIsLoading(false);\n        }\n      }, 10000);\n      \n      return () => {\n        if (checkInterval) clearInterval(checkInterval);\n        if (timeoutId) clearTimeout(timeoutId);\n      };\n    }\n\n    return () => {\n      // Cleanup: Only reset if widget exists and API is available\n      if (widgetIdRef.current !== null && window.grecaptcha?.reset) {\n        try {\n          window.grecaptcha.reset(widgetIdRef.current);\n          console.log('ReCAPTCHA: Widget reset on unmount');\n        } catch (e) {\n          console.log('ReCAPTCHA: Cleanup error (safe to ignore)');\n        }\n      }\n    };\n  }, [siteKey, renderRecaptcha]);\n\n  return (\n    <div className=\"flex flex-col items-center justify-center my-4 min-h-[78px]\">\n      {isLoading && !error && (\n        <div className=\"text-brand-text-secondary text-sm\">\n          Loading reCAPTCHA...\n        </div>\n      )}\n      {error && (\n        <div className=\"text-red-400 text-sm bg-red-900/20 border border-red-500/30 px-4 py-2 rounded\">\n          {error}\n        </div>\n      )}\n      <div ref={containerRef} className={error ? 'hidden' : ''}></div>\n    </div>\n  );\n};\n\nexport default ReCaptcha;\n","size_bytes":4873},"components/FloatingCryptoLogos.tsx":{"content":"import React, { useMemo } from 'react';\nimport { motion } from 'framer-motion';\n\ninterface CryptoLogo {\n  id: string;\n  name: string;\n  logo: string;\n}\n\nconst cryptoLogos: CryptoLogo[] = [\n  { id: 'bitcoin', name: 'Bitcoin', logo: '/crypto-logos/bitcoin.png' },\n  { id: 'ethereum', name: 'Ethereum', logo: '/crypto-logos/ethereum.png' },\n  { id: 'binancecoin', name: 'BNB', logo: '/crypto-logos/binancecoin.png' },\n  { id: 'ripple', name: 'XRP', logo: '/crypto-logos/ripple.png' },\n  { id: 'cardano', name: 'Cardano', logo: '/crypto-logos/cardano.png' },\n];\n\ninterface FloatingLogoProps {\n  crypto: CryptoLogo;\n  index: number;\n}\n\nconst FloatingLogo: React.FC<FloatingLogoProps> = ({ crypto, index }) => {\n  // Pre-calculate random values to avoid using Math.random() in render\n  const animationConfig = useMemo(() => {\n    const seed = index * 123.456; // Use index as seed for consistent randomness\n    \n    // Generate pseudo-random values based on index\n    const x = (Math.sin(seed) * 50 + 50) % 100; // 0-100\n    const y = (Math.cos(seed) * 50 + 50) % 100; // 0-100\n    const duration = 15 + (Math.sin(seed * 2) + 1) * 10; // 15-35 seconds\n    const delay = (Math.cos(seed * 3) + 1) * 3; // 0-6 seconds\n    const scale = 0.5 + (Math.sin(seed * 4) + 1) * 0.3; // 0.5-1.1\n    const opacity = 0.15 + (Math.cos(seed * 5) + 1) * 0.15; // 0.15-0.45\n    \n    return { x, y, duration, delay, scale, opacity };\n  }, [index]);\n\n  return (\n    <motion.div\n      className=\"absolute pointer-events-none\"\n      initial={{\n        x: `${animationConfig.x}vw`,\n        y: `${animationConfig.y}vh`,\n        scale: animationConfig.scale,\n        opacity: 0,\n      }}\n      animate={{\n        x: [\n          `${animationConfig.x}vw`,\n          `${(animationConfig.x + 30) % 100}vw`,\n          `${(animationConfig.x - 20) % 100}vw`,\n          `${animationConfig.x}vw`,\n        ],\n        y: [\n          `${animationConfig.y}vh`,\n          `${(animationConfig.y - 25) % 100}vh`,\n          `${(animationConfig.y + 15) % 100}vh`,\n          `${animationConfig.y}vh`,\n        ],\n        opacity: [0, animationConfig.opacity, animationConfig.opacity, 0],\n        rotate: [0, 360],\n      }}\n      transition={{\n        duration: animationConfig.duration,\n        delay: animationConfig.delay,\n        repeat: Infinity,\n        ease: 'linear',\n      }}\n    >\n      <img\n        src={crypto.logo}\n        alt={crypto.name}\n        className=\"w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 lg:w-24 lg:h-24 object-contain filter blur-[1px]\"\n        loading=\"lazy\"\n      />\n    </motion.div>\n  );\n};\n\nconst FloatingCryptoLogos: React.FC = () => {\n  // Create multiple instances of each logo for better coverage\n  const logoInstances = useMemo(() => {\n    const instances: Array<{ crypto: CryptoLogo; instanceId: number }> = [];\n    \n    // Create 3 instances of each logo\n    cryptoLogos.forEach((crypto, cryptoIndex) => {\n      for (let i = 0; i < 3; i++) {\n        instances.push({\n          crypto,\n          instanceId: cryptoIndex * 3 + i,\n        });\n      }\n    });\n    \n    return instances;\n  }, []);\n\n  return (\n    <div className=\"absolute inset-0 overflow-hidden pointer-events-none z-0\">\n      {logoInstances.map(({ crypto, instanceId }) => (\n        <FloatingLogo\n          key={`${crypto.id}-${instanceId}`}\n          crypto={crypto}\n          index={instanceId}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default FloatingCryptoLogos;\n","size_bytes":3425},"scripts/downloadCryptoLogos.js":{"content":"// Script to download cryptocurrency logos from CoinGecko API\n// This only needs to be run once to cache the logos locally\n\nimport https from 'https';\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst LOGOS_DIR = path.join(__dirname, '..', 'public', 'crypto-logos');\n\n// Popular cryptocurrencies to display\nconst CRYPTO_IDS = [\n  'bitcoin',\n  'ethereum',\n  'binancecoin',\n  'ripple',\n  'cardano',\n  'solana',\n  'polkadot',\n  'dogecoin',\n  'avalanche-2',\n  'chainlink',\n  'polygon',\n  'litecoin'\n];\n\n// Ensure directory exists\nif (!fs.existsSync(LOGOS_DIR)) {\n  fs.mkdirSync(LOGOS_DIR, { recursive: true });\n}\n\n// Function to download file from URL\nfunction downloadImage(url, filepath) {\n  return new Promise((resolve, reject) => {\n    https.get(url, (response) => {\n      if (response.statusCode === 200) {\n        const fileStream = fs.createWriteStream(filepath);\n        response.pipe(fileStream);\n        fileStream.on('finish', () => {\n          fileStream.close();\n          resolve();\n        });\n        fileStream.on('error', reject);\n      } else {\n        reject(new Error(`Failed to download: ${response.statusCode}`));\n      }\n    }).on('error', reject);\n  });\n}\n\n// Fetch coin data from CoinGecko\nfunction fetchCoinData(coinId) {\n  return new Promise((resolve, reject) => {\n    const url = `https://api.coingecko.com/api/v3/coins/${coinId}?localization=false&tickers=false&market_data=false&community_data=false&developer_data=false`;\n    \n    https.get(url, (response) => {\n      let data = '';\n      \n      response.on('data', (chunk) => {\n        data += chunk;\n      });\n      \n      response.on('end', () => {\n        try {\n          const json = JSON.parse(data);\n          resolve(json);\n        } catch (error) {\n          reject(error);\n        }\n      });\n    }).on('error', reject);\n  });\n}\n\nasync function downloadAllLogos() {\n  console.log('🚀 Starting cryptocurrency logo download...\\n');\n  \n  for (const coinId of CRYPTO_IDS) {\n    try {\n      console.log(`Fetching ${coinId}...`);\n      \n      // Fetch coin data\n      const coinData = await fetchCoinData(coinId);\n      const imageUrl = coinData.image?.large || coinData.image?.small;\n      \n      if (!imageUrl) {\n        console.log(`❌ No image found for ${coinId}`);\n        continue;\n      }\n      \n      // Download image\n      const filename = `${coinId}.png`;\n      const filepath = path.join(LOGOS_DIR, filename);\n      \n      await downloadImage(imageUrl, filepath);\n      console.log(`✅ Downloaded ${filename}`);\n      \n      // Rate limiting - CoinGecko free tier allows ~10-30 calls/minute\n      await new Promise(resolve => setTimeout(resolve, 2000));\n      \n    } catch (error) {\n      console.error(`❌ Error downloading ${coinId}:`, error.message);\n    }\n  }\n  \n  console.log('\\n✨ Download complete!');\n  \n  // Create manifest file\n  const manifest = {\n    cryptos: CRYPTO_IDS.map(id => ({\n      id,\n      logo: `/crypto-logos/${id}.png`\n    })),\n    lastUpdated: new Date().toISOString()\n  };\n  \n  fs.writeFileSync(\n    path.join(LOGOS_DIR, 'manifest.json'),\n    JSON.stringify(manifest, null, 2)\n  );\n  \n  console.log('📝 Manifest created at public/crypto-logos/manifest.json');\n}\n\ndownloadAllLogos().catch(console.error);\n","size_bytes":3370},".local/state/replit/agent/progress_tracker.md":{"content":"[x] 1. Install the required packages\n[x] 2. Restart the workflow to see if the project is working\n[x] 3. Verify the project is working using the feedback tool\n[x] 4. Inform user the import is completed and they can start building, mark the import as completed using the complete_project_import tool\n[x] 5. Fixed Deposit & Withdrawal pages by correcting getWalletConfig function to handle empty wallet configurations\n[x] 6. Fixed login page bug - removed delay and properly reset loading state after successful login","size_bytes":515}},"version":2}